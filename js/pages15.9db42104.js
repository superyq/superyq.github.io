(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages15"],{"11c1":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cui-page"},[t.$slots["header"]?a("div",{staticClass:"cui-page-header"},[t._t("header")],2):t._e(),t._t("default",null,null,{data:t.data}),t.pages&&!t.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:t.total,limit:t.limit,current:t.page},on:{"size-change":t.limitChangeHandle,"current-change":t.pageChangeHandle}})],1):t._e()],2)},i=[],r=(a("96cf"),a("3b8d")),s=a("cebc"),l=a("20ca"),o={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(t,e){this.$set(this.data,t,Object(s["a"])({},this.data[t],e))},deleteItem:function(t){this.data.splice(t,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.formatSearchParams();case 5:return e=t.sent,t.prev=6,t.next=9,this.remoteMethod(e).then(this.formatSearchResult);case 9:a=t.sent,this.$emit("updateSuccess",a),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),this.$emit("updateFailed",t.t0);case 16:this.loading=!1;case 17:case"end":return t.stop()}},t,this,[[6,13]])}));function e(){return t.apply(this,arguments)}return e}(),formatSearchParams:function(){var t={};return this.pages&&Object.assign(t,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(t,this.searchParams),t},formatSearchResult:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var a,n,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.formatResponse){t.next=4;break}return t.next=3,this.formatResponse(e);case 3:e=t.sent;case 4:return a=e,n=a.data,this.pages?(i=n.total,r=n.data,this.scroll?(this.isBottom=r.length<this.limit,this.data=this.data.concat(r)):this.data=r,this.total=i):this.data=n,t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),limitChangeHandle:function(t){this.limit=t,this.updateDataHandle()},pageChangeHandle:function(t){this.page=t,this.updateDataHandle()},scrollHandle:Object(l["a"])(function(){if(!this.isBottom){var t=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;t&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var t=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",t.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=o,d=a("2877"),u=Object(d["a"])(c,n,i,!1,null,null,null);e["a"]=u.exports},1772:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("list-with-search",{ref:"wrapper",attrs:{pages:"","search-params":t.search,"remote-method":t.remoteMethod},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"title",label:"标题","header-align":"center"}}),a("el-table-column",{attrs:{prop:"content",label:"内容","header-align":"center"}}),a("el-table-column",{attrs:{prop:"created_at",label:"发送时间",align:"center",width:"200"}}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(e){return t.deleteHandle(n)}}},[t._v("删除")])]}}],null,!0)})],1),t.addOrUpdateVisible?a("add-or-update",{ref:"addOrUpdate",on:{updatetabledata:t.updateTableData}}):t._e()]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini"}},[a("el-form-item",[a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(e){return t.addOrUpdateHandle()}}},[t._v("发送系统消息")])],1)],1)],1)],2)},i=[],r=a("11c1"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{top:"8vh",visible:t.visible,"show-close":!1,"close-on-click-modal":!1,title:"发送系统消息",width:"700px"},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"dataForm",staticClass:"m-auto",staticStyle:{width:"550px"},attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"95px","label-suffix":":"}},[a("el-form-item",{attrs:{label:"消息标题",prop:"title"}},[a("el-input",{attrs:{type:"text",clearable:""},model:{value:t.dataForm.title,callback:function(e){t.$set(t.dataForm,"title",e)},expression:"dataForm.title"}})],1),a("el-form-item",{attrs:{label:"消息内容",prop:"title"}},[a("el-input",{attrs:{type:"textarea",rows:6,clearable:""},model:{value:t.dataForm.content,callback:function(e){t.$set(t.dataForm,"content",e)},expression:"dataForm.content"}})],1),a("el-form-item",{attrs:{label:"接收者",prop:"title"}},[a("el-input",{attrs:{type:"text",clearable:""},model:{value:t.dataForm.receiver,callback:function(e){t.$set(t.dataForm,"receiver",e)},expression:"dataForm.receiver"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:t.submitting,loading:t.submitting},on:{click:function(e){return t.dataFormSubmit()}}},[t._v("确定")])],1)],1)},l=[],o=a("cebc"),c=a("c1fb");function d(t){return c["a"].get("messages",{params:t})}function u(t){return c["a"].post("messages",Object(o["a"])({},t))}function h(t){return c["a"].delete("message",{params:t})}var m={name:"messageAddOrUpdate",inject:["refreshHandle"],data:function(){return{visible:!1,submitting:!1,dataForm:{title:"",content:"",receiver:0},dataRule:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]}}},methods:{init:function(){var t=this;this.visible=!0,this.$nextTick(function(){t.$refs["dataForm"].resetFields()})},beforeSubmitHandle:function(){var t=this;return new Promise(function(e,a){t.$refs["dataForm"].validate(function(n){n||a(),t.$confirm("确定发送系统消息","发送系统消息").then(e).catch(a)})})},dataFormSubmit:function(){var t=this;this.submitting||(this.submitting=!0,this.beforeSubmitHandle().then(function(){u(t.dataForm).then(function(e){var a=e.message,n=void 0===a?"发送成功！":a;t.visible=!1,t.$message.success(n),t.refreshHandle&&t.refreshHandle()}).catch(function(e){var a=e.message,n=void 0===a?"".concat(t.action,"失败！"):a;t.$message.error(n)}).finally(function(){t.submitting=!1})}).catch(function(){t.submitting=!1}))}}},p=m,f=a("2877"),b=Object(f["a"])(p,s,l,!1,null,null,null),g=b.exports,v=a("ed08"),w={name:"Message",components:{addOrUpdate:g,listWithSearch:r["a"]},provide:function(){return{refreshHandle:this.updateTableData}},data:function(){return{search:{},addOrUpdateVisible:!1}},methods:{remoteMethod:d,updateTableData:function(){this.$refs["wrapper"]["updateDataHandle"]()},addOrUpdateHandle:function(){var t=this;this.addOrUpdateVisible=!0,this.$nextTick(function(){t.$refs.addOrUpdate.init()})},deleteHandle:function(t){var e=this,a=t.id,n=t.title;this.$confirm("确定对系统消息「".concat(n,"」进行删除操作？"),"删除系统消息",{type:"warning"}).then(function(){h({ids:[a]}).then(function(t){var a=t.message,n=void 0===a?"删除成功":a;e.$message.success(n),e.updateTableData()}).catch(function(t){var a=t.message,n=void 0===a?"删除失效！":a;e.$message.error(n)})}).catch(v["i"])}}},H=w,x=Object(f["a"])(H,n,i,!1,null,null,null);e["default"]=x.exports}}]);