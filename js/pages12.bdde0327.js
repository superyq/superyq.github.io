(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages12"],{"11c1":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cui-page"},[t.$slots["header"]?a("div",{staticClass:"cui-page-header"},[t._t("header")],2):t._e(),t._t("default",null,null,{data:t.data}),t.pages&&!t.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:t.total,limit:t.limit,current:t.page},on:{"size-change":t.limitChangeHandle,"current-change":t.pageChangeHandle}})],1):t._e()],2)},n=[],r=(a("96cf"),a("3b8d")),s=a("cebc"),o=a("20ca"),l={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(t,e){this.$set(this.data,t,Object(s["a"])({},this.data[t],e))},deleteItem:function(t){this.data.splice(t,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.formatSearchParams();case 5:return e=t.sent,t.prev=6,t.next=9,this.remoteMethod(e).then(this.formatSearchResult);case 9:a=t.sent,this.$emit("updateSuccess",a),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),this.$emit("updateFailed",t.t0);case 16:this.loading=!1;case 17:case"end":return t.stop()}},t,this,[[6,13]])}));function e(){return t.apply(this,arguments)}return e}(),formatSearchParams:function(){var t={};return this.pages&&Object.assign(t,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(t,this.searchParams),t},formatSearchResult:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var a,i,n,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.formatResponse){t.next=4;break}return t.next=3,this.formatResponse(e);case 3:e=t.sent;case 4:return a=e,i=a.data,this.pages?(n=i.total,r=i.data,this.scroll?(this.isBottom=r.length<this.limit,this.data=this.data.concat(r)):this.data=r,this.total=n):this.data=i,t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),limitChangeHandle:function(t){this.limit=t,this.updateDataHandle()},pageChangeHandle:function(t){this.page=t,this.updateDataHandle()},scrollHandle:Object(o["a"])(function(){if(!this.isBottom){var t=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;t&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var t=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",t.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=l,d=a("2877"),u=Object(d["a"])(c,i,n,!1,null,null,null);e["a"]=u.exports},"32ce":function(t,e,a){t.exports=a.p+"img/user-default.a7807760.png"},"456d":function(t,e,a){var i=a("4bf8"),n=a("0d58");a("5eda")("keys",function(){return function(t){return n(i(t))}})},"469f":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("7d7b")},"5d73":function(t,e,a){t.exports=a("469f")},"5eda":function(t,e,a){var i=a("5ca1"),n=a("8378"),r=a("79e5");t.exports=function(t,e){var a=(n.Object||{})[t]||Object[t],s={};s[t]=e(a),i(i.S+i.F*r(function(){a(1)}),"Object",s)}},"736d":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("list-with-search",{ref:"wrapper",staticClass:"page-dynamic",attrs:{"search-params":t.search,"remote-method":t.getActivities,pages:"",scroll:""},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return[a("div",{staticClass:"card-box clearfix"},t._l(i,function(e){return a("invitation-card",{key:e.id,attrs:{item:e},on:{edit:function(a){return t.addOrUpdateHandle(e)},delete:function(a){return t.deleteHandle(e)},show:function(a){return t.showHandle(e)},scan:function(a){return t.addOrUpdateHandle(e,"scan")}}})}),1),t.showAddOrUpdate?a("add-or-update",{ref:"addOrUpdate"}):t._e(),t.showInvitationData?a("invitation-data",{ref:"invitation-data"}):t._e()]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:"",model:t.search,"label-suffix":"："}},[a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入活动名称",clearable:""},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("活动名称")])])],1),a("el-form-item",[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"——","end-placeholder":"结束时间","start-placeholder":"开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.searchHandle()}}},[t._v("查询")]),a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(e){return t.addOrUpdateHandle()}}},[t._v("新增")])],1),a("el-form-item",{staticClass:"f-right",attrs:{label:"活动总数"}},[a("span",{staticStyle:{"font-size":"35px",color:"burlywood"}},[t._v(t._s(t.total))])])],1)],1)],2)},n=[],r=(a("7f7f"),a("768b")),s=(a("386d"),a("b7d5")),o=a("ed08"),l=a("11c1"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card invitation-card",staticStyle:{margin:"15px"},style:{backgroundImage:"url("+t.bg+")",height:"350px"},on:{click:t.scanHandle}},[a("div",{staticClass:"card__body"},[a("div",{staticClass:"card__content"},[a("h2",[t._v(t._s(t.item.name))]),a("p",{staticClass:"t-truncate",attrs:{title:t.item.title}},[t._v(t._s(t.item.title))]),a("div",{staticClass:"u-help",staticStyle:{"font-size":"14px"}},[t._v(t._s(t.item.start_time)+" ~ "+t._s(t.item.end_time))]),a("div",{staticClass:"card__status",style:{background:t.statusOptions[t.status].bg}},[a("span",[t._v(t._s(t.statusOptions[t.status].name))])])]),a("div",{staticClass:"card__foot w-100",on:{click:function(t){t.stopPropagation()}}},[a("div",{staticClass:"btn",attrs:{title:"关闭"},on:{click:t.deleteHandle}},[a("el-button",{staticClass:"c-danger",attrs:{type:"text",icon:"el-icon-remove-outline"}})],1),a("div",{staticClass:"btn",attrs:{title:"编辑"},on:{click:t.editHandle}},[a("el-button",{staticClass:"c-primary",attrs:{type:"text",icon:"el-icon-edit"}})],1),a("div",{staticClass:"btn",attrs:{title:"查看统计"},on:{click:t.showStatisticsHandle}},[a("el-button",{staticClass:"c-success",attrs:{type:"text",icon:"el-icon-s-data"}})],1)])])])},d=[],u=a("054f"),p=a("32ce"),m=a.n(p),f={name:"UserCard",props:{item:{type:Object,required:!0}},data:function(){return{bgDefault:m.a,maxBio:30,statusOptions:[{name:"已关闭",bg:"#F57373"},{name:"即将开始",bg:"#FFC53D"},{name:"进行中",bg:"#00B6CE"},{name:"已结束",bg:"#F57373"}]}},computed:{bg:function(){return this.getImageUrlByKey(this.item.image.filename)||m.a},status:function(){var t=this.item.status;return t?0:this.item.start_status}},methods:{getImageUrlByKey:u["b"],deleteHandle:function(){this.$emit("delete")},editHandle:function(){this.$emit("edit")},showStatisticsHandle:function(){this.$emit("show")},scanHandle:function(){this.$emit("scan")}}},h=f,v=a("2877"),b=Object(v["a"])(h,c,d,!1,null,null,null),g=b.exports,w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"invitation",attrs:{"close-on-click-modal":!1,visible:t.visible,width:"1000px","inline-message":""},on:{"update:visible":function(e){t.visible=e}}},[i("ul",{staticClass:"add-or-update__nav clearfix",attrs:{slot:"title"},slot:"title"},[i("li",{class:{"nav--active":"base"===t.navActive},on:{click:function(e){return t.changeNav("base")}}},[t._v("基本设置")]),i("li",{class:{"nav--active":"reward"===t.navActive},on:{click:function(e){return t.changeNav("reward")}}},[t._v("奖品设置")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:"base"===t.navActive,expression:'navActive === "base"'}]},[i("el-form",{ref:"baseInfo",staticClass:"m-l130",staticStyle:{width:"500px"},attrs:{model:t.baseInfo,rules:t.baseRule,"label-width":"140px","label-suffix":""},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-form-item",{attrs:{prop:"id"}}),i("el-form-item",{attrs:{prop:"name",label:"活动名称"}},[i("el-input",{attrs:{placeholder:"请输入活动名称",clearable:""},model:{value:t.baseInfo.name,callback:function(e){t.$set(t.baseInfo,"name",e)},expression:"baseInfo.name"}})],1),i("el-form-item",{attrs:{prop:"title",label:"活动副标题"}},[i("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入活动名称",maxlength:"30","show-word-limit":"",clearable:""},model:{value:t.baseInfo.title,callback:function(e){t.$set(t.baseInfo,"title",e)},expression:"baseInfo.title"}})],1),i("el-form-item",{attrs:{prop:"rule",label:"活动规则"}},[i("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入活动规则",clearable:""},model:{value:t.baseInfo.rule,callback:function(e){t.$set(t.baseInfo,"rule",e)},expression:"baseInfo.rule"}})],1),i("el-form-item",{attrs:{prop:"start_time",label:"开始时间"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间","value-format":"yyyy-MM-dd HH:mm:ss",disabled:t.isEdit},model:{value:t.baseInfo.start_time,callback:function(e){t.$set(t.baseInfo,"start_time",e)},expression:"baseInfo.start_time"}})],1),i("el-form-item",{attrs:{prop:"end_time",label:"结束时间"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.baseInfo.end_time,callback:function(e){t.$set(t.baseInfo,"end_time",e)},expression:"baseInfo.end_time"}})],1),i("el-form-item",{attrs:{prop:"image",label:"活动插图"}},[i("image-upload-wrapper",{attrs:{url:t.baseInfo.image.filename,width:"150px",paddingTop:"96%"},on:{click:function(e){return t.toggleUploadBrowse("image")}}}),i("div",{staticClass:"u-help",staticStyle:{"margin-top":"10px"}},[t._v("建议尺寸750x720px")])],1),i("el-form-item",{attrs:{prop:"icon",label:"活动图标"}},[i("image-upload-wrapper",{attrs:{url:t.baseInfo.icon.filename,width:"66px",paddingTop:"112.5%"},on:{click:function(e){return t.toggleUploadBrowse("icon")}}}),i("div",{staticClass:"u-help",staticStyle:{"margin-top":"10px"}},[t._v("建议尺寸不超过64 X 72px")])],1),i("el-form-item",{attrs:{label:"有效用户指定任务",prop:"task_id"}},[i("el-select",{attrs:{filterable:"",remote:"",placeholder:"请输入关键词","remote-method":t.remoteMethod,loading:t.loading},model:{value:t.baseInfo.task_id,callback:function(e){t.$set(t.baseInfo,"task_id",e)},expression:"baseInfo.task_id"}},t._l(t.options,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),i("el-form-item",{attrs:{prop:"valid_reward",label:"被邀请用户奖励矿石"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:t.baseInfo.valid_reward,callback:function(e){t.$set(t.baseInfo,"valid_reward",e)},expression:"baseInfo.valid_reward"}})],1),i("el-button",{staticClass:"btn-next f-right",attrs:{type:"primary",disabled:t.submitting,loading:t.submitting},on:{click:function(e){return t.submitHandle()}}},[t._v("下一步"),i("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"reward"===t.navActive,expression:'navActive === "reward"'}]},[t.addReward?[i("el-form",{ref:"reward",staticClass:"m-l130",staticStyle:{width:"500px"},attrs:{model:t.reward,rules:t.rewardRule,"label-width":"140px","label-suffix":""},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-form-item",{attrs:{prop:"id"}}),i("el-form-item",{attrs:{prop:"attr",label:"奖品属性"}},[i("el-select",{attrs:{disabled:t.isrewardEdit},model:{value:t.reward.attr,callback:function(e){t.$set(t.reward,"attr",e)},expression:"reward.attr"}},t._l(t.rewardOpt,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{prop:"title",label:"奖品标题"}},[i("el-input",{attrs:{type:"text",placeholder:"请输入内容",maxlength:"10","show-word-limit":""},model:{value:t.reward.title,callback:function(e){t.$set(t.reward,"title",e)},expression:"reward.title"}})],1),i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"yjsq"===t.reward.attr,expression:'reward.attr === "yjsq"'}],attrs:{prop:"total_num",label:"奖品总数量"}},[i("el-input-number",{attrs:{"controls-position":"right",min:0,precision:0,step:1},model:{value:t.reward.total_num,callback:function(e){t.$set(t.reward,"total_num",e)},expression:"reward.total_num"}}),i("div",{staticClass:"u-help"},[t._v("0代表无限发放")])],1),i("el-form-item",{attrs:{prop:"icon",label:"奖品图标"}},[i("image-upload-wrapper",{attrs:{url:t.reward.icon.filename,width:"96px",paddingTop:"100%"},on:{click:function(e){return t.toggleUploadBrowse("reward")}}}),i("div",{staticClass:"u-help",staticStyle:{"margin-top":"10px"}},[t._v("建议尺寸不超过96x96px")])],1),i("el-form-item",{staticStyle:{margin:"0"},attrs:{prop:"condition",label:"领取条件"}}),"ct"===t.reward.attr?i("div",{staticClass:"reward__condition-wrapper"},[i("div",{staticClass:"reward__condition-header"},[t._v("有效用户达到"),i("el-input",{staticClass:"w-160",staticStyle:{margin:"0 10px"},model:{value:t.ct_condition.valid_num,callback:function(e){t.$set(t.ct_condition,"valid_num",e)},expression:"ct_condition.valid_num"}}),t._v("人，参与排名")],1),i("div",{staticClass:"reward__condition-table"},[t._l(t.rank_array,function(e,a){return i("div",{staticClass:"table-item"},[i("b",[t._v("排名")]),i("el-input",{staticClass:"w-160 m-r30",model:{value:e.rank,callback:function(a){t.$set(e,"rank",a)},expression:"item.rank"}}),i("b",[t._v("奖励数量")]),i("el-input",{staticClass:"w-160",model:{value:e.num,callback:function(a){t.$set(e,"num",a)},expression:"item.num"}},[i("div",{staticClass:"m-t10",attrs:{slot:"suffix"},slot:"suffix"},[t._v("CT")])]),i("i",{staticClass:"control-btn control-btn--add el-icon-circle-plus",on:{click:function(e){return t.add("ct")}}}),i("i",{staticClass:"control-btn control-btn--remove el-icon-remove",on:{click:function(e){return t.remove(a,"ct")}}})],1)}),t._l(t.rank_array_scope,function(e,a){return i("div",{staticClass:"table-item"},[i("b",[t._v("排名")]),i("el-input",{staticClass:"w-72",model:{value:e.rank_start,callback:function(a){t.$set(e,"rank_start",a)},expression:"item.rank_start"}}),i("span",{staticStyle:{margin:"0 6px"}},[t._v("-")]),i("el-input",{staticClass:"w-72 m-r30",model:{value:e.rank_end,callback:function(a){t.$set(e,"rank_end",a)},expression:"item.rank_end"}}),i("b",[t._v("奖励数量")]),i("el-input",{staticClass:"w-160",model:{value:e.num,callback:function(a){t.$set(e,"num",a)},expression:"item.num"}},[i("div",{staticClass:"m-t10",attrs:{slot:"suffix"},slot:"suffix"},[t._v("CT")])]),i("i",{staticClass:"control-btn control-btn--add el-icon-circle-plus",on:{click:function(e){return t.add("scope")}}}),i("i",{staticClass:"control-btn control-btn--remove el-icon-remove",on:{click:function(e){return t.remove(a,"scope")}}})],1)})],2)]):i("div",{staticClass:"reward__condition-wrapper"},[i("div",{staticClass:"reward__condition-table"},t._l(t.yj_condition,function(e,a){return i("div",{staticClass:"table-item"},[i("b",[t._v("用户数达成")]),i("el-input",{staticClass:"w-160 m-r30",model:{value:e.num,callback:function(a){t.$set(e,"num",a)},expression:"item.num"}}),i("b",[t._v("赠送时间")]),i("el-input",{staticClass:"w-160",model:{value:e.month,callback:function(a){t.$set(e,"month",a)},expression:"item.month"}},[i("div",{staticClass:"m-t10",attrs:{slot:"suffix"},slot:"suffix"},[t._v("月")])]),i("i",{staticClass:"control-btn control-btn--add el-icon-circle-plus",on:{click:function(e){return t.add("yj")}}}),i("i",{staticClass:"control-btn control-btn--remove el-icon-remove",on:{click:function(e){return t.remove(a,"yj")}}})],1)}),0)]),t.isScan?t._e():i("el-button",{staticClass:"f-right",staticStyle:{"margin-left":"20px"},attrs:{type:"primary",loading:t.rewardSubmit,disabled:t.rewardSubmit},on:{click:t.submitReward}},[t._v("确定")]),i("el-button",{staticClass:"f-right",attrs:{type:"warning"},on:{click:t.cancel}},[t._v("取消")])],1)]:[i("div",{staticClass:"reward-list-wrapper"},[t.isScan?t._e():i("div",{staticClass:"wrapper__header clearfix"},[i("el-button",{staticClass:"f-right",attrs:{type:"primary",disabled:t.rewardList.length>1},on:{click:t.addRewardHandle}},[t._v("新增")])],1),t.rewardList.length?i("div",{staticClass:"wrapper__card-list"},t._l(t.rewardList,function(e){return i("div",{staticClass:"wrapper__card",on:{click:function(a){return t.editReward(e)}}},[i("div",{staticClass:"wrapper__card-info"},[i("div",{staticClass:"info-icon"},[i("img",{attrs:{src:t.getImageUrlByKey(e.icon.filename)}})]),i("div",{staticClass:"info-meta"},[i("p",[i("span",[t._v("奖品")]),i("b",[t._v(t._s("ct"===e.attr?"CT":"一键收取"))])]),i("p",[i("span",[t._v("名称")]),i("b",[t._v(t._s(e.title))])]),i("p",[i("span",[t._v("已兑换")]),i("b",[t._v(t._s(e.receive_num))])])])]),i("div",{staticClass:"u-help"},[t._v("点击对奖品进行编辑")])])}),0):i("img",{staticStyle:{"margin-left":"calc(50% - 100px)"},attrs:{src:a("ca62")}})])]],2),i("cui-upload",{ref:"cui-upload",attrs:{listType:"picture"},on:{"on-upload-success":t.imageChangeHandle}})],1)},_=[],y=a("cebc"),k=a("9dac"),x=a("75fc"),C=a("b199"),$={data:function(){return{baseInfo:{id:0,name:"",rule:"",title:"",end_time:"",start_time:"",valid_reward:0,task_id:0,image:{},icon:{}},baseRule:{name:[{required:!0,message:"活动名称不能为空",trigger:"blur"}],rule:[{required:!0,message:"活动规则不能为空",trigger:"change"}],title:[{required:!0,message:"活动副标题不能为空",trigger:"blur"}],image:[{required:!0,message:"请选择活动插图",trigger:"blur"}],icon:[{required:!0,message:"请选择活动图标",trigger:"blur"}],start_time:[{required:!0,message:"活动开始时间不能为空",trigger:"blur"}],end_time:[{required:!0,message:"活动结束时间不能为空",trigger:"blur"}]},imgType:"image",options:[],loading:!1}},methods:{baseValidate:function(){var t=this;return new Promise(function(e,a){t.$refs["baseInfo"].validate(function(t){t?e():a("基础设置未填写完整")})})},getTaskCate:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(C["a"])({name:e}).then(function(e){var a,i=e.data;t.options=[{id:0,name:"随机任务"}],(a=t.options).push.apply(a,Object(x["a"])(i))}).catch(function(e){var a=e.message,i=void 0===a?"查询失败":a;t.$message.error(i)}).finally(function(){t.loading=!1})},toTime:function(t){return new Date(t).getTime()},remoteMethod:function(t){this.loading=!0,this.getTaskCate(t)},submitHandle:function(){var t=this;return this.addReward=!1,this.isScan?(this.getRewardList(),this.navActive="reward"):Date.parse(new Date)>this.toTime(this.baseInfo.end_time)?this.$message.error("不能早于当前时间！"):void(this.submitting||(this.submitting=!0,this.baseValidate().then(function(){Object(s["h"])(t.baseInfo).then(function(e){var a=e.data;!t.baseInfo.id&&(t.baseInfo.id=a),t.searchHandle(),t.navActive="reward",t.getRewardList()}).catch(function(e){var a=e.message,i=void 0===a?"".concat(t.action,"邀请任务成功！"):a;t.$message.error(i)}).finally(function(){t.submitting=!1})}).catch(function(e){t.$message.error(e),t.submitting=!1})))}}},H={data:function(){return{reward:{id:0,attr:"ct",title:"",total_num:0,icon:{}},rewardRule:{attr:[{required:!0,message:"奖品属性不能为空",trigger:"blur"}],title:[{required:!0,message:"奖品标题不能为空",trigger:"blur"}],total_num:[{required:!0,message:"奖品总数量不能为空",trigger:"blur"}],icon:[{required:!0,message:"奖品图标不能为空",trigger:"blur"}]},rewardOpt:[{value:"ct",label:"CT"},{value:"yjsq",label:"一键收取"}],ct_condition:{valid_num:1,partin_rule:[]},rank_array:[{rank:0,num:0,type:"ranking"}],rank_array_scope:[{rank_start:0,rank_end:0,num:0,type:"ranking:scope"}],yj_condition:[{num:0,month:1}],rewardSubmit:!1,addReward:!1}},computed:{isrewardEdit:function(){return!!this.reward.id}},methods:{validNumber:function(t){return/^[1-9]\d*$/.test(t)},resetReward:function(){this.reward.id=0,this.reward.attr="ct",this.reward.title="",this.reward.total_num=0,this.reward.icon={},this.rank_array=[{rank:0,num:0,type:"ranking"}],this.rank_array_scope=[{rank_start:0,rank_end:0,num:0,type:"ranking:scope"}],this.yj_condition=[{num:0,month:1}]},add:function(t){var e={rank:0,num:0,type:"ranking"},a={rank_start:0,rank_end:0,num:0,type:"ranking:scope"},i={num:0,month:1};switch(t){case"scope":this.rank_array_scope.push(a);break;case"yj":this.yj_condition.push(i);break;case"ct":this.rank_array.push(e);break}},remove:function(t,e){switch(e){case"scope":this.rank_array_scope.splice(t,1);break;case"yj":this.yj_condition.splice(t,1);break;case"ct":this.rank_array.splice(t,1);break}},rewardValidate:function(){var t=this;return new Promise(function(e,a){t.$refs["reward"].validate(function(t){t?e():a("奖励设置未填写完整")})})},cancel:function(){this.addReward=!1},submitReward:function(){var t=this;if(!this.rewardSubmit){if(this.rewardSubmit=!0,!this.reward.id&&this.rewardList.length>0){if("ct"===this.reward.attr&&"ct"===this.rewardList[0].attr)return this.rewardSubmit=!1,this.$message.error("CT奖励属性已存在");if("yjsq"===this.reward.attr&&"yjsq"===this.rewardList[0].attr)return this.rewardSubmit=!1,this.$message.error("一键收取奖励属性已经存在")}this.rewardValidate().then(function(){var e={};if("ct"===t.reward.attr){if(!t.validNumber(t.ct_condition.valid_num))return t.rewardSubmit=!1,t.$message.error("有效用户请填写大于0的整数");var a=t.rank_array_scope.map(function(t){return{num:t.num,rank:"".concat(t.rank_start,",").concat(t.rank_end),type:t.type}});t.ct_condition.partin_rule=[].concat(Object(x["a"])(t.rank_array),Object(x["a"])(a)),e=Object(y["a"])({},t.reward,{condition:t.ct_condition})}else e=Object(y["a"])({},t.reward,{condition:t.yj_condition});var i=t.reward.id?Object(s["i"])(t.reward.id,e):Object(s["g"])(t.baseInfo.id,e);i.then(function(e){var a=e.message;t.$message.success(a),t.addReward=!1,t.getRewardList()}).catch(function(e){var a=e.message;t.$message.error(a)}).finally(function(){t.rewardSubmit=!1})}).catch(function(e){t.$message.error(e),t.rewardSubmit=!1})}}}},O=(a("28a5"),a("ac6a"),{data:function(){return{rewardList:[]}},methods:{getImageUrlByKey:u["b"],getRewardList:function(){var t=this;Object(s["e"])(this.baseInfo.id).then(function(e){var a=e.data;t.rewardList=a}).catch(function(e){var a=e.message,i=void 0===a?"获取奖励列表失败":a;t.$message.error(i)})},toPer:function(t,e){return Math.round(t/e*1e4)/100},addRewardHandle:function(){this.addReward=!0,this.resetReward()},editReward:function(t){if(this.addReward=!0,this.resetReward(),this.reward=Object(o["b"])(t),"ct"===t.attr){this.ct_condition.valid_num=t.condition.valid_num;var e=[],a=[];t.condition.partin_rule.forEach(function(t){"ranking"===t.type?e.push(t):a.push({rank_start:t.rank.split(",")[0],rank_end:t.rank.split(",")[1],num:t.num,type:"ranking:scope"})}),this.rank_array=e,this.rank_array_scope=a}else this.yj_condition=t.condition}}}),j={name:"AddOrUpdate",mixins:[$,H,O],inject:["searchHandle"],components:{cuiUpload:k["a"]},data:function(){return{visible:!1,submitting:!1,navActive:"base",type:""}},computed:{isEdit:function(){return!!this.baseInfo.id},isScan:function(){return"scan"===this.type},action:function(){return this.baseInfo.id?"修改":"新增"}},methods:{getImageUrlByKey:u["b"],changeNav:function(t){"reward"===t?this.submitHandle():this.navActive=t},init:function(t,e){var a=this;this.visible=!0,this.$nextTick(function(){a.getTaskCate(),a.$refs["baseInfo"].resetFields(),a.resetReward(),a.navActive="base",a.type=e,t&&t.id&&(a.baseInfo=Object(o["b"])(t))})},toggleUploadBrowse:function(t){this.imgType=t,this.$refs["cui-upload"]["toggleBrowse"]()},imageChangeHandle:function(t){this.$message.success("图片上传成功！");var e=t.filename;switch(this.$refs["cui-upload"]["toggleBrowse"](),this.imgType){case"image":this.baseInfo.image=Object(y["a"])({},t,{filename:e});break;case"icon":this.baseInfo.icon=Object(y["a"])({},t,{filename:e});break;case"reward":this.reward.icon=Object(y["a"])({},t,{filename:e});break}}}},I=j,S=Object(v["a"])(I,w,_,!1,null,null,null),T=S.exports,R=a("ae08"),U={name:"Invitation",components:{listWithSearch:l["a"],invitationCard:g,invitationData:R["default"],addOrUpdate:T},provide:function(){return{searchHandle:this.searchHandle}},data:function(){return{total:0,search:{name:"",start_time:"",end_time:""},showAddOrUpdate:!1,showInvitationData:!1}},computed:{time:{get:function(){var t=this.search,e=t.start_time,a=t.end_time;return a&&a?[e,a]:""},set:function(t){var e=t||[],a=Object(r["a"])(e,2),i=a[0],n=void 0===i?"":i,s=a[1],o=void 0===s?"":s;this.search.start_time=n,this.search.end_time=o}}},methods:{getActivities:function(){var t=this;return Object(s["d"])(arguments.length<=0?void 0:arguments[0]).then(function(e){var a=e.data.total;return t.total=a,e})},searchHandle:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].searchHandle()},addOrUpdateHandle:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t&&t.status&&"scan"!==a)return this.$message.info("已关闭活动，不得编辑");this.showAddOrUpdate=!0,this.$nextTick(function(){e.$refs["addOrUpdate"]&&e.$refs["addOrUpdate"].init(t,a)})},deleteHandle:function(t){var e=this,a=t.name,i=t.id;this.$confirm("确认关闭任务「".concat(a,"」？"),"关闭任务").then(function(){Object(s["a"])(i).then(function(t){var a=t.message,i=void 0===a?"关闭成功！":a;e.$message.success(i),e.getActivities()}).catch(function(t){var a=t.message,i=void 0===a?"关闭失败！":a;e.$message.error(i)})}).catch(o["i"])},showHandle:function(t){var e=this;this.showInvitationData=!0,this.$nextTick(function(){e.$refs["invitation-data"]&&e.$refs["invitation-data"].init(t)})}},activated:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].resetScroll()}},q=U,B=Object(v["a"])(q,i,n,!1,null,null,null);e["default"]=B.exports},"768b":function(t,e,a){"use strict";var i=a("a745"),n=a.n(i);function r(t){if(n()(t))return t}var s=a("5d73"),o=a.n(s);function l(t,e){var a=[],i=!0,n=!1,r=void 0;try{for(var s,l=o()(t);!(i=(s=l.next()).done);i=!0)if(a.push(s.value),e&&a.length===e)break}catch(c){n=!0,r=c}finally{try{i||null==l["return"]||l["return"]()}finally{if(n)throw r}}return a}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function d(t,e){return r(t)||l(t,e)||c()}a.d(e,"a",function(){return d})},"7d7b":function(t,e,a){var i=a("e4ae"),n=a("7cd6");t.exports=a("584a").getIterator=function(t){var e=n(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},"9dac":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{center:"",width:"500px",title:"文件上传",visible:t.visible,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"cui-upload"},on:{"update:visible":function(e){t.visible=e},close:function(e){return t.afterDialogCloseHandle()}}},[a("el-upload",t._g(t._b({ref:"upload",staticClass:"cui-upload__wrapper",attrs:{limit:t.limit,accept:t.accept,multiple:t.multiple,action:t.uploadUrl,"auto-upload":!1,"list-type":t.listType,"on-exceed":t.exceedHandle,"on-preview":t.previewHandle,"on-success":t.successHandle,"before-upload":t.beforeUpload,"before-remove":t.beforeRemoveHandle,"http-request":t.uploadFileWithQiniu}},"el-upload",t.$attrs,!1),t.$listeners),[a("el-button",{ref:"browse",attrs:{slot:"trigger",size:"small",type:"warning",icon:"el-icon-upload"},slot:"trigger"},[t._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._t("tip",[t._v(t._s(t.tip||"只能上传jpg/png文件，且不超过500kb"))])],2)],1),a("el-dialog",{attrs:{title:t.previewTitle,visible:t.previewVisible,top:"5vh","append-to-body":""},on:{"update:visible":function(e){t.previewVisible=e}}},[a("img",{attrs:{width:"100%",src:t.previewUrl,alt:t.previewTitle}})]),a("template",{slot:"footer"},[a("el-button",{attrs:{type:"default"},on:{click:function(e){return t.beforeDialogCloseHandle()}}},[t._v("关闭")]),a("el-button",{attrs:{type:"primary",loading:t.submitting},on:{click:t.submitUpload}},[t._v("上传")])],1)],2)},n=[],r=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("ac6a"),a("456d"),a("c5f6"),a("ed08")),o=a("054f"),l=a("5f87"),c=a("3786"),d={name:"cui-upload",props:{multiple:Boolean,listType:{type:String,default:"text"},accept:{type:String,default:"image/jpeg,image/gif,image/png"},tip:String,limit:Number,beforeUpload:Function,validFile:Function},data:function(){return{uploadUrl:"",previewUrl:"",previewTitle:"图片预览",visible:!1,previewVisible:!1,reqs:{},uploadToken:""}},computed:{submitting:function(){return Object.keys(this.reqs).length>0}},methods:{isImage:function(t){return-1!==t.indexOf("image")},toggleBrowse:function(){this.visible=!this.visible},afterDialogCloseHandle:function(){this.$refs["upload"].clearFiles()},beforeDialogCloseHandle:function(){var t=this;if(this.submitting)return this.$confirm("文件上传中，是否取消上传？","提示",{type:"warning",confirmButtonText:"继续上传",cancelButtonText:"取消上传并退出"}).then(s["i"]).catch(function(){t.clearReqs(null,function(){t.visible=!1})}),!1;this.visible=!1},exceedHandle:function(){this.$alert("超过最大文件数，请移除多余文件！","提示",{type:"warning"}).catch(s["i"])},beforeRemoveHandle:function(t){return this.$confirm("确定移除文件[".concat(t.name,"]？"),"移除文件")},clearReqs:function(t,e){if(t)this.reqs[t]["abort"](),this.$delete(this.reqs,t);else for(var a in this.reqs)this.reqs[a].abort();e()},previewHandle:function(t){var e=this,a=t.raw.type,i=t.url,n=t.name;this.isImage(a)&&i&&(this.previewUrl=i,this.previewTitle=n||this.previewTitle,this.$nextTick(function(){e.previewVisible=!0}))},successHandle:function(t,e,a){this.$emit("on-upload-success",t,e,a)},submitUpload:function(){if(!this.submitting){var t=this.$refs["upload"];t&&(t.uploadFiles.length?this.$refs["upload"].submit():this.$alert("请选择需要上传的文件！","提示",{type:"warning"}).catch(s["i"]))}},uploadFileWithQiniu:function(t){var e=this,a=t.file,i=t.onSuccess,n=t.onError,r=t.onProgress,s=a.uid,c=function(){e.$delete(e.reqs,s)},d=function(){c(),i.apply(void 0,arguments)},u=function(){c();for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];401===e[0].code&&l["a"].logout("登录失效，是否前往登录页重新登录？","重新登录",{confirmButtonText:"重新登录",showCancelButton:!1}),n.apply(void 0,e)},p=function(t){var e=t.total;r(e)},m=Object(o["a"])(this.uploadToken,a,d,u,p);return this.$set(this.reqs,s,m),m.abort=function(){c(),m.unsubscribe()},m},refreshUploadToken:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["b"])();case 2:e=t.sent,a=e.data,this.uploadToken=a;case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.refreshUploadToken()}},u=d,p=a("2877"),m=Object(p["a"])(u,i,n,!1,null,null,null);e["a"]=m.exports},b199:function(t,e,a){"use strict";a.d(e,"b",function(){return n}),a.d(e,"a",function(){return r}),a.d(e,"c",function(){return s});var i=a("c1fb");function n(){return i["a"].get("task")}function r(t){return i["a"].get("plaza/task/choice",{params:t})}function s(t){var e=t.id,a=t.data,n={data:a,url:"task/".concat(e||""),method:e?"PUT":"POST"};return Object(i["a"])(n)}}}]);