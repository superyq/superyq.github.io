(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages20~pages5"],{"11c1":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cui-page"},[t.$slots["header"]?i("div",{staticClass:"cui-page-header"},[t._t("header")],2):t._e(),t._t("default",null,null,{data:t.data}),t.pages&&!t.scroll?i("div",{staticClass:"cui-page-footer"},[i("cui-pagination",{attrs:{total:t.total,limit:t.limit,current:t.page},on:{"size-change":t.limitChangeHandle,"current-change":t.pageChangeHandle}})],1):t._e()],2)},a=[],s=(i("96cf"),i("3b8d")),r=i("cebc"),c=i("20ca"),o={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(t,e){this.$set(this.data,t,Object(r["a"])({},this.data[t],e))},deleteItem:function(t){this.data.splice(t,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.formatSearchParams();case 5:return e=t.sent,t.prev=6,t.next=9,this.remoteMethod(e).then(this.formatSearchResult);case 9:i=t.sent,this.$emit("updateSuccess",i),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),this.$emit("updateFailed",t.t0);case 16:this.loading=!1;case 17:case"end":return t.stop()}},t,this,[[6,13]])}));function e(){return t.apply(this,arguments)}return e}(),formatSearchParams:function(){var t={};return this.pages&&Object.assign(t,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(t,this.searchParams),t},formatSearchResult:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){var i,n,a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.formatResponse){t.next=4;break}return t.next=3,this.formatResponse(e);case 3:e=t.sent;case 4:return i=e,n=i.data,this.pages?(a=n.total,s=n.data,this.scroll?(this.isBottom=s.length<this.limit,this.data=this.data.concat(s)):this.data=s,this.total=a):this.data=n,t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),limitChangeHandle:function(t){this.limit=t,this.updateDataHandle()},pageChangeHandle:function(t){this.page=t,this.updateDataHandle()},scrollHandle:Object(c["a"])(function(){if(!this.isBottom){var t=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;t&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var t=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",t.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},l=o,d=i("2877"),m=Object(d["a"])(l,n,a,!1,null,null,null);e["a"]=m.exports},a8db:function(t,e,i){"use strict";var n=i("e265"),a=i.n(n),s=i("a4bb"),r=i.n(s);function c(t,e){if(null==t)return{};var i,n,a={},s=r()(t);for(n=0;n<s.length;n++)i=s[n],e.indexOf(i)>=0||(a[i]=t[i]);return a}function o(t,e){if(null==t)return{};var i,n,s=c(t,e);if(a.a){var r=a()(t);for(n=0;n<r.length;n++)i=r[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(s[i]=t[i])}return s}i.d(e,"a",function(){return o})},cb99:function(t,e,i){"use strict";i.d(e,"c",function(){return r}),i.d(e,"f",function(){return c}),i.d(e,"a",function(){return o}),i.d(e,"e",function(){return l}),i.d(e,"d",function(){return d}),i.d(e,"b",function(){return m});var n=i("cebc"),a=i("a8db"),s=i("c1fb");function r(t){return s["a"].get("dynamic",{params:t})}function c(t){var e=t.id,i=Object(a["a"])(t,["id"]),n={data:i,url:"dynamic/".concat(e||""),method:e?"PUT":"POST"};return Object(s["a"])(n)}function o(t){return s["a"].delete("dynamic/".concat(t))}function l(t,e){return"number"===typeof t&&(t=[t]),s["a"].put("dynamic/recommended",{dynamic_ids:t,status:e})}function d(t){return s["a"].post("dynamic/top",Object(n["a"])({},t))}function m(t){return s["a"].delete("dynamic/top/".concat(t))}},db3c:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dynamic-item"},[i("div",{staticClass:"dynamic__hd card-wrap"},[i("div",{staticClass:"cui-userbox cui-userbox--large"},[i("img",{staticClass:"cui-userbox__avatar",staticStyle:{"border-radius":"50%"},attrs:{src:t.avatar}}),i("h2",{staticClass:"cui-userbox__name"},[t._v(t._s(t.user.name))])]),i("div",{staticClass:"dynamic__actions"},[i("el-button",{attrs:{size:"mini",circle:"",icon:"el-icon-edit"},on:{click:function(e){return t.dynamicEditHandle()}}}),i("el-button",{attrs:{size:"mini",circle:"",icon:"el-icon-delete",loading:t.deleting},on:{click:function(e){return t.dynamicDeleteHandle()}}}),i("el-dropdown",{staticStyle:{"margin-left":"10px"},attrs:{placement:"bottom-start",trigger:"click"},on:{command:t.moreActionHandle}},[i("el-button",{attrs:{size:"mini",circle:"",icon:"el-icon-arrow-down"}}),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"recommend"}},[t._v(t._s(t.isRecommend?"取消":"设置")+"推荐")]),i("el-dropdown-item",{attrs:{command:"pinned"}},[t._v(t._s(t.isPinned?"取消":"设置")+"置顶")])],1)],1)],1)]),i("div",{staticClass:"dynamic__bd card-wrap"},[i("div",{staticClass:"dynamic__text"},[t._l(t.tags,function(e){var n=e.id,a=e.name;return i("a",{key:n,staticClass:"dynamic__tag",attrs:{href:"javascript:;"},on:{click:function(e){return t.tagChangeHandle(a)}}},[t._v("#"+t._s(a)+"#")])}),i("span",[t._v(t._s(t.content.text))]),t.content.isLongTxt?i("a",{attrs:{href:"javascript:;"},on:{click:function(e){t.showAllText=!t.showAllText}}},[t._v(t._s(t.showAllText?"收起":"查看全文"))]):t._e()],2),i("div",{staticClass:"dynamic__media"},[t.images?i("ul",{staticClass:"dynamic__images"},[t._l(t.images,function(e,n){return i("li",{key:n,staticClass:"dynamic__image",on:{click:function(e){return t.showDialogHandle(n)}}},[i("img",{directives:[{name:"pic",rawName:"v-pic",value:e,expression:"src"}]})])}),i("image-dialog-wrapper",{ref:"imageDialog",attrs:{images:t.images||[],onlyDialog:!0}})],2):t._e(),t.video?i("div",{staticClass:"dynamic__viedo"},[i("video",{attrs:{controls:"",width:"320",preload:"metadata",poster:t.video.cover,muted:""},domProps:{muted:!0}},[i("source",{attrs:{src:t.video.src,type:"video/mp4"}}),i("p",[t._v("Your browser doesn't support HTML5 video. Here is a"),i("a",{attrs:{href:t.video.src}},[t._v("link to the video")]),t._v("instead.")])])]):t._e()]),i("div",{staticClass:"dynamic__info"},[t.item.location?i("span",{staticClass:"c-primary location"},[i("i",{staticClass:"el-icon-location-outline"}),i("b",{attrs:{title:t.item.location}},[t._v(t._s(t.item.location))])]):t._e(),t.isSync?i("span",{staticClass:"c-warning"},[i("i",{staticClass:"el-icon-aim"}),i("b",[t._v("广场")])]):t._e(),t.isRecommend?i("span",{staticClass:"c-success"},[i("i",{staticClass:"el-icon-star-on"}),i("b",[t._v("推荐")])]):t._e(),t.isPinned?i("span",{staticClass:"c-warning"},[i("i",{staticClass:"el-icon-star-on"}),i("b",[t._v("置顶")])]):t._e(),i("span",{staticClass:"c-info f-right"},[i("i",{staticClass:"el-icon-time"}),i("span",[t._v(t._s(t.item.created_at))])])]),t.isPinned?i("div",{staticClass:"dynamic__info"},[i("span",{staticClass:"c-info f-right"},[i("label",[t._v("开始置顶时间：")]),i("i",{staticClass:"el-icon-time"}),i("span",[t._v(t._s(t.item.topped.start_time))])]),i("span",{staticClass:"c-info f-right"},[i("label",[t._v("结束置顶时间：")]),i("i",{staticClass:"el-icon-time"}),i("span",[t._v(t._s(t.item.topped.expire_time))])])]):t._e()]),i("div",{staticClass:"dynamic__ft"},[i("div",{staticClass:"dynamic__count dynamic__count--like"},[i("i",{staticClass:"dynamic__count-icon"}),i("span",[t._v(t._s(t.count.likeCount))])]),i("div",{staticClass:"dynamic__count dynamic__count--collect"},[i("i",{staticClass:"dynamic__count-icon"}),i("span",[t._v(t._s(t.count.collectCount))])]),i("div",{staticClass:"dynamic__count dynamic__count--comment",on:{click:function(e){return t.showComment()}}},[i("i",{staticClass:"dynamic__count-icon"}),i("span",[t._v(t._s(t.count.commentCount))])]),i("pinned-dialog",{ref:"pinnedDialog",on:{submit:t.dynamicPinnedHandle}})],1)])},a=[],s=i("cebc"),r=(i("96cf"),i("3b8d")),c=(i("c5f6"),i("054f")),o=i("f9a8"),l=i.n(o),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{top:"8vh",center:!0,visible:t.visible,"show-close":!1,"close-on-click-modal":!1,title:"设置动态置顶","custom-class":"dynamic-editor"},on:{"update:visible":function(e){t.visible=e}}},[i("el-form",{ref:"dataForm",attrs:{size:"mini",model:t.dataForm,"label-suffix":"：",rules:t.rules}},[i("el-form-item",{attrs:{prop:"sort",label:"置顶排序"}},[i("el-input-number",{attrs:{"controls-position":"right",min:1,precision:0,step:1},model:{value:t.dataForm.sort,callback:function(e){t.$set(t.dataForm,"sort",e)},expression:"dataForm.sort"}})],1),i("el-form-item",{attrs:{prop:"start_time",label:"开始时间"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.start_time,callback:function(e){t.$set(t.dataForm,"start_time",e)},expression:"dataForm.start_time"}})],1),i("el-form-item",{attrs:{prop:"expire_time",label:"结束时间"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.dataForm.expire_time,callback:function(e){t.$set(t.dataForm,"expire_time",e)},expression:"dataForm.expire_time"}})],1)],1),i("template",{slot:"footer"},[i("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.beforeSubmitHandle()}}},[t._v("设置置顶")])],1)],2)},m=[],u={name:"addOrUpdate",data:function(){return{visible:!1,dataForm:{id:0,sort:0,start_time:null,expire_time:null},rules:{sort:[{required:!0,message:"置顶排序不能为空",trigger:"blur"}],start_time:[{required:!0,message:"置顶开始时间不能为空",trigger:"blur"}],expire_time:[{required:!0,message:"置顶结束时间不能为空",trigger:"blur"}]}}},methods:{close:function(){this.visible=!1},reset:function(){this.$refs["dataForm"]&&this.$refs["dataForm"].resetFields()},init:function(t){this.visible=!0,this.reset(),this.dataForm.id=t&&t.id},beforeSubmitHandle:function(){var t=this;this.$refs["dataForm"].validate(function(e){if(e){var i=t.dataForm,n=i.start_time,a=i.expire_time;Date.parse(n)>=Date.parse(a)?t.$message.error("开始时间不能大于结束时间！"):t.$emit("submit",t.dataForm)}})}}},h=u,p=i("2877"),f=Object(p["a"])(h,d,m,!1,null,null,null),v=f.exports,g=i("cb99"),_=i("ed08"),b={name:"dynamic-item",components:{pinnedDialog:v},inject:["changeItem"],props:{item:Object,maxLength:{type:Number,default:180}},data:function(){return{params:{sort:0},deleting:!1,showAllText:!1}},computed:{user:function(){var t=this.item.user;return t||{}},avatar:function(){var t=this.user.avatar;return t?Object(c["b"])(t):l.a},content:function(){var t=this.item.content,e=void 0===t?"":t,i=e.length>this.maxLength;return{isLongTxt:i,text:i?this.showAllText?e:e.substr(0,this.maxLength-3)+"...":e}},images:function(){var t=this.item.images;return!(null===t||!Array.isArray(t))&&t.map(function(t){return Object(c["b"])(t.filename)})},video:function(){var t=this.item.video;if(null===t)return!1;var e=t.cover.filename,i=t.video.filename;return{cover:Object(c["b"])(e),src:Object(c["b"])(i)}},tags:function(){var t=this.item.tags;return t},count:function(){var t=this.item,e=t.comment_count,i=void 0===e?0:e,n=t.collect_count,a=void 0===n?0:n,s=t.like_count,r=void 0===s?0:s;return{likeCount:r,collectCount:a,commentCount:i}},isSync:function(){var t=this.item.sync_plaza;return Boolean(t)},isRecommend:function(){var t=this.item.recommended;return Boolean(t)},isPinned:function(){var t=this.item.top;return Boolean(t)}},methods:{showDialogHandle:function(t){this.$refs["imageDialog"].showDialog(t)},dynamicEditHandle:function(){this.$emit("onEdit")},showComment:function(){this.$emit("showComment")},dynamicDeleteHandle:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.deleting){t.next=2;break}return t.abrupt("return");case 2:return this.deleting=!0,t.prev=3,t.next=6,this.$confirm("确认删除该条动态？","删除动态",{type:"warning"});case 6:e=this.item.id,Object(g["a"])(e).then(function(t){var e=t.message;i.$message.success(e),i.deleting=!1,i.$emit("onDelete")}).catch(function(t){var e=t.message;i.$message.error(e),i.deleting=!1}),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](3),this.deleting=!1;case 13:case"end":return t.stop()}},t,this,[[3,10]])}));function e(){return t.apply(this,arguments)}return e}(),dynamicRecommendHandle:function(){var t=this,e=this.item,i=e.id,n=e.recommended,a=n?"取消推荐":"设置推荐",s=n?"取消该动态的推荐状态":"设置该动态为推荐动态";this.$confirm("确定".concat(s,"？"),a,{type:"warning"}).then(function(){Object(g["e"])(i,+!n).then(function(e){var i=e.message;t.$message.success(i),t.changeItem(t.item.index,{recommended:+!n})}).catch(function(e){var i=e.message;t.$message.error(i)})}).catch(_["i"])},beforePinned:function(){var t=this.item.top;if(!t)return this.$refs["pinnedDialog"].init(this.item);this.dynamicPinnedHandle()},dynamicPinnedHandle:function(t){var e=this,i=this.item,n=i.id,a=i.top,r=a?"取消置顶":"设置置顶",c=a?"取消该动态的置顶状态":"设置该动态为置顶动态";this.$confirm("确定".concat(c,"？"),r,{type:"warning"}).then(function(){var i=a?Object(g["b"])(n):Object(g["d"])(t);i.then(function(i){var n=i.message;e.$message.success(n),e.changeItem(e.item.index,Object(s["a"])({},e.item,{top:+!a,topped:{start_time:t&&t.start_time||null,expire_time:t&&t.expire_time||null}})),!a&&e.$refs["pinnedDialog"].close()}).catch(function(t){var i=t.message;e.$message.error(i)})}).catch(_["i"])},moreActionHandle:function(t){switch(t){case"recommend":this.dynamicRecommendHandle();break;case"pinned":this.beforePinned();break;default:break}},tagChangeHandle:function(t){this.$emit("ontagChangeHandle",t)}}},y=b,w=Object(p["a"])(y,n,a,!1,null,null,null);e["a"]=w.exports},f9a8:function(t,e,i){t.exports=i.p+"img/avatar__user.d76349f5.png"}}]);