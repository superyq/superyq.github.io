(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages7"],{"11c1":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cui-page"},[e.$slots["header"]?a("div",{staticClass:"cui-page-header"},[e._t("header")],2):e._e(),e._t("default",null,null,{data:e.data}),e.pages&&!e.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:e.total,limit:e.limit,current:e.page},on:{"size-change":e.limitChangeHandle,"current-change":e.pageChangeHandle}})],1):e._e()],2)},n=[],r=(a("96cf"),a("3b8d")),s=a("cebc"),l=a("20ca"),o={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(e,t){this.$set(this.data,e,Object(s["a"])({},this.data[e],t))},deleteItem:function(e){this.data.splice(e,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:return this.loading=!0,e.next=5,this.formatSearchParams();case 5:return t=e.sent,e.prev=6,e.next=9,this.remoteMethod(t).then(this.formatSearchResult);case 9:a=e.sent,this.$emit("updateSuccess",a),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](6),this.$emit("updateFailed",e.t0);case 16:this.loading=!1;case 17:case"end":return e.stop()}},e,this,[[6,13]])}));function t(){return e.apply(this,arguments)}return t}(),formatSearchParams:function(){var e={};return this.pages&&Object.assign(e,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(e,this.searchParams),e},formatSearchResult:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var a,i,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.formatResponse){e.next=4;break}return e.next=3,this.formatResponse(t);case 3:t=e.sent;case 4:return a=t,i=a.data,this.pages?(n=i.total,r=i.data,this.scroll?(this.isBottom=r.length<this.limit,this.data=this.data.concat(r)):this.data=r,this.total=n):this.data=i,e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),limitChangeHandle:function(e){this.limit=e,this.updateDataHandle()},pageChangeHandle:function(e){this.page=e,this.updateDataHandle()},scrollHandle:Object(l["a"])(function(){if(!this.isBottom){var e=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;e&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var e=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",e.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=o,u=a("2877"),d=Object(u["a"])(c,i,n,!1,null,null,null);t["a"]=d.exports},"386d":function(e,t,a){"use strict";var i=a("cb7c"),n=a("83a1"),r=a("5f1b");a("214f")("search",1,function(e,t,a,s){return[function(a){var i=e(this),n=void 0==a?void 0:a[t];return void 0!==n?n.call(a,i):new RegExp(a)[t](String(i))},function(e){var t=s(a,e,this);if(t.done)return t.value;var l=i(e),o=String(this),c=l.lastIndex;n(c,0)||(l.lastIndex=0);var u=r(l,o);return n(l.lastIndex,c)||(l.lastIndex=c),null===u?-1:u.index}]})},"3beb":function(e,t,a){e.exports=a.p+"img/community-default.283f900e.png"},"456d":function(e,t,a){var i=a("4bf8"),n=a("0d58");a("5eda")("keys",function(){return function(e){return n(i(e))}})},"5eda":function(e,t,a){var i=a("5ca1"),n=a("8378"),r=a("79e5");e.exports=function(e,t){var a=(n.Object||{})[e]||Object[e],s={};s[e]=t(a),i(i.S+i.F*r(function(){a(1)}),"Object",s)}},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"9dac":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{center:"",width:"500px",title:"文件上传",visible:e.visible,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"cui-upload"},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.afterDialogCloseHandle()}}},[a("el-upload",e._g(e._b({ref:"upload",staticClass:"cui-upload__wrapper",attrs:{limit:e.limit,accept:e.accept,multiple:e.multiple,action:e.uploadUrl,"auto-upload":!1,"list-type":e.listType,"on-exceed":e.exceedHandle,"on-preview":e.previewHandle,"on-success":e.successHandle,"before-upload":e.beforeUpload,"before-remove":e.beforeRemoveHandle,"http-request":e.uploadFileWithQiniu}},"el-upload",e.$attrs,!1),e.$listeners),[a("el-button",{ref:"browse",attrs:{slot:"trigger",size:"small",type:"warning",icon:"el-icon-upload"},slot:"trigger"},[e._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._t("tip",[e._v(e._s(e.tip||"只能上传jpg/png文件，且不超过500kb"))])],2)],1),a("el-dialog",{attrs:{title:e.previewTitle,visible:e.previewVisible,top:"5vh","append-to-body":""},on:{"update:visible":function(t){e.previewVisible=t}}},[a("img",{attrs:{width:"100%",src:e.previewUrl,alt:e.previewTitle}})]),a("template",{slot:"footer"},[a("el-button",{attrs:{type:"default"},on:{click:function(t){return e.beforeDialogCloseHandle()}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.submitUpload}},[e._v("上传")])],1)],2)},n=[],r=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("ac6a"),a("456d"),a("c5f6"),a("ed08")),l=a("054f"),o=a("5f87"),c=a("3786"),u={name:"cui-upload",props:{multiple:Boolean,listType:{type:String,default:"text"},accept:{type:String,default:"image/jpeg,image/gif,image/png"},tip:String,limit:Number,beforeUpload:Function,validFile:Function},data:function(){return{uploadUrl:"",previewUrl:"",previewTitle:"图片预览",visible:!1,previewVisible:!1,reqs:{},uploadToken:""}},computed:{submitting:function(){return Object.keys(this.reqs).length>0}},methods:{isImage:function(e){return-1!==e.indexOf("image")},toggleBrowse:function(){this.visible=!this.visible},afterDialogCloseHandle:function(){this.$refs["upload"].clearFiles()},beforeDialogCloseHandle:function(){var e=this;if(this.submitting)return this.$confirm("文件上传中，是否取消上传？","提示",{type:"warning",confirmButtonText:"继续上传",cancelButtonText:"取消上传并退出"}).then(s["i"]).catch(function(){e.clearReqs(null,function(){e.visible=!1})}),!1;this.visible=!1},exceedHandle:function(){this.$alert("超过最大文件数，请移除多余文件！","提示",{type:"warning"}).catch(s["i"])},beforeRemoveHandle:function(e){return this.$confirm("确定移除文件[".concat(e.name,"]？"),"移除文件")},clearReqs:function(e,t){if(e)this.reqs[e]["abort"](),this.$delete(this.reqs,e);else for(var a in this.reqs)this.reqs[a].abort();t()},previewHandle:function(e){var t=this,a=e.raw.type,i=e.url,n=e.name;this.isImage(a)&&i&&(this.previewUrl=i,this.previewTitle=n||this.previewTitle,this.$nextTick(function(){t.previewVisible=!0}))},successHandle:function(e,t,a){this.$emit("on-upload-success",e,t,a)},submitUpload:function(){if(!this.submitting){var e=this.$refs["upload"];e&&(e.uploadFiles.length?this.$refs["upload"].submit():this.$alert("请选择需要上传的文件！","提示",{type:"warning"}).catch(s["i"]))}},uploadFileWithQiniu:function(e){var t=this,a=e.file,i=e.onSuccess,n=e.onError,r=e.onProgress,s=a.uid,c=function(){t.$delete(t.reqs,s)},u=function(){c(),i.apply(void 0,arguments)},d=function(){c();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];401===t[0].code&&o["a"].logout("登录失效，是否前往登录页重新登录？","重新登录",{confirmButtonText:"重新登录",showCancelButton:!1}),n.apply(void 0,t)},m=function(e){var t=e.total;r(t)},p=Object(l["a"])(this.uploadToken,a,u,d,m);return this.$set(this.reqs,s,p),p.abort=function(){c(),p.unsubscribe()},p},refreshUploadToken:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["b"])();case 2:t=e.sent,a=t.data,this.uploadToken=a;case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.refreshUploadToken()}},d=u,m=a("2877"),p=Object(m["a"])(d,i,n,!1,null,null,null);t["a"]=p.exports},a25d:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-with-search",{ref:"wrapper",staticClass:"page-dynamic",attrs:{"search-params":e.search,"remote-method":e.getGroupList,pages:"",scroll:""},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.data;return[a("div",{staticClass:"card-box clearfix"},e._l(i,function(t,i){return a("group-card",{key:t.id,attrs:{item:t},on:{edit:function(a){return e.addOrUpdateHandle(t,i)},delete:function(a){return e.deleteHandle(t,i)},recommend:function(a){return e.putOrDeleteRecommend(t,i)},excellent:function(a){return e.putOrDeleteExcellent(t,i)},waterDetail:function(a){return e.showWaterDetail(t)},searchHandle:e.searchHandle}})}),1),e.showAddOrUpdate?a("add-or-update",{ref:"addOrUpdate"}):e._e(),e.waterListVisible?a("water-list",{ref:"waterList"}):e._e(),e.waterDetailVisible?a("water-detail",{ref:"waterDetail"}):e._e()]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:"",model:e.search,"label-suffix":"："}},[a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入社区（群）名称",clearable:""},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("群名称")])])],1),a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入社区（群）号",clearable:""},model:{value:e.search.number,callback:function(t){e.$set(e.search,"number",t)},expression:"search.number"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("群号")])])],1),a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入社区（群）创建人",clearable:""},model:{value:e.search.owner,callback:function(t){e.$set(e.search,"owner",t)},expression:"search.owner"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("创建人")])])],1),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择排序类型"},on:{change:e.searchHandle},model:{value:e.search.sort_order,callback:function(t){e.$set(e.search,"sort_order",t)},expression:"search.sort_order"}},e._l(e.sortOpts,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.searchHandle()}}},[e._v("查询")]),a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(t){return e.addOrUpdateHandle()}}},[e._v("新增")]),a("el-button",{attrs:{type:"success"},on:{click:e.showWaterList}},[e._v("升级流水列表")])],1),a("el-form-item",[a("el-radio-group",{on:{change:e.searchHandle},model:{value:e.search.type,callback:function(t){e.$set(e.search,"type",t)},expression:"search.type"}},[a("el-radio",{attrs:{label:""}},[e._v("全部")]),a("el-radio",{attrs:{label:"group"}},[e._v("社群")]),a("el-radio",{attrs:{label:"community"}},[e._v("社区")])],1)],1),a("el-form-item",[a("el-radio-group",{on:{change:e.searchHandle},model:{value:e.search.from,callback:function(t){e.$set(e.search,"from",t)},expression:"search.from"}},[a("el-radio",{attrs:{label:-1}},[e._v("全部")]),a("el-radio",{attrs:{label:1}},[e._v("用户自身创建")]),a("el-radio",{attrs:{label:2}},[e._v("官方创建")]),a("el-radio",{attrs:{label:3}},[e._v("第三方创建")])],1)],1),a("el-form-item",[a("el-switch",{staticStyle:{"margin-left":"32px"},attrs:{"active-value":1,"inactive-value":-1,"active-text":"只显示推荐社区（群）"},on:{change:e.searchHandle},model:{value:e.search.recommend,callback:function(t){e.$set(e.search,"recommend",t)},expression:"search.recommend"}}),a("el-switch",{staticStyle:{"margin-left":"32px"},attrs:{"active-value":1,"inactive-value":-1,"active-text":"只显示优秀社区"},on:{change:e.searchHandle},model:{value:e.search.excellent,callback:function(t){e.$set(e.search,"excellent",t)},expression:"search.excellent"}}),a("el-switch",{staticStyle:{"margin-left":"32px"},attrs:{"active-value":1,"inactive-value":-1,"active-text":"只显示封禁社区（群）"},on:{change:e.searchHandle},model:{value:e.search.forbidden,callback:function(t){e.$set(e.search,"forbidden",t)},expression:"search.forbidden"}})],1),a("el-form-item",{staticClass:"f-right",attrs:{label:"社区（群）总数"}},[a("span",{staticStyle:{"font-size":"35px",color:"burlywood"}},[e._v(e._s(e.total))])])],1)],1)],2)},n=[],r=(a("7f7f"),a("cebc")),s=a("a8db"),l=a("c1fb");function o(e){return l["a"].get("group",{params:e})}function c(e){var t=e.id,a=Object(s["a"])(e,["id"]),i={data:a,url:"group/".concat(t||""),method:t?"PUT":"POST"};return Object(l["a"])(i)}function u(e){return l["a"].delete("group/".concat(e))}function d(e){return l["a"].put("group/recommend/".concat(e))}function m(e){return l["a"].put("group/excellent/".concat(e))}function p(e){var t=e.id,a=Object(s["a"])(e,["id"]);return l["a"].put("group/from/".concat(t),Object(r["a"])({},a))}function f(e){var t=e.id,a=Object(s["a"])(e,["id"]);return l["a"].patch("group/".concat(t,"/forbidden"),a)}function h(e){return l["a"].get("group/detail",{params:e})}function b(e){return l["a"].get("group/detail/".concat(e))}var g=a("ed08"),v=a("f9a8"),y=a.n(v),_=a("11c1"),w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:""+e.action+e.typeName,"close-on-click-modal":!1,visible:e.visible,width:"650px"},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"dataForm",staticClass:"m-auto",staticStyle:{width:"500px"},attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"110px","label-suffix":"："},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{prop:"id"}}),a("el-form-item",{attrs:{prop:"type",label:"群类型",required:""}},[a("el-radio-group",{attrs:{disabled:e.isEdit},model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},[a("el-radio",{attrs:{label:"group"}},[e._v("社群")]),a("el-radio",{attrs:{label:"community"}},[e._v("社区")])],1)],1),a("el-form-item",{attrs:{prop:"owner",label:"创建人"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入内容",clearable:""},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[a("div",{staticClass:"cui-userbox",staticStyle:{margin:"5px 0"}},[a("img",{staticClass:"cui-userbox__avatar",attrs:{src:e.getImageUrlByKey(i.avatar)||e.defaultUserAvatar,alt:i.name}}),a("div",{staticClass:"cui-userbox__wrapper",staticStyle:{display:"flex","flex-direction":"column","margin-left":"8px","font-size":"12px"}},[a("span",{staticStyle:{"line-height":"initial"}},[e._v(e._s(i.value=i.name))]),a("span",{staticStyle:{"line-height":"initial"}},[e._v(e._s(i.tel))])])])]}}]),model:{value:e.owner,callback:function(t){e.owner=t},expression:"owner"}})],1),a("el-form-item",{attrs:{prop:"avatar",label:e.typeName+"头像"}},[a("image-upload-wrapper",{attrs:{url:e.dataForm.avatar},on:{click:function(t){return e.toggleUploadBrowse("avatar")}}})],1),a("el-form-item",{attrs:{prop:"name",label:e.typeName+"名称"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入"+e.typeName+"名称",clearable:""},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1),a("el-form-item",{attrs:{prop:"describe",label:e.typeName+"描述"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输"+e.typeName+"描述",rows:"4"},model:{value:e.dataForm.describe,callback:function(t){e.$set(e.dataForm,"describe",t)},expression:"dataForm.describe"}})],1),a("el-form-item",{attrs:{prop:"background",label:"背景主题"}},[a("image-upload-wrapper",{attrs:{url:e.dataForm.background,paddingTop:"160%"},on:{click:function(t){return e.toggleUploadBrowse("bg")}}})],1),a("el-form-item",{attrs:{prop:"sort",label:"排序"}},[a("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.dataForm.sort,callback:function(t){e.$set(e.dataForm,"sort",t)},expression:"dataForm.sort"}})],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:e.submitting,loading:e.submitting},on:{click:function(t){return e.submitHandle()}}},[e._v("确定")])],1),a("cui-upload",{ref:"cui-upload",attrs:{listType:"picture"},on:{"on-upload-success":e.imageChangeHandle}})],2)},x=[],$=a("c24f"),k=a("054f"),O=a("9dac"),H={name:"AddOrUpdate",inject:["searchHandle","changeItem"],components:{cuiUpload:O["a"]},data:function(){return{dataForm:{id:0,name:"",owner:"",type:"group",avatar:"",describe:"",background:"",sort:0},dataRule:{name:[{required:!0,message:"群名称不能为空",trigger:"blur"}],owner:[{required:!0,message:"请选择管理员",trigger:"change"}],avatar:[{required:!0,message:"请选择头像",trigger:"blur"}]},userList:[],visible:!1,submitting:!1,imgType:"bg",defaultUserAvatar:y.a,index:0,timer:null,owner:""}},computed:{adminName:function(){return"group"===this.dataForm.type?"社群群主":"社区创始人"},typeName:function(){return"group"===this.dataForm.type?"社群":"社区"},isEdit:function(){return!!this.dataForm.id},action:function(){return this.dataForm.id?"修改":"新增"}},methods:{querySearchAsync:function(e,t){if(!e)return t(this.userList);this.timer&&clearTimeout(this.timer);var a=/^1[3-9]\d{0,9}$/,i="",n="";a.test(e)?n=e:i=e,this.timer=setTimeout(function(){Object($["f"])({name:i,phone:n}).then(function(e){var a=e.data.data;t(a)})},1500)},handleSelect:function(e){this.dataForm.owner=e.id},getImageUrlByKey:k["b"],init:function(e,t){var a=this;this.visible=!0,this.getUserList(),this.$nextTick(function(){if(a.$refs["dataForm"].resetFields(),e&&e.id){a.index=t;var i=e.owner.id;Object(g["a"])(a.dataForm,Object(r["a"])({},e,{owner:i}))}})},toggleUploadBrowse:function(e){this.imgType=e,this.$refs["cui-upload"]["toggleBrowse"]()},imageChangeHandle:function(e){var t=this,a=e.filename;this.$message.success("图片上传成功！"),this.$refs["cui-upload"]["toggleBrowse"](),this.$nextTick(function(){switch(t.imgType){case"avatar":t.dataForm.avatar=a;break;case"bg":t.dataForm.background=a}})},submitHandle:function(){var e=this;this.submitting||(this.submitting=!0,this.$refs["dataForm"].validate(function(t){t?c(e.dataForm).then(function(t){var a=t.message,i=void 0===a?"".concat(e.action,"社区成功！"):a;e.$message.success(i),e.visible=!1,e.dataForm.id?e.changeItem(e.index,Object(r["a"])({},e.dataForm,{owner:{name:e.dataForm.name,id:e.dataForm.owner}})):e.searchHandle()}).catch(function(t){var a=t.message,i=void 0===a?"".concat(e.action,"社区失败！"):a;e.$message.error(i)}).finally(function(){e.submitting=!1}):e.submitting=!1}))},getUserList:function(){var e=this;this.userList.length||Object($["f"])().then(function(t){var a=t.data.data;e.userList=a})}}},C=H,D=a("2877"),T=Object(D["a"])(C,w,x,!1,null,null,null),j=T.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.title,top:"3vh",visible:e.visible,width:"1000px","append-to-body":""},on:{"update:visible":function(t){e.visible=t}}},[a("cui-page",[a("cui-table",{attrs:{data:e.list,loading:e.loading}},[a("el-table-column",{attrs:{prop:"extend.upgrade_level",label:"购买等级",align:"center"}}),a("el-table-column",{attrs:{prop:"title",label:"备注",align:"center"}}),a("el-table-column",{attrs:{prop:"coin",label:"币种类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.coin;return[e._v(e._s(e.ctType[a]))]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"金额",align:"center"}}),a("el-table-column",{attrs:{prop:"created_at",label:"购买日期",align:"center"}}),a("el-table-column",{attrs:{prop:"extend.end_date",label:"到期时间",align:"center"}})],1),a("cui-pagination",e._b({staticStyle:{"margin-top":"10px"},attrs:{total:e.pages.total,limit:e.pages.limit},on:{"size-change":e.limitChangeHandle,"current-change":e.currentChangeHandle}},"cui-pagination",e.pages,!1))],1)],1)},S=[],U={name:"waterDetail",data:function(){return{visible:!1,loading:!1,id:0,pages:{total:0,page:1,limit:10},list:[],name:"",ctType:{ct:"CT（矿石）",cny:"现金"}}},computed:{title:function(){return"【".concat(this.name,"】流水明细")}},methods:{init:function(e){var t=e.name,a=e.id;this.visible=!0,this.name=t,this.id=a,this.updateDataHandle()},currentChangeHandle:function(e){this.pages.page=e,this.updateTableData()},limitChangeHandle:function(e){this.pages.limit=e,this.updateTableData()},updateDataHandle:function(){var e=this;this.loading||(this.loading=!0,b(this.id).then(function(t){var a=t.data,i=a.data,n=a.total;e.list=i,e.pages.total=n}).catch(function(t){var a=t.message,i=void 0===a?"获取列表流水失败!":a;e.$message.error(i)}).finally(function(){e.loading=!1}))}}},I=U,L=Object(D["a"])(I,F,S,!1,null,null,null),E=L.exports,B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"社区（群）升级流水列表",top:"3vh",visible:e.visible,"close-on-click-modal":!1,width:"1000px"},on:{"update:visible":function(t){e.visible=t}}},[a("cui-page",[a("el-form",{attrs:{size:"mini",model:e.search,"label-width":"90px","label-suffix":"：",inline:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.currentChangeHandle(1)}}},[a("el-form-item",[a("el-input",{attrs:{clearable:""},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("社区（群）名称")])])],1),a("el-form-item",[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"——","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.currentChangeHandle(1)}}},[e._v("查询")])],1),a("el-form-item",[a("h3",{staticClass:"m-auto d-inline-block"},[e._v("金额统计")]),a("span",{staticStyle:{"margin-left":"1em"}},[a("b",[e._v("现金：")]),a("el-button",{staticStyle:{"margin-left":"1em"},attrs:{type:"text"}},[e._v(e._s(+e.moneyType.cny||0))]),a("b",{staticStyle:{"margin-left":"20px"}},[e._v("CT(矿石)：")]),a("el-button",{staticStyle:{"margin-left":"1em"},attrs:{type:"text"}},[e._v(e._s(+e.moneyType.ct||0))])],1)])],1),a("cui-table",{attrs:{data:e.list,loading:e.loading}},[a("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),a("el-table-column",{attrs:{label:"社区（群）信息"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return a("div",{staticClass:"cui-userbox"},[a("img",{directives:[{name:"pic",rawName:"v-pic",value:{img:i.avatar},expression:"{ img: row.avatar }"}],staticClass:"cui-userbox__avatar",attrs:{alt:i.name}}),a("span",{staticClass:"cui-userbox__name"},[e._v(e._s(i.name))])])}}])}),a("el-table-column",{attrs:{prop:"level",label:"等级",align:"center"}}),a("el-table-column",{attrs:{prop:"expired_at",label:"到期时间",width:"180px",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"状态",width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row.status;return[a("el-tag",{attrs:{type:e.statusOptions[i]["tag"]}},[e._v(e._s(e.statusOptions[i]["name"]))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.showDialog(i)}}},[e._v("升级流水明细")])],1)]}}])})],1),a("cui-pagination",e._b({staticStyle:{"margin-top":"10px"},attrs:{total:e.pages.total,limit:e.pages.limit},on:{"size-change":e.limitChangeHandle,"current-change":e.currentChangeHandle}},"cui-pagination",e.pages,!1)),e.waterDetailVisible?a("water-detail",{ref:"waterDetail"}):e._e()],1)],1)},R=[],q=(a("ac6a"),a("456d"),a("386d"),{name:"water-list",components:{waterDetail:E},data:function(){return{list:[],moneyType:{ct:0,cny:0},search:{start:"",end:"",name:""},pages:{total:0,page:1,limit:10},statusOptions:["",{name:"有效",tag:"success"},{name:"已过期",tag:"warning"}],waterDetailVisible:!1,visible:!1,loading:!1}},computed:{time:{get:function(){var e=this.search,t=e.start,a=e.end;return t&&a?[t,a]:""},set:function(e){e?(this.search.start=e[0],this.search.end=e[1]):this.search.start=this.search.end=""}}},methods:{updateTableData:function(){var e=this;this.loading||(this.loading=!0,h(Object(r["a"])({},this.search,this.pages)).then(function(t){var a=t.data,i=a.total,n=a.groups,r=n.data,s=n.total;e.moneyType=Object(g["b"])(i),e.pages.total=s,e.list=r}).catch(function(t){var a=t.message,i=void 0===a?"获取列表流水失败!":a;e.$message.error(i)}).finally(function(){e.loading=!1}))},currentChangeHandle:function(e){this.pages.page=e,this.updateTableData()},limitChangeHandle:function(e){this.pages.limit=e,this.pages.page=1,this.updateTableData()},reset:function(){var e=this;Object.keys(this.search).map(function(t){e.search[t]=""}),this.pages.page=1,this.pages.limit=10},init:function(){this.visible=!0,this.reset(),this.updateTableData()},showDialog:function(e){var t=this;this.waterDetailVisible=!0,this.$nextTick(function(){t.$refs.waterDetail&&t.$refs.waterDetail.init(e)})}}}),N=q,V=Object(D["a"])(N,B,R,!1,null,null,null),A=V.exports,P=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card",style:{backgroundImage:"url("+e.bgUrl+")",height:"550px"}},[a("div",{staticClass:"card__actions"},[a("el-dropdown",{attrs:{placement:"bottom-start"},on:{command:e.moreActionHandle}},[a("i",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer"}}),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"waterDetail"}},[e._v("升级流水明细")])],1)],1)],1),a("div",{staticClass:"card__body"},[a("div",{staticClass:"card__hd clearfix"},[a("div",{staticClass:"userbox"},[a("div",{directives:[{name:"pic",rawName:"v-pic",value:{img:e.item.avatar,error:e.defaultUserAvatar},expression:"{ img: item.avatar, error: defaultUserAvatar }"}],staticClass:"avatar f-left"}),a("div",{staticClass:"user-info f-left"},[a("div",{staticClass:"user-name"},[a("span",[e._v(e._s(e.item.name))]),a("span",{staticClass:"user-level"},[e._v("LV"+e._s(e.item.level))])]),a("el-tag",{staticClass:"user-num",attrs:{type:e.typeOpt[e.item.type]["tag"],effect:"plain"}},[e._v(e._s(e.typeOpt[e.item.type]["name"]))])],1)])]),a("div",{staticClass:"card__content clearfix"},[a("div",{staticClass:"card__text"},[a("span",[e._v("ID：")]),a("span",[e._v(e._s(e.item.id))])]),a("div",{staticClass:"card__text"},[a("span",[e._v("创建人：")]),a("span",[e._v(e._s(e.adminName))])]),a("div",{staticClass:"card__text"},[a("span",[e._v("社群号：")]),a("span",[e._v(e._s(e.item.number))])]),a("div",{staticClass:"card__text"},[a("span",[e._v("群人数：")]),a("span",[e._v(e._s(e.item.member_count))])]),a("div",{staticClass:"card__text"},[a("span",[e._v("群排序：")]),a("span",[e._v(e._s(e.item.sort||0))])]),a("div",{staticClass:"card__text"},[a("span",[e._v(e._s(e.typeOpt[e.item.type]["name"])+"来源：")]),a("span",[e._v(e._s(e.fromOpt[e.item.from]))])]),a("div",{staticClass:"card__text"},[a("span",[e._v(e._s(e.typeOpt[e.item.type]["name"])+"简介：")]),a("span",[e._v(e._s(e.describe))])]),a("div",{staticClass:"card__text"},[a("span",[e._v("创建时间：")]),a("span",[e._v(e._s(e.item.created_at))])]),a("div",{staticClass:"card__text"},[a("span",[e._v("封禁至：")]),a("span",[e._v(e._s(e.item.forbidden?e.item.forbidden_time:"--"))])])]),a("div",{staticClass:"card__foot w-100"},[a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"text",icon:"el-icon-edit",title:"编辑"},on:{click:e.editHandle}})],1),a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"text",icon:"el-icon-delete",title:"删除"},on:{click:e.deleteHandle}})],1),a("div",{staticClass:"btn",class:{"btn--active":!!e.item.recommend}},[a("el-button",{attrs:{type:"text",icon:"el-icon-collection-tag",title:e.item.recommend?"取消推荐":"设置推荐"},on:{click:e.recommendHandle}})],1),"community"===e.item.type?a("div",{staticClass:"btn",class:{"btn--active":!!e.item.excellent}},[a("el-button",{attrs:{type:"text",icon:"el-icon-medal",title:e.item.excellent?"取消优秀":"设置优秀"},on:{click:e.excellentHandle}})],1):e._e(),a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"text",icon:e.statusOptions[e.item.forbidden]["icon"],title:e.statusOptions[e.item.forbidden]["btnName"]},on:{click:e.beforeDisableOrOpen}})],1),a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"text",icon:"el-icon-s-tools",title:"设置来源"},on:{click:e.fromHandle}})],1)]),a("el-dialog",{attrs:{title:"设置【"+e.item.name+"】来源",visible:e.visible,width:"400px","append-to-body":""},on:{"update:visible":function(t){e.visible=t}}},[a("el-radio-group",{model:{value:e.item.from,callback:function(t){e.$set(e.item,"from",t)},expression:"item.from"}},[a("el-radio",{attrs:{label:1}},[e._v("用户自身创建")]),a("el-radio",{attrs:{label:2}},[e._v("官方创建")]),a("el-radio",{attrs:{label:3}},[e._v("第三方创建")])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitFrom}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"封禁【"+e.item.name+"】",visible:e.forbiddenVisible,width:"400px","append-to-body":""},on:{"update:visible":function(t){e.forbiddenVisible=t}}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"封禁至","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.forbidden_time,callback:function(t){e.forbidden_time=t},expression:"forbidden_time"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.disableOrOpenSubmit}},[e._v("确 定")])],1)],1)],1)])},z=[],W=a("af5a"),M=a.n(W),G=a("3beb"),K=a.n(G),J={name:"GroupCard",props:{item:{type:Object,required:!0}},data:function(){return{groupDefault:M.a,communityDefault:K.a,defaultUserAvatar:y.a,visible:!1,from:1,loading:!0,maxNameL:15,maxDescribeL:28,fromOpt:["","用户自身创建","官方创建","第三方创建"],typeOpt:{group:{tag:"warning",name:"社群"},community:{tag:"",name:"社区"}},statusOptions:[{name:"正常",type:"success",btnName:"禁用",btnType:"danger",methodType:"disable",icon:"el-icon-circle-close"},{name:"禁用",type:"danger",btnName:"启用",btnType:"success",methodType:"usable",icon:"el-icon-circle-check"}],forbidden_time:null,forbiddenVisible:!1}},computed:{bgUrl:function(){var e=this.item,t=e.background,a=e.type,i="group"===a?this.groupDefault:this.communityDefault;return t?this.getImageUrlByKey(t):i},adminName:function(){var e=this.item.owner.name,t=this.maxNameL;return e.length>t?e.substr(0,t)+"...":e},describe:function(){var e=this.item.describe,t=this.maxDescribeL;return e?e.length>t?e.substr(0,t)+"...":e:"暂无简介"}},methods:{moreActionHandle:function(e){switch(e){case"waterDetail":this.$emit("waterDetail");break}},disableOrOpenSubmit:function(){var e=this,t=this.forbidden_time,a=(new Date).getTime(),i=new Date(t).getTime();if(!(a<i))return this.$message.error("封禁时间必须大于当前时间！");f({id:this.item.id,forbidden_time:t}).then(function(){e.forbiddenVisible=!1,e.$message.success("封禁成功！"),e.$set(e.item,"forbidden_time",t),e.$set(e.item,"forbidden",1)}).catch(function(t){var a=t.message,i=void 0===a?"封禁失败！":a;e.$message.error(i)})},beforeDisableOrOpen:function(){var e=this,t=this.item.forbidden;if(t)return this.$confirm("确认解禁「".concat(this.item.name,"」?"),"解禁").then(function(){f({id:e.item.id,forbidden_time:null}).then(function(){e.$message.success("解禁成功！"),e.$set(e.item,"forbidden_time",null),e.$set(e.item,"forbidden",0)}).catch(function(t){var a=t.message,i=void 0===a?"封禁失败！":a;e.$message.error(i)})}).catch(function(){});this.forbidden_time=null,this.forbiddenVisible=!0},getImageUrlByKey:k["b"],editHandle:function(){this.$emit("edit")},deleteHandle:function(){this.$emit("delete")},recommendHandle:function(){this.$emit("recommend")},excellentHandle:function(){this.$emit("excellent")},fromHandle:function(){this.visible=!0},submitFrom:function(){var e=this;p({id:this.item.id,from:this.item.from}).then(function(t){var a=t.message,i=void 0===a?"操作成功！":a;e.$message.success(i),e.$emit("searchHandle"),e.visible=!1}).catch(function(t){var a=t.message,i=void 0===a?"操作失败！":a;e.$message.error(i)})}},mounted:function(){var e=this;setTimeout(function(){e.loading=!1},500)}},Q=J,X=Object(D["a"])(Q,P,z,!1,null,null,null),Y=X.exports,Z={name:"Group",components:{listWithSearch:_["a"],addOrUpdate:j,waterDetail:E,waterList:A,groupCard:Y},provide:function(){return{searchHandle:this.searchHandle,changeItem:this.changeItem}},data:function(){return{total:0,search:{name:"",number:null,owner:"",type:"",recommend:null,excellent:-1,from:-1,sort_order:"id",forbidden:-1},sortOpts:[{label:"时间排序",value:"id"},{label:"群排序",value:"sort"},{label:"人数降序",value:"member_count"}],typeOpt:{group:{tag:"success",name:"社群"},community:{tag:"primary",name:"社区"}},defaultAvatar:y.a,showAddOrUpdate:!1,waterListVisible:!1,waterDetailVisible:!1}},methods:{showWaterDetail:function(e){var t=this;this.waterDetailVisible=!0,this.$nextTick(function(){t.$refs["waterDetail"]&&t.$refs["waterDetail"].init(e)})},showWaterList:function(){var e=this;this.waterListVisible=!0,this.$nextTick(function(){e.$refs["waterList"]&&e.$refs["waterList"].init()})},getGroupList:function(){var e=this;return o(arguments.length<=0?void 0:arguments[0]).then(function(t){var a=t.data.total;return e.total=a,t})},searchHandle:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].searchHandle()},changeItem:function(e,t){this.$refs["wrapper"]&&this.$refs["wrapper"].changeItem(e,t)},deleteItem:function(e){this.$refs["wrapper"]&&this.$refs["wrapper"].deleteItem(e)},putOrDeleteExcellent:function(e,t){var a=this,i=e.name,n=e.id,r=e.excellent,s=r?"取消":"设置";this.$confirm("确认".concat(s,"「").concat(i,"」优秀？"),"".concat(s,"优秀")).then(function(){m(n).then(function(e){var i=e.message,n=void 0===i?"操作成功！":i;a.$message.success(n),a.changeItem(t,{excellent:+!r})}).catch(function(e){var t=e.message,i=void 0===t?"操作失败！":t;a.$message.error(i)})}).catch(g["i"])},putOrDeleteRecommend:function(e,t){var a=this,i=e.name,n=e.id,r=e.recommend,s=r?"取消":"设置";this.$confirm("确认".concat(s,"「").concat(i,"」推荐？"),"".concat(s,"推荐")).then(function(){d(n).then(function(e){var i=e.message,n=void 0===i?"操作成功！":i;a.$message.success(n),a.changeItem(t,{recommend:+!r})}).catch(function(e){var t=e.message,i=void 0===t?"操作失败！":t;a.$message.error(i)})}).catch(g["i"])},addOrUpdateHandle:function(e,t){var a=this;this.showAddOrUpdate=!0,this.$nextTick(function(){a.$refs["addOrUpdate"]&&a.$refs["addOrUpdate"].init(e,t)})},deleteHandle:function(e,t){var a=this,i=e.name,n=e.id,r=e.type,s="group"===r?"群":"区";this.$confirm("确认删除社".concat(s,"「").concat(i,"」？"),"删除社".concat(s)).then(function(){u(n).then(function(e){var i=e.message,n=void 0===i?"删除成功！":i;a.$message.success(n),a.deleteItem(t)}).catch(function(e){var t=e.message,i=void 0===t?"删除失败！":t;a.$message.error(i)})}).catch(g["i"])},avatarError:function(e){e.target.src=y.a}},activated:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].resetScroll()}},ee=Z,te=Object(D["a"])(ee,i,n,!1,null,null,null);t["default"]=te.exports},a8db:function(e,t,a){"use strict";var i=a("e265"),n=a.n(i),r=a("a4bb"),s=a.n(r);function l(e,t){if(null==e)return{};var a,i,n={},r=s()(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}function o(e,t){if(null==e)return{};var a,i,r=l(e,t);if(n.a){var s=n()(e);for(i=0;i<s.length;i++)a=s[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}a.d(t,"a",function(){return o})},af5a:function(e,t,a){e.exports=a.p+"img/group-default.0ad123e6.png"},c24f:function(e,t,a){"use strict";a.d(t,"f",function(){return s}),a.d(t,"a",function(){return l}),a.d(t,"c",function(){return o}),a.d(t,"h",function(){return c}),a.d(t,"g",function(){return u}),a.d(t,"e",function(){return d}),a.d(t,"i",function(){return m}),a.d(t,"b",function(){return p}),a.d(t,"j",function(){return f}),a.d(t,"d",function(){return h}),a.d(t,"k",function(){return b});var i=a("cebc"),n=a("a8db"),r=a("c1fb");function s(e){return r["a"].get("users",{params:e})}function l(e){var t=e.id,a=Object(n["a"])(e,["id"]),i={data:a,url:"users/".concat(t||""),method:t?"PUT":"POST"};return Object(r["a"])(i)}function o(e){var t=e.id,a=e.action,i=e.day;return r["a"].put("users/".concat(t,"/").concat(a),{day:i})}function c(e){var t=e.id,a=Object(n["a"])(e,["id"]);return r["a"].get("users/".concat(t,"/wallet/log"),{params:a})}function u(e){return r["a"].get("user/".concat(e,"/wallet"))}function d(e,t){return r["a"].get("user/".concat(e,"/invite"),{params:t})}function m(e){return r["a"].post("user/recommend",Object(i["a"])({},e))}function p(e){return r["a"].delete("user/recommend/".concat(e))}function f(e){return r["a"].put("user/big/name/".concat(e))}function h(e){return Object(r["a"])({url:"user/".concat(e,"/invite/count"),timeout:6e5})}function b(e){return r["a"].patch("user/".concat(e,"/publish-dynamic"))}},f9a8:function(e,t,a){e.exports=a.p+"img/avatar__user.d76349f5.png"}}]);