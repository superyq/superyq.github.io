(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages16"],{"11c1":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cui-page"},[t.$slots["header"]?a("div",{staticClass:"cui-page-header"},[t._t("header")],2):t._e(),t._t("default",null,null,{data:t.data}),t.pages&&!t.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:t.total,limit:t.limit,current:t.page},on:{"size-change":t.limitChangeHandle,"current-change":t.pageChangeHandle}})],1):t._e()],2)},i=[],s=(a("96cf"),a("3b8d")),r=a("cebc"),l=a("20ca"),o={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(t,e){this.$set(this.data,t,Object(r["a"])({},this.data[t],e))},deleteItem:function(t){this.data.splice(t,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.formatSearchParams();case 5:return e=t.sent,t.prev=6,t.next=9,this.remoteMethod(e).then(this.formatSearchResult);case 9:a=t.sent,this.$emit("updateSuccess",a),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),this.$emit("updateFailed",t.t0);case 16:this.loading=!1;case 17:case"end":return t.stop()}},t,this,[[6,13]])}));function e(){return t.apply(this,arguments)}return e}(),formatSearchParams:function(){var t={};return this.pages&&Object.assign(t,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(t,this.searchParams),t},formatSearchResult:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(e){var a,n,i,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.formatResponse){t.next=4;break}return t.next=3,this.formatResponse(e);case 3:e=t.sent;case 4:return a=e,n=a.data,this.pages?(i=n.total,s=n.data,this.scroll?(this.isBottom=s.length<this.limit,this.data=this.data.concat(s)):this.data=s,this.total=i):this.data=n,t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),limitChangeHandle:function(t){this.limit=t,this.updateDataHandle()},pageChangeHandle:function(t){this.page=t,this.updateDataHandle()},scrollHandle:Object(l["a"])(function(){if(!this.isBottom){var t=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;t&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var t=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",t.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=o,d=a("2877"),u=Object(d["a"])(c,n,i,!1,null,null,null);e["a"]=u.exports},"1d5f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("list-with-search",{ref:"wrapper",staticClass:"page-dynamic",attrs:{"search-params":t.search,"remote-method":t.remoteMethod,pages:"",scroll:""},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return[n("ul",{staticClass:"page-dynamic__list"},[0===i.length?n("li",{staticClass:"page-dynamic__list-empty"},[n("img",{attrs:{src:a("ca62")}})]):t._l(i,function(e,a){return n("li",{key:e.id},[n("news-card",{key:e.id,attrs:{item:Object.assign({},e,{index:a})},on:{onEdit:function(n){return t.addOrUpdateHandle(e,a)},onDelete:function(n){return t.deleteHandle(e,a)}}})],1)})],2),t.addOrUpdateVisible?n("add-or-update",{ref:"addOrUpdate"}):t._e()]}}])},[n("template",{slot:"header"},[n("el-form",{attrs:{size:"mini",inline:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchHandle(e)},submit:function(t){t.preventDefault()}}},[n("el-form-item",[n("el-input",{attrs:{placeholder:"请输入快讯标题搜索",clearable:""},model:{value:t.search.title,callback:function(e){t.$set(t.search,"title",e)},expression:"search.title"}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("标题")])])],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.searchHandle()}}},[t._v("查询")]),n("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(e){return t.addOrUpdateHandle()}}},[t._v("新增")])],1),n("el-form-item",[n("news-flash")],1),n("el-form-item",{staticClass:"f-right",attrs:{label:"快讯总数"}},[n("span",{staticStyle:{"font-size":"35px",color:"burlywood"}},[t._v(t._s(t.total))])])],1)],1)],2)},i=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dynamic-item"},[a("div",{staticClass:"dynamic__hd card-wrap"},[a("div",{staticClass:"cui-userbox cui-userbox--large"},[a("h2",{staticClass:"cui-userbox__name news__title",attrs:{title:t.item.title}},[t._v(t._s(t.item.title))])]),a("div",{staticClass:"dynamic__actions"},[a("el-button",{attrs:{size:"mini",circle:"",icon:"el-icon-edit"},on:{click:t.editHandle}}),a("el-button",{attrs:{size:"mini",circle:"",icon:"el-icon-delete"},on:{click:t.deleteHandle}})],1)]),a("div",{staticClass:"dynamic__bd card-wrap"},[a("div",{staticClass:"dynamic__text"},[a("span",[t._v(t._s(t.content.text))]),t.content.isLongTxt?a("a",{attrs:{href:"javascript:;"},on:{click:function(e){t.showAllText=!t.showAllText}}},[t._v(t._s(t.showAllText?"收起":"查看全文"))]):t._e()]),a("div",{staticClass:"dynamic__info"},[a("span",{staticClass:"c-info"},[a("i",{staticClass:"el-icon-aim"}),a("b",[t._v("来源："+t._s(t.item.from))])]),t.item.original_link?a("span",{staticClass:"c-primary location"},[a("i",{staticClass:"el-icon-location-outline"}),a("a",{attrs:{href:t.item.original_link,target:"_blank"}},[t._v("原文链接")])]):t._e(),a("span",{staticClass:"c-info f-right"},[a("i",{staticClass:"el-icon-time"}),a("span",[t._v(t._s(t.item.created_at))])])])]),a("div",{staticClass:"dynamic__ft"},[a("div",{staticClass:"dynamic__count dynamic__count--like"},[a("i",{staticClass:"dynamic__count-icon news__count-icon"}),a("span",[t._v(t._s(t.item.bad_vote))])]),a("div",{staticClass:"dynamic__count dynamic__count--collect"},[a("i",{staticClass:"dynamic__count-icon news__count-icon"}),a("span",[t._v(t._s(t.item.bull_vote))])])])])},r=[],l=(a("c5f6"),{name:"news-card",props:{item:Object,maxLength:{type:Number,default:180}},data:function(){return{showAllText:!1}},computed:{content:function(){var t=this.item.content,e=void 0===t?"":t,a=e.length>this.maxLength;return{isLongTxt:a,text:a?this.showAllText?e:e.substr(0,this.maxLength-3)+"...":e}}},methods:{editHandle:function(){this.$emit("onEdit")},deleteHandle:function(){this.$emit("onDelete")}}}),o=l,c=a("2877"),d=Object(c["a"])(o,s,r,!1,null,null,null),u=d.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"news-falsh"},[a("span",{staticClass:"news-flash__label"},[t._v("是否显示自动拉取配置：")]),a("el-switch",{staticStyle:{"margin-right":"10px"},attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.isShow,callback:function(e){t.isShow=e},expression:"isShow"}}),t.isShow?[a("el-date-picker",{staticStyle:{"margin-right":"10px",width:"320px"},attrs:{type:"datetimerange","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.times,callback:function(e){t.times=e},expression:"times"}}),"on"===t.isOpen?a("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onOrOff("on")}}},[t._v("修改")]):t._e(),a("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onOrOff("off"===t.isOpen?"on":"off")}}},[t._v(t._s(t.btnName))])]:t._e()],2)},h=[],f=a("a8db"),p=a("c1fb");function g(t){return p["a"].get("news",{params:t})}function v(t){var e=t.id,a=Object(f["a"])(t,["id"]),n={data:a,url:"news/".concat(e||""),method:e?"PUT":"POST"};return Object(p["a"])(n)}function _(t){return p["a"].delete("news/".concat(t))}function b(){return p["a"].get("config/news/flash")}function w(t){return p["a"].put("config/news/flash",t)}var x={name:"news-flash",data:function(){return{isShow:!0,isOpen:"off",times:[]}},computed:{btnName:function(){return"on"===this.isOpen?"关闭自动拉取":"开启自动拉取"}},methods:{onOrOff:function(t){if(!this.times&&"on"===t)return this.$message.error("请选择开始日期和结束日期！");this.putNewsFlashHandle(t)},putNewsFlashHandle:function(t){var e=this,a={switch:t,start_time:this.times?this.times[0]:"",end_time:this.times?this.times[1]:""};w(a).then(function(a){var n=a.message,i=void 0===n?"操作成功":n;e.$message.success(i),e.isOpen=t}).catch(function(t){var a=t.message,n=void 0===a?"修改失败！":a;e.$message.error(n)})},getNewsFlashHandle:function(){var t=this;b().then(function(e){var a=e.data.value,n=a.switch,i=a.start_time,s=a.end_time;t.isOpen=n,t.times=[i,s]}).catch(function(e){var a=e.message,n=void 0===a?"获取拉取配置失败!":a;t.$message.error(n)})}},mounted:function(){this.getNewsFlashHandle()}},y=x,k=Object(c["a"])(y,m,h,!1,null,null,null),O=k.exports,H=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.action+"快讯","close-on-click-modal":!1,visible:t.visible,width:"750px"},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"dataForm",staticClass:"m-auto",staticStyle:{width:"600px"},attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"95px","label-suffix":"："}},[a("el-form-item",{staticClass:"d-none",attrs:{prop:"id"}}),a("el-form-item",{attrs:{prop:"title",label:"快讯标题"}},[a("el-input",{attrs:{placeholder:"请输入快讯标题",clearable:""},model:{value:t.dataForm.title,callback:function(e){t.$set(t.dataForm,"title",e)},expression:"dataForm.title"}})],1),a("el-form-item",{attrs:{prop:"content",label:"快讯内容"}},[a("el-input",{attrs:{placeholder:"请输入快讯内容",type:"textarea",rows:6,clearable:""},model:{value:t.dataForm.content,callback:function(e){t.$set(t.dataForm,"content",e)},expression:"dataForm.content"}})],1),a("el-form-item",{attrs:{prop:"original_link",label:"原文链接"}},[a("el-input",{attrs:{placeholder:"例: https://www.immeet.com",clearable:""},model:{value:t.dataForm.original_link,callback:function(e){t.$set(t.dataForm,"original_link",e)},expression:"dataForm.original_link"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:t.submitting,loading:t.submitting},on:{click:function(e){return t.dataFormSubmit()}}},[t._v("确定")])],1)],1)},$=[],C=a("ed08"),F={name:"NewsAddOrUpdate",inject:["searchHandle","changeItem"],computed:{action:function(){return this.dataForm.id?"修改":"新增"}},data:function(){var t=/^([hH][tT]{2}[pP][sS]?:\/\/)((\S+).)+(\S)+$/,e=function(e,a,n){a?t.test(a)?n():n(new Error("这网址不是以http://或https://开头，或者不是网址！")):n()};return{index:0,visible:!1,submitting:!1,dataForm:{id:0,title:"",content:"",original_link:""},dataRule:{title:[{required:!0,message:"快讯标题不能为空",trigger:"blur"}],content:[{required:!0,message:"快讯内容不能为空",trigger:"blur"}],original_link:[{validator:e,trigger:"blur"}]}}},methods:{init:function(t,e){var a=this;this.visible=!0,this.$nextTick(function(){a.$refs["dataForm"].resetFields(),t&&t.id>0&&(Object(C["a"])(a.dataForm,t),a.index=e)})},dataFormSubmit:function(){var t=this;this.submitting||(this.submitting=!0,this.$refs["dataForm"].validate(function(e){e?v(t.dataForm).then(function(e){var a=e.message,n=void 0===a?"操作成功":a;t.visible=!1,t.$message.success(n),t.dataForm.id?t.changeItem(t.index,t.dataForm):t.searchHandle()}).catch(function(e){var a=e.message,n=void 0===a?"操作失败！":a;t.$message.error(n)}).finally(function(){t.submitting=!1}):t.submitting=!1}))}}},S=F,j=Object(c["a"])(S,H,$,!1,null,null,null),E=j.exports,T=a("11c1"),R={name:"News",components:{newsCard:u,newsFlash:O,addOrUpdate:E,listWithSearch:T["a"]},provide:function(){return{searchHandle:this.searchHandle,changeItem:this.changeItem}},data:function(){return{search:{title:""},total:0,addOrUpdateVisible:!1}},methods:{remoteMethod:function(){var t=this;return g(arguments.length<=0?void 0:arguments[0]).then(function(e){return t.total=e.data.total,e})},searchHandle:function(){this.$refs["wrapper"].searchHandle()},changeItem:function(t,e){this.$refs["wrapper"]&&this.$refs["wrapper"].changeItem(t,e)},deleteHandle:function(t,e){var a=this,n=t.id,i=t.title;this.$confirm("确定对快讯「".concat(i,"」进行删除操作？"),"删除快讯",{type:"error"}).then(function(){_(n).then(function(t){var n=t.message,i=void 0===n?"删除成功":n;a.$message.success(i),a.$refs["wrapper"]["data"].splice(e,1)}).catch(function(t){var e=t.message,n=void 0===e?"删除失败！":e;a.$message.error(n)})}).catch(C["i"])},addOrUpdateHandle:function(t,e){var a=this;this.addOrUpdateVisible=!0,this.$nextTick(function(){a.$refs.addOrUpdate.init(t,e)})}},activated:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].resetScroll()}},U=R,N=Object(c["a"])(U,n,i,!1,null,null,null);e["default"]=N.exports},a8db:function(t,e,a){"use strict";var n=a("e265"),i=a.n(n),s=a("a4bb"),r=a.n(s);function l(t,e){if(null==t)return{};var a,n,i={},s=r()(t);for(n=0;n<s.length;n++)a=s[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}function o(t,e){if(null==t)return{};var a,n,s=l(t,e);if(i.a){var r=i()(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(s[a]=t[a])}return s}a.d(e,"a",function(){return o})}}]);