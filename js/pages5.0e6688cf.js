(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages5"],{"2fdb":function(t,e,a){"use strict";var n=a("5ca1"),i=a("d2c8"),r="includes";n(n.P+n.F*a("5147")(r),"String",{includes:function(t){return!!~i(this,t,r).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},"386d":function(t,e,a){"use strict";var n=a("cb7c"),i=a("83a1"),r=a("5f1b");a("214f")("search",1,function(t,e,a,s){return[function(a){var n=t(this),i=void 0==a?void 0:a[e];return void 0!==i?i.call(a,n):new RegExp(a)[e](String(n))},function(t){var e=s(a,t,this);if(e.done)return e.value;var c=n(t),o=String(this),l=c.lastIndex;i(l,0)||(c.lastIndex=0);var u=r(c,o);return i(c.lastIndex,l)||(c.lastIndex=l),null===u?-1:u.index}]})},"456d":function(t,e,a){var n=a("4bf8"),i=a("0d58");a("5eda")("keys",function(){return function(t){return i(n(t))}})},"469f":function(t,e,a){a("6c1c"),a("1654"),t.exports=a("7d7b")},5147:function(t,e,a){var n=a("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[n]=!1,!"/./"[t](e)}catch(i){}}return!0}},"5d73":function(t,e,a){t.exports=a("469f")},"5eda":function(t,e,a){var n=a("5ca1"),i=a("8378"),r=a("79e5");t.exports=function(t,e){var a=(i.Object||{})[t]||Object[t],s={};s[t]=e(a),n(n.S+n.F*r(function(){a(1)}),"Object",s)}},6762:function(t,e,a){"use strict";var n=a("5ca1"),i=a("c366")(!0);n(n.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},"768b":function(t,e,a){"use strict";var n=a("a745"),i=a.n(n);function r(t){if(i()(t))return t}var s=a("5d73"),c=a.n(s);function o(t,e){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=c()(t);!(n=(s=o.next()).done);n=!0)if(a.push(s.value),e&&a.length===e)break}catch(l){i=!0,r=l}finally{try{n||null==o["return"]||o["return"]()}finally{if(i)throw r}}return a}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function u(t,e){return r(t)||o(t,e)||l()}a.d(e,"a",function(){return u})},"7d7b":function(t,e,a){var n=a("e4ae"),i=a("7cd6");t.exports=a("584a").getIterator=function(t){var e=i(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"9dac":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{center:"",width:"500px",title:"文件上传",visible:t.visible,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"cui-upload"},on:{"update:visible":function(e){t.visible=e},close:function(e){return t.afterDialogCloseHandle()}}},[a("el-upload",t._g(t._b({ref:"upload",staticClass:"cui-upload__wrapper",attrs:{limit:t.limit,accept:t.accept,multiple:t.multiple,action:t.uploadUrl,"auto-upload":!1,"list-type":t.listType,"on-exceed":t.exceedHandle,"on-preview":t.previewHandle,"on-success":t.successHandle,"before-upload":t.beforeUpload,"before-remove":t.beforeRemoveHandle,"http-request":t.uploadFileWithQiniu}},"el-upload",t.$attrs,!1),t.$listeners),[a("el-button",{ref:"browse",attrs:{slot:"trigger",size:"small",type:"warning",icon:"el-icon-upload"},slot:"trigger"},[t._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._t("tip",[t._v(t._s(t.tip||"只能上传jpg/png文件，且不超过500kb"))])],2)],1),a("el-dialog",{attrs:{title:t.previewTitle,visible:t.previewVisible,top:"5vh","append-to-body":""},on:{"update:visible":function(e){t.previewVisible=e}}},[a("img",{attrs:{width:"100%",src:t.previewUrl,alt:t.previewTitle}})]),a("template",{slot:"footer"},[a("el-button",{attrs:{type:"default"},on:{click:function(e){return t.beforeDialogCloseHandle()}}},[t._v("关闭")]),a("el-button",{attrs:{type:"primary",loading:t.submitting},on:{click:t.submitUpload}},[t._v("上传")])],1)],2)},i=[],r=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("ac6a"),a("456d"),a("c5f6"),a("ed08")),c=a("054f"),o=a("5f87"),l=a("3786"),u={name:"cui-upload",props:{multiple:Boolean,listType:{type:String,default:"text"},accept:{type:String,default:"image/jpeg,image/gif,image/png"},tip:String,limit:Number,beforeUpload:Function,validFile:Function},data:function(){return{uploadUrl:"",previewUrl:"",previewTitle:"图片预览",visible:!1,previewVisible:!1,reqs:{},uploadToken:""}},computed:{submitting:function(){return Object.keys(this.reqs).length>0}},methods:{isImage:function(t){return-1!==t.indexOf("image")},toggleBrowse:function(){this.visible=!this.visible},afterDialogCloseHandle:function(){this.$refs["upload"].clearFiles()},beforeDialogCloseHandle:function(){var t=this;if(this.submitting)return this.$confirm("文件上传中，是否取消上传？","提示",{type:"warning",confirmButtonText:"继续上传",cancelButtonText:"取消上传并退出"}).then(s["i"]).catch(function(){t.clearReqs(null,function(){t.visible=!1})}),!1;this.visible=!1},exceedHandle:function(){this.$alert("超过最大文件数，请移除多余文件！","提示",{type:"warning"}).catch(s["i"])},beforeRemoveHandle:function(t){return this.$confirm("确定移除文件[".concat(t.name,"]？"),"移除文件")},clearReqs:function(t,e){if(t)this.reqs[t]["abort"](),this.$delete(this.reqs,t);else for(var a in this.reqs)this.reqs[a].abort();e()},previewHandle:function(t){var e=this,a=t.raw.type,n=t.url,i=t.name;this.isImage(a)&&n&&(this.previewUrl=n,this.previewTitle=i||this.previewTitle,this.$nextTick(function(){e.previewVisible=!0}))},successHandle:function(t,e,a){this.$emit("on-upload-success",t,e,a)},submitUpload:function(){if(!this.submitting){var t=this.$refs["upload"];t&&(t.uploadFiles.length?this.$refs["upload"].submit():this.$alert("请选择需要上传的文件！","提示",{type:"warning"}).catch(s["i"]))}},uploadFileWithQiniu:function(t){var e=this,a=t.file,n=t.onSuccess,i=t.onError,r=t.onProgress,s=a.uid,l=function(){e.$delete(e.reqs,s)},u=function(){l(),n.apply(void 0,arguments)},d=function(){l();for(var t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];401===e[0].code&&o["a"].logout("登录失效，是否前往登录页重新登录？","重新登录",{confirmButtonText:"重新登录",showCancelButton:!1}),i.apply(void 0,e)},m=function(t){var e=t.total;r(e)},f=Object(c["a"])(this.uploadToken,a,u,d,m);return this.$set(this.reqs,s,f),f.abort=function(){l(),f.unsubscribe()},f},refreshUploadToken:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["b"])();case 2:e=t.sent,a=e.data,this.uploadToken=a;case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.refreshUploadToken()}},d=u,m=a("2877"),f=Object(m["a"])(d,n,i,!1,null,null,null);e["a"]=f.exports},c24f:function(t,e,a){"use strict";a.d(e,"f",function(){return s}),a.d(e,"a",function(){return c}),a.d(e,"c",function(){return o}),a.d(e,"h",function(){return l}),a.d(e,"g",function(){return u}),a.d(e,"e",function(){return d}),a.d(e,"i",function(){return m}),a.d(e,"b",function(){return f}),a.d(e,"j",function(){return p}),a.d(e,"d",function(){return h}),a.d(e,"k",function(){return v});var n=a("cebc"),i=a("a8db"),r=a("c1fb");function s(t){return r["a"].get("users",{params:t})}function c(t){var e=t.id,a=Object(i["a"])(t,["id"]),n={data:a,url:"users/".concat(e||""),method:e?"PUT":"POST"};return Object(r["a"])(n)}function o(t){var e=t.id,a=t.action,n=t.day;return r["a"].put("users/".concat(e,"/").concat(a),{day:n})}function l(t){var e=t.id,a=Object(i["a"])(t,["id"]);return r["a"].get("users/".concat(e,"/wallet/log"),{params:a})}function u(t){return r["a"].get("user/".concat(t,"/wallet"))}function d(t,e){return r["a"].get("user/".concat(t,"/invite"),{params:e})}function m(t){return r["a"].post("user/recommend",Object(n["a"])({},t))}function f(t){return r["a"].delete("user/recommend/".concat(t))}function p(t){return r["a"].put("user/big/name/".concat(t))}function h(t){return Object(r["a"])({url:"user/".concat(t,"/invite/count"),timeout:6e5})}function v(t){return r["a"].patch("user/".concat(t,"/publish-dynamic"))}},c6e1:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("list-with-search",{ref:"wrapper",staticClass:"page-dynamic",attrs:{pages:"",scroll:"","search-params":t.search,"remote-method":t.remoteMethod},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.data;return[n("ul",{staticClass:"page-dynamic__list"},[0===i.length?n("li",{staticClass:"page-dynamic__list-empty"},[n("img",{attrs:{src:a("ca62")}})]):t._l(i,function(e,a){return n("li",{key:e.id},[n("dynamic-item",{key:e.id,attrs:{item:Object.assign({},e,{index:a})},on:{showComment:function(a){return t.showComment(e)},onEdit:function(n){return t.addOrUpdateHandle(e,a)},onDelete:function(e){return t.deleteDynamicHandle(a)},search:t.searchHandle,ontagChangeHandle:t.tagChangeHandle}})],1)})],2),t.addOrUpdateVisible?n("addOrUpdate",{ref:"addOrUpdate"}):t._e(),t.commentListVisible?n("comment-list",{ref:"commentList"}):t._e()]}}])},[n("template",{slot:"header"},[n("el-form",{attrs:{model:t.search,size:"small",inline:""}},[n("el-form-item",[n("el-input",{attrs:{placeholder:"请输入发布者名称",clearable:""},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("发布者")])])],1),n("el-form-item",[n("el-select",{attrs:{clearable:"",placeholder:"请选择动态类型"},model:{value:t.search.type,callback:function(e){t.$set(t.search,"type",e)},expression:"search.type"}},t._l(t.dynamicTypesMap,function(t){var e=t[0],a=t[1].label;return n("el-option",{key:e,attrs:{value:e,label:a}})}),1)],1),n("el-form-item",[n("el-select",{attrs:{placeholder:"请选择动态标签",clearable:""},on:{change:function(e){return t.searchHandle(0)}},model:{value:t.search.tag,callback:function(e){t.$set(t.search,"tag",e)},expression:"search.tag"}},t._l(t.tag,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})}),1)],1),n("el-form-item",[n("el-button",{attrs:{type:"default",icon:"el-icon-search"},on:{click:function(e){return t.searchHandle(0)}}},[t._v("查询")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.addOrUpdateHandle()}}},[t._v("新增动态")])],1),n("el-form-item",[n("el-checkbox-group",{on:{change:t.filterChangeHandle},model:{value:t.filterOptions,callback:function(e){t.filterOptions=e},expression:"filterOptions"}},[n("el-checkbox",{attrs:{label:"sync"}},[t._v("只显示广场动态")]),n("el-checkbox",{attrs:{label:"recommended"}},[t._v("只显示推荐动态")]),n("el-checkbox",{attrs:{label:"top"}},[t._v("只显示置顶动态")])],1)],1),n("el-form-item",{staticClass:"f-right",attrs:{label:"动态总数"}},[n("span",{staticStyle:{"font-size":"35px",color:"burlywood"}},[t._v(t._s(t.total))])])],1)],1)],2)},i=[],r=(a("6762"),a("2fdb"),a("768b")),s=(a("5df3"),a("cebc")),c=(a("386d"),a("456d"),a("ac6a"),a("f121")),o=a("cb99"),l=a("d28d"),u=a("db3c"),d=a("11c1"),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{top:"8vh",center:!0,visible:t.visible,"show-close":!1,"close-on-click-modal":!1,title:t.action+"动态","custom-class":"dynamic-editor"},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"dataForm",attrs:{size:"mini",model:t.dataForm,rules:t.dataRule}},[a("el-form-item",{attrs:{prop:"user_id"}},[a("el-autocomplete",{attrs:{"fetch-suggestions":t.querySearchAsync,placeholder:"请输入内容",clearable:""},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[a("div",{staticClass:"cui-userbox",staticStyle:{margin:"5px 0"}},[a("img",{staticClass:"cui-userbox__avatar",attrs:{src:t.getImageUrlByKey(n.avatar)||t.defaultUserAvatar,alt:n.name}}),a("div",{staticClass:"cui-userbox__wrapper",staticStyle:{display:"flex","flex-direction":"column","margin-left":"8px","font-size":"12px"}},[a("span",{staticStyle:{"line-height":"initial"}},[t._v(t._s(n.value=n.name))]),a("span",{staticStyle:{"line-height":"initial"}},[t._v(t._s(n.tel))])])])]}}]),model:{value:t.owner,callback:function(e){t.owner=e},expression:"owner"}})],1),a("el-form-item",[a("el-select",{staticClass:"w-100",attrs:{remote:"",multiple:"",filterable:"",size:"mini","reserve-keyword":"","multiple-limit":3,placeholder:"动态话题，最多可选择三个","remote-method":t.fetchTags,loading:t.tagsLoading},model:{value:t.dataForm.tags,callback:function(e){t.$set(t.dataForm,"tags",e)},expression:"dataForm.tags"}},t._l(t.tags,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),a("el-form-item",[a("el-input",{attrs:{type:"textarea",rows:9,placeholder:"动态正文"},model:{value:t.dataForm.content,callback:function(e){t.$set(t.dataForm,"content",e)},expression:"dataForm.content"}}),a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.dataForm.sync_plaza,callback:function(e){t.$set(t.dataForm,"sync_plaza",e)},expression:"dataForm.sync_plaza"}},[t._v("同步至广场")]),a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:t.dataForm.recommended,callback:function(e){t.$set(t.dataForm,"recommended",e)},expression:"dataForm.recommended"}},[t._v("设为推荐")])],1),a("el-form-item",[a("el-button-group",[a("el-button",{attrs:{size:"mini",icon:"el-icon-picture",disabled:1!==t.isCanAddMedia&&2!==t.isCanAddMedia},on:{click:function(e){return t.toggleUploadBrowse("image")}}},[t._v("添加图片")]),a("el-button",{attrs:{size:"mini",icon:"el-icon-video-camera-solid",disabled:1!==t.isCanAddMedia},on:{click:function(e){return t.toggleUploadBrowse("video")}}},[t._v("添加视频")])],1)],1),a("div",{staticClass:"dynamic__media"},[t.images?[a("ul",{staticClass:"dynamic__images"},t._l(t.images,function(e,n){return a("li",{key:n,staticClass:"dynamic__image"},[a("a",{attrs:{href:e,target:"__blank",title:"点击图片查看原图"}},[a("img",{attrs:{src:e}})]),a("div",{staticClass:"dynamic__image-actions"},[a("el-button",{attrs:{size:"mini",type:"danger",circle:"",icon:"el-icon-delete"},on:{click:function(e){return t.imageDeleteHandle(n)}}})],1)])}),0)]:t._e(),t.video?a("div",{staticClass:"dynamic__viedo"},[a("video",{attrs:{controls:"",width:"320",preload:"metadata",poster:t.video.cover,muted:""},domProps:{muted:!0}},[a("source",{attrs:{src:t.video.src,type:"video/mp4"}}),a("p",[t._v("Your browser doesn't support HTML5 video. Here is a"),a("a",{attrs:{href:t.video.src}},[t._v("link to the video")]),t._v("instead.")])])]):t._e()],2)],1),a("cui-upload",t._b({ref:"cui-upload",on:{"on-upload-success":t.mediaChangeHandle}},"cui-upload",t.uploadOptions,!1)),a("template",{slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.beforeSubmitHandle()}}},[t._v(t._s(t.action))])],1)],2)},f=[],p=(a("7f7f"),a("a8db")),h=(a("96cf"),a("3b8d")),v=a("ed08"),g=a("c24f"),b=a("f9a8"),y=a.n(b),_=a("054f"),w=a("2d5d"),x=a("9dac"),O={multiple:!0,limit:9,accept:"image/jpeg,image/gif,image/png",listType:"picture",tip:"只能上传jpg/png文件，且不超过500kb，最多选择9张"},k={multiple:!1,accept:"video/mp4",tip:"只能上传mp4文件"},$={id:0,tags:null,user_id:null,images:null,video:null,content:"",type:0,recommended:0,sync_plaza:0,created_at:""},C={name:"addOrUpdate",components:{cuiUpload:x["a"]},inject:["searchHandle","changeItem"],data:function(){return{visible:!1,dataForm:Object.assign({},$),dataRule:{user_id:[{required:!0,message:"请选择发布用户",trigger:"blur"}],content:[{required:!0,message:"请输入文本内容",trigger:"blur"}]},tags:[],tagsId:[],users:[],tagsLoading:!1,usersLoading:!1,defaultUserAvatar:y.a,mediaType:"image",action:"新增",status:[],index:0,timer:null,owner:""}},computed:{isCanAddMedia:function(){var t=this.dataForm,e=t.video,a=t.images;return null===e&&null===a?1:null===e&&Array.isArray(a)?a.length>0?a.length<9?2:0:1:0},images:function(){var t=this.dataForm.images;return!(null===t||!Array.isArray(t))&&t.map(function(t){var e=t.filename;return Object(_["b"])(e)})},video:{get:function(){var t=this.dataForm.video;if(!t)return!1;var e=t.video.filename,a=t.cover.filename;return{cover:Object(_["b"])(a),src:Object(_["b"])(e)}},set:function(){var t=Object(h["a"])(regeneratorRuntime.mark(function t(e){var a,n,i,r,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a=e.filename,n=e.mime,i="".concat(a,"?vframe/png/offset/1"),t.next=4,Object(w["a"])(Object(_["b"])(i));case 4:r=t.sent,c={cover:Object(s["a"])({mime:"png",cover:i},r),video:{mime:n,filename:a}},this.$set(this.dataForm,"video",c);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},uploadOptions:function(){return"image"===this.mediaType?O:k}},methods:{querySearchAsync:function(t,e){if(!t)return e(this.users);this.timer&&clearTimeout(this.timer);var a=/^1[3-9]\d{0,9}$/,n="",i="";a.test(t)?i=t:n=t,this.timer=setTimeout(function(){Object(g["f"])({name:n,phone:i}).then(function(t){var a=t.data.data;e(a)})},1500)},handleSelect:function(t){this.dataForm.user_id=t.id},getImageUrlByKey:_["b"],init:function(t,e){if(this.visible=!0,this.action="新增",this.dataForm=Object.assign({},$),t){var a=t.tags,n=t.images,i=t.video,r=Object(p["a"])(t,["tags","images","video"]);Object(v["a"])(this.dataForm,r),this.index=e,this.action="修改",this.dataForm.video=i,this.dataForm.tags=(a||[]).map(function(t){return t.id}),this.dataForm.images=Object(v["b"])(n)}},fetchTags:function(t){var e=this;this.tagsLoading||(this.tagsLoading=!0,Object(l["h"])({page_sign:2,name:t}).then(function(t){var a=t.data;e.tags=a,e.tagsId=a.map(function(t){return t.id})}).catch(function(){e.tags=[]}).finally(function(){e.tagsLoading=!1}))},fetchUsers:function(t){var e=this;this.usersLoading||(this.usersLoading=!0,Object(g["f"])({name:t}).then(function(t){var a=t.data.data;e.users=a}).catch(function(){e.users=[]}).finally(function(){e.usersLoading=!1}))},toggleUploadBrowse:function(t){this.mediaType=t,this.$refs["cui-upload"]["toggleBrowse"]()},mediaChangeHandle:function(t){"image"===this.mediaType&&(Array.isArray(this.dataForm.images)||(this.dataForm.images=[]),this.dataForm.images.push(t)),"video"===this.mediaType&&(this.video=t)},imageDeleteHandle:function(t){var e=this;this.$confirm("确定删除这张图片？","删除图片",{type:"warning"}).then(function(){e.dataForm.images.splice(t,1)}).catch(v["i"])},beforeSubmitHandle:function(){var t=this;this.$refs["dataForm"].validate(function(e){if(e){var a=t.dataForm,n=a.images,i=a.video,r=a.content,s=Object(p["a"])(a,["images","video","content"]);if(r&&(s.type=1,s.content=r),Array.isArray(n)&&(s.images=n,s.type=r.length?4:2),i&&(s.video=i,s.type=r.length?5:3),0===s.type)return t.$message.error("动态内容不能为空，请任意添加文字、图片、视频");t.$confirm("确定".concat(t.action,"此动态"),"".concat(t.action,"动态")).then(function(){t.formSubmitHandle(s)}).catch(v["i"])}})},formSubmitHandle:function(t){var e=this;this.submitting||(this.submitting=!0,Object(o["f"])(t).then(function(a){var n=a.message,i=void 0===n?"".concat(e.action,"成功！"):n,r=t.tags;e.visible=!1,e.$message.success(i);var c=[];r.forEach(function(t){c.push({id:e.tags[e.tagsId.indexOf(t)].id,name:e.tags[e.tagsId.indexOf(t)].name})}),e.dataForm.id?e.changeItem(e.index,Object(s["a"])({},t,{tags:c})):e.searchHandle()}).catch(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"失败！"):a;e.$message.error(n)}).finally(function(){e.submitting=!1}))}},mounted:function(){this.fetchTags(),this.fetchUsers()}},j=C,H=a("2877"),T=Object(H["a"])(j,m,f,!1,null,null,null),F=T.exports,U=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{center:"",top:"8vh","append-to-body":"",visible:t.visible,"close-on-click-modal":!1,title:"“"+t.action+"” 动态评论列表"},on:{"update:visible":function(e){t.visible=e}}},[a("list-with-search",{ref:"wrapper",attrs:{pages:"","search-params":t.search,"remote-method":t.remoteMethod},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return t._l(n,function(e){return a("commentItem",{key:e.id,attrs:{comment:e},on:{onDelete:t.deleteHandle}})})}}])})],1)},S=[],I=a("c1fb");function A(t){return I["a"].get("comment",{params:t})}function L(t){return I["a"].delete("comment/".concat(t))}function D(t){return I["a"].get("reply",{params:t})}function z(t){return I["a"].delete("reply/".concat(t))}var E=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment"},[a("div",{staticClass:"comment-user"},[a("div",{staticClass:"cui-userbox cui-userbox--large"},[a("img",{staticClass:"cui-userbox__avatar",attrs:{src:t.avatar}})])]),a("div",{staticClass:"comment-content"},[a("div",{staticClass:"comment-content__hd"},[a("b",[t._v(t._s(t.user.name))]),a("i",[t._v(" #"+t._s(t.user.id))])]),a("div",{staticClass:"comment-content__bd"},[t._v(t._s(t.content))]),a("div",{staticClass:"comment-content__ft"},[a("span",[a("i",{staticClass:"el-icon-time"}),a("b",[t._v(t._s(t.createdAt))])]),a("div",{staticClass:"comment__actions"},[a("el-button",{staticClass:"delete c-danger",attrs:{type:"text"},on:{click:function(e){return t.deleteHandle()}}},[t._v("删除")]),a("el-button",{staticClass:"c-info",attrs:{type:"text"},on:{click:function(e){return t.showReply()}}},[t._v("回复 "+t._s(t.replyCount))])],1)]),a("div",{staticClass:"comment-replies"},[t.replyVisible?a("replyList",{ref:"replyList",attrs:{dynamic:t.id}}):t._e()],1)])])},q=[],V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("list-with-search",{ref:"wrapper",attrs:{pages:"","search-params":t.search,"remote-method":t.remoteMethod},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return t._l(n,function(e){return a("replyItem",{key:e.id,attrs:{reply:e},on:{onDelete:t.deleteHandle}})})}}])})},B=[],M=(a("c5f6"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment"},[a("div",{staticClass:"comment-user"},[a("div",{staticClass:"cui-userbox cui-userbox--large"},[a("img",{staticClass:"cui-userbox__avatar",attrs:{src:t.avatar}})])]),a("div",{staticClass:"comment-content"},[a("div",{staticClass:"comment-content__hd"},[a("b",[t._v(t._s(t.user.name))]),a("i",[t._v(" #"+t._s(t.user.id))])]),a("div",{staticClass:"comment-content__bd"},[t._v(t._s(t.content))]),a("div",{staticClass:"comment-content__ft"},[a("span",[a("i",{staticClass:"el-icon-time"}),a("b",[t._v(t._s(t.createdAt))])]),a("div",{staticClass:"comment__actions"},[a("el-button",{staticClass:"delete c-danger",attrs:{type:"text"},on:{click:function(e){return t.deleteHandle()}}},[t._v("删除")])],1)])])])}),P=[],R={name:"replyItem",props:{reply:Object},computed:{id:function(){return this.reply.id},user:function(){var t=this.reply.user;return t||{}},avatar:function(){var t=this.user.avatar;return t?Object(_["b"])(t):y.a},content:function(){var t=this.reply.content,e=void 0===t?"":t;return e},createdAt:function(){var t=this.reply.created_at;return t}},methods:{deleteHandle:function(){this.$emit("onDelete",this.reply)}}},W=R,K=Object(H["a"])(W,M,P,!1,null,null,null),J=K.exports,N={name:"CommentList",props:{dynamic:Number},components:{replyItem:J,listWithSearch:d["a"]},data:function(){return{visible:!1,commentListVisible:!1,search:{comment_id:this.dynamic},action:"",defaultAvatar:y.a}},methods:{init:function(){var t=this;this.visible=!0,this.$nextTick(function(){t.updateTableData()})},getImageUrlByKey:_["b"],remoteMethod:D,updateTableData:function(){this.$refs["wrapper"]&&this.$refs["wrapper"]["updateDataHandle"]()},deleteHandle:function(t){var e=this,a=t.content,n=t.id;this.$confirm("确定对回复「".concat(a,"」进行删除操作？"),"删除动态",{type:"warning"}).then(function(){z(n).then(function(t){var a=t.message,n=void 0===a?"删除成功":a;e.$message.success(n),e.updateTableData()}).catch(function(t){var a=t.message,n=void 0===a?"删除失效！":a;e.$message.error(n)})}).catch(v["i"])},avatarError:function(t){t.target.src=y.a}}},Q=N,Y=Object(H["a"])(Q,V,B,!1,null,null,null),G=Y.exports,X={name:"comment",components:{replyList:G},props:{comment:Object},computed:{id:function(){return this.comment.id},user:function(){var t=this.comment.user;return t||{}},avatar:function(){var t=this.user.avatar;return t?Object(_["b"])(t):y.a},content:function(){var t=this.comment.content,e=void 0===t?"":t;return e},createdAt:function(){var t=this.comment.created_at;return t},replyCount:function(){var t=this.comment.reply_count,e=void 0===t?0:t;return e}},data:function(){return{replyVisible:!1}},methods:{deleteHandle:function(){this.$emit("onDelete",this.comment)},showReply:function(){var t=this;this.replyVisible=!0,this.$nextTick(function(){t.$refs["replyList"]["init"](t.id)})}}},Z=X,tt=Object(H["a"])(Z,E,q,!1,null,null,null),et=tt.exports,at={name:"CommentList",components:{commentItem:et,listWithSearch:d["a"]},data:function(){return{visible:!1,search:{topic_type:"dynamic",topic_id:0},defaultAvatar:y.a,action:""}},methods:{init:function(t){this.visible=!0;var e=t.id,a=t.user.name;this.search.topic_id=e,this.action=a,this.updateTableData()},remoteMethod:A,updateTableData:function(){this.$refs["wrapper"]&&this.$refs["wrapper"]["updateDataHandle"]()},deleteHandle:function(t){var e=this,a=t.content,n=t.id;this.$confirm("确定对评论「".concat(a,"」进行删除操作？"),"删除评论",{type:"warning"}).then(function(){L(n).then(function(t){var a=t.message,n=void 0===a?"删除成功":a;e.$message.success(n),e.updateTableData()}).catch(function(t){var a=t.message,n=void 0===a?"删除失效！":a;e.$message.error(n)})}).catch(v["i"])}}},nt=at,it=Object(H["a"])(nt,U,S,!1,null,null,null),rt=it.exports,st={name:"dynamic",components:{addOrUpdate:F,commentList:rt,dynamicItem:u["a"],listWithSearch:d["a"]},provide:function(){return{searchHandle:this.searchHandle,changeItem:this.changeItem}},data:function(){return{search:{id:0,name:"",type:"",top:-1,recommended:-1,tag:"",sync_plaza:null},dynamicTypesMap:c["n"],filterOptions:[],tag:[],addOrUpdateVisible:!1,commentListVisible:!1,total:0}},methods:{reset:function(){var t=this;Object.keys(this.search).forEach(function(e){t.search[e]=""}),this.search.id=0,this.search.top=-1,this.search.sync_plaza=null},remoteMethod:function(){for(var t=this,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];a=a[0];var i=0,c=this.$route.params.row||0;if(c){var u=c.target_type;switch(u){case"dynamic":i=c.dynamic.id;break;case"comment":i=c.comment.topic_id;break;case"reply":i=c.reply.topic_id;break}}var d=[Object(o["c"])(Object(s["a"])({},a,{id:i}))];return!this.tag.length&&d.push(Object(l["h"])({page_sign:2})),Promise.all(d).then(function(e){var a=Object(r["a"])(e,2),n=a[0],i=a[1];i=void 0===i?{}:i;var s=i.data;return!t.tag.length&&(t.tag=s),t.total=n.data.total,n}).catch(v["i"])},searchHandle:function(t){this.search.id=t,this.$refs["wrapper"]&&this.$refs["wrapper"].searchHandle()},refreshHandle:function(t){this.search.id=t,this.$refs["wrapper"]&&this.$refs["wrapper"]["updateDataHandle"]()},changeItem:function(t,e){this.$refs["wrapper"]&&this.$refs["wrapper"].changeItem(t,e)},addOrUpdateHandle:function(t,e){var a=this;this.addOrUpdateVisible=!0,this.$nextTick(function(){a.$refs.addOrUpdate.init(t,e)})},showComment:function(t){var e=this;this.commentListVisible=!0,this.$nextTick(function(){e.$refs.commentList.init(t)})},deleteDynamicHandle:function(t){this.$refs["wrapper"]["data"].splice(t,1)},filterChangeHandle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.search.recommended=t.includes("recommended")?1:null,this.search.sync_plaza=t.includes("sync")?1:null,this.search.top=t.includes("top")?1:null,this.searchHandle()},tagChangeHandle:function(t){this.search.tag=t}},activated:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].resetScroll();var t=this.$route.params.row;if(t){this.reset();var e=t.target_type,a=0;switch(e){case"dynamic":a=t.dynamic.id;break;case"comment":a=t.comment.topic_id;break;case"reply":a=t.reply.topic_id;break}a&&this.searchHandle(a)}}},ct=st,ot=Object(H["a"])(ct,n,i,!1,null,null,null);e["default"]=ot.exports},d28d:function(t,e,a){"use strict";a.d(e,"g",function(){return r}),a.d(e,"d",function(){return s}),a.d(e,"a",function(){return c}),a.d(e,"i",function(){return o}),a.d(e,"f",function(){return l}),a.d(e,"c",function(){return u}),a.d(e,"h",function(){return d}),a.d(e,"e",function(){return m}),a.d(e,"b",function(){return f});var n=a("a8db"),i=a("c1fb");function r(t){return i["a"].get("tag/cate",{params:t})}function s(t){var e=t.id,a=Object(n["a"])(t,["id"]),r={data:a,url:"tag/cate/".concat(e||""),method:e?"PUT":"POST"};return Object(i["a"])(r)}function c(t){return i["a"].delete("tag/cate/".concat(t))}function o(t){return i["a"].get("user/tag",{params:t})}function l(t){var e=t.id,a=Object(n["a"])(t,["id"]),r={data:a,url:"user/tag/".concat(e||""),method:e?"PUT":"POST"};return Object(i["a"])(r)}function u(t){return i["a"].delete("user/tag/".concat(t))}function d(t){return i["a"].get("topic/tag",{params:t})}function m(t){var e=t.id,a=Object(n["a"])(t,["id"]),r={data:a,url:"topic/tag/".concat(e||""),method:e?"PUT":"POST"};return Object(i["a"])(r)}function f(t){return i["a"].delete("topic/tag/".concat(t))}},d2c8:function(t,e,a){var n=a("aae3"),i=a("be13");t.exports=function(t,e,a){if(n(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(i(t))}}}]);