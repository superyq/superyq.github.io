(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages9"],{"11c1":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cui-page"},[t.$slots["header"]?a("div",{staticClass:"cui-page-header"},[t._t("header")],2):t._e(),t._t("default",null,null,{data:t.data}),t.pages&&!t.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:t.total,limit:t.limit,current:t.page},on:{"size-change":t.limitChangeHandle,"current-change":t.pageChangeHandle}})],1):t._e()],2)},r=[],i=(a("96cf"),a("3b8d")),s=a("cebc"),o=a("20ca"),c={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(t,e){this.$set(this.data,t,Object(s["a"])({},this.data[t],e))},deleteItem:function(t){this.data.splice(t,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.formatSearchParams();case 5:return e=t.sent,t.prev=6,t.next=9,this.remoteMethod(e).then(this.formatSearchResult);case 9:a=t.sent,this.$emit("updateSuccess",a),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),this.$emit("updateFailed",t.t0);case 16:this.loading=!1;case 17:case"end":return t.stop()}},t,this,[[6,13]])}));function e(){return t.apply(this,arguments)}return e}(),formatSearchParams:function(){var t={};return this.pages&&Object.assign(t,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(t,this.searchParams),t},formatSearchResult:function(){var t=Object(i["a"])(regeneratorRuntime.mark(function t(e){var a,n,r,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.formatResponse){t.next=4;break}return t.next=3,this.formatResponse(e);case 3:e=t.sent;case 4:return a=e,n=a.data,this.pages?(r=n.total,i=n.data,this.scroll?(this.isBottom=i.length<this.limit,this.data=this.data.concat(i)):this.data=i,this.total=r):this.data=n,t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),limitChangeHandle:function(t){this.limit=t,this.updateDataHandle()},pageChangeHandle:function(t){this.page=t,this.updateDataHandle()},scrollHandle:Object(o["a"])(function(){if(!this.isBottom){var t=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;t&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var t=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",t.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},l=c,u=a("2877"),d=Object(u["a"])(l,n,r,!1,null,null,null);e["a"]=d.exports},"2fdb":function(t,e,a){"use strict";var n=a("5ca1"),r=a("d2c8"),i="includes";n(n.P+n.F*a("5147")(i),"String",{includes:function(t){return!!~r(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},5147:function(t,e,a){var n=a("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[n]=!1,!"/./"[t](e)}catch(r){}}return!0}},6762:function(t,e,a){"use strict";var n=a("5ca1"),r=a("c366")(!0);n(n.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},a8db:function(t,e,a){"use strict";var n=a("e265"),r=a.n(n),i=a("a4bb"),s=a.n(i);function o(t,e){if(null==t)return{};var a,n,r={},i=s()(t);for(n=0;n<i.length;n++)a=i[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}function c(t,e){if(null==t)return{};var a,n,i=o(t,e);if(r.a){var s=r()(t);for(n=0;n<s.length;n++)a=s[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}a.d(e,"a",function(){return c})},d2c8:function(t,e,a){var n=a("aae3"),r=a("be13");t.exports=function(t,e,a){if(n(e))throw TypeError("String#"+a+" doesn't accept regex!");return String(r(t))}},e25b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("list-with-search",{ref:"wrapper",attrs:{pages:"","search-params":t.search,"remote-method":t.remoteMethod},on:{updateSuccess:t.updateSuccess},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"name",label:"名字",align:"center"}}),a("el-table-column",{attrs:{prop:"pid",label:"父级",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row.parent;return[t._v(t._s(a&&a.name||"无父级"))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"sort",label:"排序",align:"center"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"240",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-button-group",[a("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(e){return t.addOrUpdateHandle(n)}}},[t._v("修改")]),a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(e){return t.deleteHandle(n)}}},[t._v("删除")])],1)]}}],null,!0)})],1),t.addOrUpdateVisible?a("add-or-update",{ref:"addOrUpdate",attrs:{groupList:t.groupList}}):t._e()]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{model:t.search,size:"mini"}},[a("el-form-item",[a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(e){return t.addOrUpdateHandle()}}},[t._v("新增")])],1)],1)],1)],2)},r=[],i=(a("7f7f"),a("11c1")),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{top:"8vh",visible:t.visible,"show-close":!1,"close-on-click-modal":!1,title:t.action+"社群社群设置",width:"550px"},on:{"update:visible":function(e){t.visible=e}}},[a("el-form",{ref:"dataForm",staticClass:"m-auto",staticStyle:{width:"400px"},attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"95px","label-suffix":":"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.dataFormSubmit()}}},[a("el-form-item",{staticClass:"d-none",attrs:{prop:"id"}}),a("el-form-item",{attrs:{prop:"name",label:"名称"}},[a("el-input",{attrs:{placeholder:"请输入社群设置名称",clearable:""},on:{change:function(e){return t.fieldChangeHandle("name")}},model:{value:t.dataForm.name,callback:function(e){t.$set(t.dataForm,"name",e)},expression:"dataForm.name"}})],1),a("el-form-item",{attrs:{prop:"pid",label:"父级"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择父级"},model:{value:t.dataForm.pid,callback:function(e){t.$set(t.dataForm,"pid",e)},expression:"dataForm.pid"}},t._l(t.pidList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),a("el-form-item",{attrs:{label:"排序",prop:"sort"}},[a("el-input-number",{attrs:{min:0,step:1,precision:0,"controls-position":"right"},model:{value:t.dataForm.sort,callback:function(e){t.$set(t.dataForm,"sort",e)},expression:"dataForm.sort"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:t.submitting,loading:t.submitting},on:{click:function(e){return t.dataFormSubmit()}}},[t._v("确定")])],1)],1)},o=[],c=(a("6762"),a("2fdb"),a("75fc")),l=a("a8db"),u=a("c1fb");function d(){return u["a"].get("group/manage")}function p(t){var e=t.id,a=Object(l["a"])(t,["id"]),n={data:a,url:"group/manage/".concat(e||""),method:e?"PUT":"POST"};return Object(u["a"])(n)}function m(t){return u["a"].delete("group/manage/".concat(t))}var h=a("ed08"),f={name:"AddOrUpdate",inject:["refreshHandle"],props:{groupList:{type:Array}},data:function(){return{visible:!1,dataForm:{id:0,name:"",pid:0,sort:0},dataRule:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],pid:[{required:!0,message:"请选择父级",trigger:"blur"}]},paramsKeys:["id","pid","sort"],submitting:!1}},computed:{action:function(){return this.dataForm.id?"修改":"新增"},pidList:function(){return[{id:0,name:"无父级"}].concat(Object(c["a"])(this.groupList))}},methods:{resetFormHandle:function(){this.$refs["dataForm"].resetFields()},init:function(t){var e=this;this.visible=!0,this.$nextTick(function(){e.resetFormHandle(),t&&t.id&&Object(h["a"])(e.dataForm,t)})},beforeSubmitHandle:function(){var t=this;return new Promise(function(e,a){t.$refs["dataForm"].validate(function(n){if(!n)return a();t.$confirm("确定".concat(t.action,"此社群设置"),"".concat(t.action,"社群设置")).then(e).catch(a)})})},dataFormSubmit:function(){var t=this;this.submitting||(this.submitting=!0,this.beforeSubmitHandle().then(function(){var e=Object(h["k"])(t.dataForm,t.paramsKeys);p(e).then(function(e){var a=e.message,n=void 0===a?"".concat(t.action,"成功！"):a;t.$message.success(n),t.visible=!1,t.refreshHandle&&t.refreshHandle()}).catch(function(e){var a=e.message,n=void 0===a?"".concat(t.action,"失败！"):a;t.$message.error(n)}).finally(function(){t.submitting=!1})}).catch(function(){t.submitting=!1}))},fieldChangeHandle:function(t){this.paramsKeys.includes(t)||this.paramsKeys.push(t)}}},g=f,b=a("2877"),v=Object(b["a"])(g,s,o,!1,null,null,null),w=v.exports,y={name:"GroupSet",components:{addOrUpdate:w,listWithSearch:i["a"]},provide:function(){return{refreshHandle:this.updateTableData}},data:function(){return{search:{},addOrUpdateVisible:!1,groupList:[]}},methods:{remoteMethod:d,updateTableData:function(){this.$refs["wrapper"]["updateDataHandle"]()},addOrUpdateHandle:function(t){var e=this;this.addOrUpdateVisible=!0,this.$nextTick(function(){e.$refs.addOrUpdate.init(t)})},deleteHandle:function(t){var e=this,a=t.name,n=t.id;this.$confirm("确定对群设置「".concat(a,"」进行删除操作？"),"删除群设置",{type:"warning"}).then(function(){m(n).then(function(t){var a=t.message,n=void 0===a?"删除成功":a;e.$message.success(n),e.updateTableData()}).catch(function(t){var a=t.message,n=void 0===a?"删除失效！":a;e.$message.error(n)})}).catch(h["i"])},updateSuccess:function(t){var e=t.data.data;this.groupList=e}}},H=y,O=Object(b["a"])(H,n,r,!1,null,null,null);e["default"]=O.exports}}]);