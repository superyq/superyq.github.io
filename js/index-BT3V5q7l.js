import{g as P,h as F,r as _,B as E,K as W,J as o,W as O,F as e,N as R,M as z,b6 as H,b7 as J,aX as X,t as T,cJ as Q,cK as B,H as Z,U as K,cL as ee,C as q,cM as ae,ad as A,o as j,D as m,cN as te,cO as le,a5 as oe,ag as se,ae as ne,X as re,P as L,a9 as ue,af as de}from"./index-D8FvNXUN.js";import{s as ie,d as Y}from"./request-DMhyIIYi.js";import{_ as me}from"./YDate.vue_vue_type_script_setup_true_lang-BqHOblHP.js";import{_ as G}from"./YSelect.vue_vue_type_script_setup_true_lang-CnquiqKQ.js";import{_ as U}from"./YInput.vue_vue_type_script_setup_true_lang-CHBbIbhD.js";import{_ as pe}from"./YTable.vue_vue_type_script_setup_true_lang-CKcpUPzs.js";import{g as ce}from"./dict-mock-DbMstasx.js";import{u as fe,a as ge,c as _e,b as he}from"./table-Clx5OpyC.js";import{_ as ve}from"./YSwitch.vue_vue_type_script_setup_true_lang-CpxiYOGJ.js";import{N as x,_ as we}from"./FormItem-Cw9taY8m.js";import{_ as Ve}from"./YRadio.vue_vue_type_script_setup_true_lang-DZQEf_TB.js";import{v as be,a as xe}from"./validate-8Mdn0ZtA.js";import"./use-keyboard-cUwMenjY.js";import"./Checkbox-BbYC2Rpd.js";import"./RadioGroup-C7b_XRL3.js";import"./Dropdown-D7yZdgzE.js";const ye=u=>{let t=new FormData;return t.append("file",u),t},ke=u=>{let t=ye(u);return ie({url:"/users/list",method:"post",headers:{"Content-Type":"multipart/form-data"},data:t})},Ue=P({__name:"Search",props:{modelValue:{type:Object,required:!0}},emits:["update:modelaValue","search"],setup(u,{expose:t,emit:f}){const i=u,y=f,p=F({get(){return i.modelValue},set(w){y("update:modelaValue",w)}}),k=[{label:"启用",value:1},{label:"禁用",value:0}];let a=_(null);const N=()=>{y("search")},I=w=>{let s=p.value;if(w){let V=w.map(b=>H(b,"{y}-{m}-{d}"));s=J(p.value,V)}else s.params&&delete s.params;y("update:modelaValue",s)};return t({resetSearch:()=>{a.value=null}}),(w,s)=>{const V=U,b=G,l=me;return E(),W(z,null,[o(V,{modelValue:p.value.userName,"onUpdate:modelValue":s[0]||(s[0]=d=>p.value.userName=d),onKeyup:O(N,["enter"]),placeholder:"请输入用户名"},null,8,["modelValue"]),o(V,{modelValue:p.value.phone,"onUpdate:modelValue":s[1]||(s[1]=d=>p.value.phone=d),onKeyup:O(N,["enter"]),placeholder:"请输入手机号"},null,8,["modelValue"]),o(b,{modelValue:p.value.status,"onUpdate:modelValue":s[2]||(s[2]=d=>p.value.status=d),options:k,onKeyup:O(N,["enter"]),placeholder:"请选择用户状态"},null,8,["modelValue"]),o(l,{width:"300px",modelValue:e(a),"onUpdate:modelValue":s[3]||(s[3]=d=>R(a)?a.value=d:a=d),"onUpdate:value":I,"start-placeholder":"创建开始时间","end-placeholder":"创建结束时间"},null,8,["modelValue"])],64)}}}),Ne=u=>u.map(t=>({label:t.dictLabel,value:t.dictCode})),$e=u=>{let t={};return u.map(f=>{t[f.dictCode]=f.dictLabel}),t},M=X({id:"dict",state:()=>({dict:{}}),actions:{getDictType(u,t=""){let f={op:"_Op",name:"_Name","":""};if(this.dict[u])return this.dict[`${u}${f[t]}`];ce().then(i=>(this.dict[u]=i.data.data,this.dict[`${u}_Op`]=Ne(i.data.data),this.dict[`${u}_Name`]=$e(i.data.data),this.dict[`${u}${f}`]))}}}),Ie=P({__name:"Table",props:{params:{type:Object,required:!0}},emits:["edit","delarr","resetpassword","sharerole"],setup(u,{expose:t,emit:f}){const i=u,y=f,p=M(),k=F(()=>p.getDictType("sys_user_sex","name")),a=fe(),N=he("id"),I=ge([a.selectionColumn,a.indexColumn,{title:"姓名",key:"userName",minWidth:200},{title:"手机号",key:"phone",minWidth:200},{title:"最后登录IP",key:"lastLoginIp",width:120},{title:"性别",key:"gender",width:80,render(n){var h;return T("div",null,(h=k.value)==null?void 0:h[n.gender])}},{title:"状态",key:"status",width:80,render(n){return T(ve,{defaultValue:n.status,checkedValue:1,uncheckedValue:0,onUpdateValue:h=>{Q({id:n.id,status:h}).then(g=>{window.$msg.success(g.data)})}})}},{title:"操作",key:"action",fixed:"right",width:160,render(n){return _e([{label:"修改",icon:"edit",onClick:v.bind(null,n)},{label:"删除",icon:"delete",onClick:w.bind(null,n)},{label:"重置密码",icon:"resetpassword",onClick:l.bind(null,n)},{label:"分配角色",icon:"assignrole",onClick:d.bind(null,n)}])}}],{align:"center"}),v=n=>{y("edit",n)},w=n=>{window.$dialog.warning({title:"警告",content:`确定删除 '${n.userName}' ?`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{B(n.id).then(()=>{window.$msg.success("删除成功"),S()})}})};let s=_(""),V=_(null);const b=n=>{s.value.length>=5&&s.value.length<=20&&ae({id:n,password:s.value}).then(h=>{window.$msg.success(h.data),V.value.destroy()})},l=n=>{s.value="",V.value=window.$dialog.warning({title:"重置密码",content:()=>T("div",null,[T("div",null,{default:()=>`请输入 '${n.userName}' 新密码`}),T(x,{rule:{trigger:["input","blur"],validator(){if(s.value.length<5||s.value.length>20)return new Error("用户密码长度必须介于 5 和 20 之间")}},style:{margin:"-20px 0"}},{default:()=>T(U,{modelValue:s.value,"onUpdate:modelValue":h=>s.value=h})})]),action:()=>T(Z,{onClick:()=>b(n.id),disabled:!s.value},{default:()=>"确定"})})},d=n=>{y("sharerole",n)};let D=_(!1),r=K([]);const S=()=>(D.value=!0,new Promise(n=>{ee(i.params).then(h=>{D.value=!1,r=h.data.data,n(h.data.total)})})),C=[],$=n=>{C.length=0,C.push(...n)};return t({getTable:S,delArr:()=>{if(!C.length)return window.$msg.info("请选择删除项");window.$dialog.warning({title:"警告",content:"确定批量删除?",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{B().then(()=>{window.$msg.success("删除成功"),S()})}})}}),(n,h)=>{const g=pe;return E(),q(g,{loading:e(D),columns:e(I),data:e(r),"row-key":e(N),"onUpdate:checkedRowKeys":$},null,8,["loading","columns","data","row-key"])}}}),De=(u,t)=>{if(t){if(!be(t))return new Error("请正确输入手机号")}else return new Error("请输入手机号")},Te=(u,t)=>{if(t&&!xe(t))return new Error("请正确输入邮箱号")},Se=P({__name:"Form",props:{formId:[Number,String]},setup(u,{expose:t}){const f=u,i=M(),y=F(()=>i.getDictType("sys_user_sex","op")),p=[{label:"启动",value:1},{label:"停用",value:0}];let k={userId:null,userName:"",realName:"",password:"",phone:"",email:"",status:1,remark:"",deptId:"",postId:"",roleId:"",gender:1},a=_(A(k));const N={gender:{required:!0,message:"请选择性别"},userName:{required:!0,message:"请输入用户昵称",trigger:["input","blur"]},realName:{required:!0,message:"请输入真实姓名",trigger:["input","blur"]},phone:{required:!0,validator:De,trigger:["input","blur"]},email:{validator:Te,trigger:["input","blur"]},status:{required:!0,message:"请选择状态"}},I=()=>{te(f.formId).then(b=>{a.value=b.data})};let v=_(null);const w=()=>{a.value=A(k)},s=()=>new Promise((b,l)=>{v.value.validate(d=>{d?l(!1):le(a.value).then(()=>{window.$msg.success(`${a.value.userId?"修改":"新增"}用户成功！`),b(!0)}).catch(()=>{l(!1)})})}),V=()=>{v.value.validate()};return t({validateForm:s}),j(()=>{w(),f.formId&&I()}),(b,l)=>{const d=Ve,D=we;return E(),q(D,{class:"u__grid-c2",ref_key:"formRef",ref:v,model:e(a),rules:N,"label-placement":"left","require-mark-placement":"left","label-width":"80"},{default:m(()=>[o(e(x),{path:"userName",label:"用户昵称"},{default:m(()=>[o(U,{modelValue:e(a).userName,"onUpdate:modelValue":l[0]||(l[0]=r=>e(a).userName=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"deptId",label:"所属部门"},{default:m(()=>[o(U,{modelValue:e(a).deptId,"onUpdate:modelValue":l[1]||(l[1]=r=>e(a).deptId=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"realName",label:"真实姓名"},{default:m(()=>[o(U,{modelValue:e(a).realName,"onUpdate:modelValue":l[2]||(l[2]=r=>e(a).realName=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"password",label:"用户密码"},{default:m(()=>[o(U,{modelValue:e(a).password,"onUpdate:modelValue":l[3]||(l[3]=r=>e(a).password=r),type:"password","show-password-on":"mousedown"},null,8,["modelValue"])]),_:1}),o(e(x),{path:"phone",label:"手机号"},{default:m(()=>[o(U,{modelValue:e(a).phone,"onUpdate:modelValue":l[4]||(l[4]=r=>e(a).phone=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"email",label:"邮箱"},{default:m(()=>[o(U,{modelValue:e(a).email,"onUpdate:modelValue":l[5]||(l[5]=r=>e(a).email=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"gender",label:"性别"},{default:m(()=>[o(G,{modelValue:e(a).gender,"onUpdate:modelValue":l[6]||(l[6]=r=>e(a).gender=r),options:y.value,"onUpdate:value":V},null,8,["modelValue","options"])]),_:1}),o(e(x),{path:"status",label:"状态"},{default:m(()=>[o(d,{modelValue:e(a).status,"onUpdate:modelValue":l[7]||(l[7]=r=>e(a).status=r),options:p},null,8,["modelValue"])]),_:1}),o(e(x),{path:"post",label:"岗位"},{default:m(()=>[o(U,{modelValue:e(a).postId,"onUpdate:modelValue":l[8]||(l[8]=r=>e(a).postId=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"role",label:"角色"},{default:m(()=>[o(U,{modelValue:e(a).roleId,"onUpdate:modelValue":l[9]||(l[9]=r=>e(a).roleId=r)},null,8,["modelValue"])]),_:1}),o(e(x),{path:"remark",label:"备注",style:{"grid-area":"6 / 1 / 10 / 3"}},{default:m(()=>[o(U,{width:"auto",type:"textarea",modelValue:e(a).remark,"onUpdate:modelValue":l[10]||(l[10]=r=>e(a).remark=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),Ce=oe(Se,[["__scopeId","data-v-9b7d66e5"]]),Re={class:"u__tc u__fz-12"},Je=P({__name:"index",setup(u){let t=K({userName:"",phone:"",status:null}),f=_(null),i=K(se),y=F(()=>Object.assign({},t,i));const p=_(null),k=($=1)=>{i.page=$,p.value.getTable().then(c=>{i.total=c})},a=()=>{t.userName="",t.phone="",t.status=null,f.value.resetSearch(),t.params&&delete t.params,i.page=1,i.pageSize=20,k()};let N=_(""),I=_(!1),v=_(!1),w=_(null),s=_("");const V=($=null)=>{const c=!!$;s.value=c?$.id:"",N.value=`${c?"编辑":"新增"}用户`,v.value=!0},b=()=>{I.value=!0,w.value.validateForm().then(()=>{v.value=!1}).catch(()=>{}).finally(()=>{I.value=!1})},l=()=>{p.value.delArr()};let d=_(!1),D=_({max:1,accept:".xls, .xlsx"});const r=()=>{Y("system/user/export",{...y},`user_${new Date().getTime()}.xlsx`)},S=()=>{Y("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)},C=$=>{console.log("fileList",$),d.value=!1,ke($[0]).then(c=>{console.log("success",c)})};return ne("btnload",I),j(()=>{k()}),($,c)=>{const n=ue,h=de;return E(),q(h,{upload:e(D),title:e(N),uploadTitle:"导入用户列表",modelValue:e(i),"onUpdate:modelValue":c[1]||(c[1]=g=>R(i)?i.value=g:i=g),show:e(v),"onUpdate:show":c[2]||(c[2]=g=>R(v)?v.value=g:v=g),uploadShow:e(d),"onUpdate:uploadShow":c[3]||(c[3]=g=>R(d)?d.value=g:d=g),onAdd:V,onSearch:k,onReset:a,onDel:l,onSubmit:b,onExport:r,onUploadFile:C},{search:m(()=>[o(Ue,{ref_key:"searchRef",ref:f,modelValue:e(t),"onUpdate:modelValue":c[0]||(c[0]=g=>R(t)?t.value=g:t=g),onSearch:k},null,8,["modelValue"])]),table:m(()=>[o(Ie,{ref_key:"table",ref:p,params:e(y),onEdit:V},null,8,["params"])]),form:m(()=>[o(Ce,{ref_key:"form",ref:w,formId:e(s)},null,8,["formId"])]),uploadTip:m(()=>[re("p",Re,[L(" 仅允许导入xls、xlsx格式文件。 "),o(n,{text:"",tag:"a",onClick:S},{default:m(()=>[L("下载模板")]),_:1})])]),_:1},8,["upload","title","modelValue","show","uploadShow"])}}});export{Je as default};
