(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages19"],{"11c1":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cui-page"},[t.$slots["header"]?a("div",{staticClass:"cui-page-header"},[t._t("header")],2):t._e(),t._t("default",null,null,{data:t.data}),t.pages&&!t.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:t.total,limit:t.limit,current:t.page},on:{"size-change":t.limitChangeHandle,"current-change":t.pageChangeHandle}})],1):t._e()],2)},i=[],r=(a("96cf"),a("3b8d")),s=a("cebc"),l=a("20ca"),o={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(t,e){this.$set(this.data,t,Object(s["a"])({},this.data[t],e))},deleteItem:function(t){this.data.splice(t,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.loading){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.next=5,this.formatSearchParams();case 5:return e=t.sent,t.prev=6,t.next=9,this.remoteMethod(e).then(this.formatSearchResult);case 9:a=t.sent,this.$emit("updateSuccess",a),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](6),this.$emit("updateFailed",t.t0);case 16:this.loading=!1;case 17:case"end":return t.stop()}},t,this,[[6,13]])}));function e(){return t.apply(this,arguments)}return e}(),formatSearchParams:function(){var t={};return this.pages&&Object.assign(t,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(t,this.searchParams),t},formatSearchResult:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var a,n,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.formatResponse){t.next=4;break}return t.next=3,this.formatResponse(e);case 3:e=t.sent;case 4:return a=e,n=a.data,this.pages?(i=n.total,r=n.data,this.scroll?(this.isBottom=r.length<this.limit,this.data=this.data.concat(r)):this.data=r,this.total=i):this.data=n,t.abrupt("return",e);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),limitChangeHandle:function(t){this.limit=t,this.updateDataHandle()},pageChangeHandle:function(t){this.page=t,this.updateDataHandle()},scrollHandle:Object(l["a"])(function(){if(!this.isBottom){var t=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;t&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var t=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",t.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=o,u=a("2877"),d=Object(u["a"])(c,n,i,!1,null,null,null);e["a"]=d.exports},"386d":function(t,e,a){"use strict";var n=a("cb7c"),i=a("83a1"),r=a("5f1b");a("214f")("search",1,function(t,e,a,s){return[function(a){var n=t(this),i=void 0==a?void 0:a[e];return void 0!==i?i.call(a,n):new RegExp(a)[e](String(n))},function(t){var e=s(a,t,this);if(e.done)return e.value;var l=n(t),o=String(this),c=l.lastIndex;i(c,0)||(l.lastIndex=0);var u=r(l,o);return i(l.lastIndex,c)||(l.lastIndex=c),null===u?-1:u.index}]})},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},f77a:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("list-with-search",{ref:"listWithSearch",attrs:{remoteMethod:t.getCollectionList,pages:!0,searchParams:t.search},scopedSlots:t._u([{key:"header",fn:function(){return[a("el-form",{attrs:{size:"mini",inline:!0,model:t.search,"label-suffix":":"},nativeOn:{key:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchHandle(e)}}},[a("el-form-item",[a("el-input",{attrs:{clearable:""},model:{value:t.search.name,callback:function(e){t.$set(t.search,"name",e)},expression:"search.name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("用户姓名")])])],1),a("el-form-item",[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"——","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.searchHandle}},[t._v("查询")])],1),a("el-form-item",[a("h3",{staticClass:"m-auto d-inline-block"},[t._v("金额统计：")]),a("span",{staticStyle:{"margin-left":"1em"}},[a("b",[t._v("现金：")]),a("el-button",{staticStyle:{"margin-left":"1em"},attrs:{type:"text"}},[t._v(t._s(+t.moneyType.cny||0))])],1)])],1)]},proxy:!0},{key:"default",fn:function(e){var n=e.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80px",align:"center"}}),a("el-table-column",{attrs:{label:"用户信息"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return a("div",{staticClass:"cui-userbox"},[a("img",{directives:[{name:"pic",rawName:"v-pic",value:{img:n.avatar},expression:"{ img: row.avatar }"}],staticClass:"cui-userbox__avatar",attrs:{alt:n.name}}),a("span",{staticClass:"cui-userbox__name"},[t._v(t._s(n.name))])])}}],null,!0)}),a("el-table-column",{attrs:{prop:"tel",label:"手机号",align:"center"}}),a("el-table-column",{attrs:{prop:"collection_time",label:"到期时间",width:"180px",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"状态",width:"120px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row.status;return[a("el-tag",{attrs:{type:t.statusOptions[n]["tag"]}},[t._v(t._s(t.statusOptions[n]["name"]))])]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.showDialog(n)}}},[t._v("查看购买记录")])],1)]}}],null,!0)})],1),t.userPrivilegeDetailVisible?a("user-privilege-detail",{ref:"userPrivilegeDetail"}):t._e()]}}])})},i=[],r=(a("386d"),a("f9a8")),s=a.n(r),l=a("c1fb");function o(t){return l["a"].get("collection",{params:t})}function c(t){var e=t.id,a=t.params;return l["a"].get("collection/user/".concat(e),{params:a})}function u(){return l["a"].get("collection/amount")}var d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.name,top:"3vh",visible:t.visible,"close-on-click-modal":!1,width:"1000px"},on:{"update:visible":function(e){t.visible=e}}},[a("list-with-search",{ref:"listWithSearch",attrs:{remoteMethod:t.getCollectionDetail,pages:!0,searchParams:t.search},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),a("el-table-column",{attrs:{prop:"title",label:"备注","min-width":"150px",align:"center"}}),a("el-table-column",{attrs:{prop:"extend.buy_type",label:"购买类型",align:"center"}}),a("el-table-column",{attrs:{prop:"coin",label:"支付方式",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row.target_type;return[t._v(t._s(t.buyType[a]))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"amount",label:"金额",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row.amount;return[t._v(t._s(+a||0))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"extend.month",label:"购买月数",align:"center"}}),a("el-table-column",{attrs:{prop:"created_at",label:"购买时间",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"extend.collect_time",label:"截至时间",width:"100",align:"center"}})],1)]}}])})],1)},h=[],p=(a("7f7f"),a("11c1")),m={name:"UserPrivilegeDetail",components:{listWithSearch:p["a"]},data:function(){return{search:{id:0},name:"",visible:!1,buyType:{"alipay:buy:collection":"支付宝","wxpay:buy:collection":"微信"}}},methods:{getCollectionDetail:c,init:function(t){this.visible=!0;var e=t.id,a=t.name;this.search.id=e,this.name="【".concat(a,"】 一键收取购买记录"),this.updateDataHandle()},updateDataHandle:function(){this.$refs["listWithSearch"]&&this.$refs["listWithSearch"].updateDataHandle()}}},f=m,g=a("2877"),v=Object(g["a"])(f,d,h,!1,null,null,null),b=v.exports,y={name:"Privilege",components:{listWithSearch:p["a"],userPrivilegeDetail:b},watch:{time:function(t){t?(this.search["start"]=t[0],this.search["end"]=t[1]):this.search.start=this.search.end=""}},data:function(){return{defaultAvatar:s.a,moneyType:{comc:0,cny:0},time:[],search:{start_time:"",end_time:"",name:""},statusOptions:["",{name:"有效",tag:"success"},{name:"已过期",tag:"info"}],userPrivilegeDetailVisible:!1}},methods:{getCollectionList:o,searchHandle:function(){this.$refs["listWithSearch"].searchHandle()},updateDataHandle:function(){this.$refs["listWithSearch"]&&this.$refs["listWithSearch"].updateDataHandle()},getAmount:function(){var t=this;u().then(function(e){var a=e.data;Object.assign(t.moneyType,a)}).catch(function(e){var a=e.message,n=void 0===a?"获取购买金额统计失败！":a;t.$message.error(n)})},showDialog:function(t){var e=this;this.userPrivilegeDetailVisible=!0,this.$nextTick(function(){e.$refs.userPrivilegeDetail&&e.$refs.userPrivilegeDetail.init(t)})},avatarError:function(t){t.target.src=s.a}},activated:function(){this.getAmount()}},_=y,w=Object(g["a"])(_,n,i,!1,null,null,null);e["default"]=w.exports},f9a8:function(t,e,a){t.exports=a.p+"img/avatar__user.d76349f5.png"}}]);