(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages25"],{"08da":function(e,t,a){"use strict";a.d(t,"a",function(){return i}),a.d(t,"j",function(){return s}),a.d(t,"d",function(){return o}),a.d(t,"p",function(){return l}),a.d(t,"k",function(){return c}),a.d(t,"c",function(){return u}),a.d(t,"l",function(){return d}),a.d(t,"o",function(){return p}),a.d(t,"h",function(){return m}),a.d(t,"n",function(){return f}),a.d(t,"b",function(){return h}),a.d(t,"m",function(){return b}),a.d(t,"f",function(){return g}),a.d(t,"i",function(){return v}),a.d(t,"g",function(){return _}),a.d(t,"e",function(){return w});var n=a("a8db"),r=a("c1fb");function i(e){return r["a"].get("plaza/task/cate",{params:e})}function s(e){var t=e.id,a=Object(n["a"])(e,["id"]),i={data:a,url:"plaza/task/cate/".concat(t||""),method:t?"PUT":"POST"};return Object(r["a"])(i)}function o(e){return r["a"].delete("plaza/task/cate/".concat(e))}function l(e){return r["a"].get("plaza/task",{params:e})}function c(e){var t=e.id,a=Object(n["a"])(e,["id"]),i={data:a,url:"plaza/task/".concat(t||""),method:t?"PUT":"POST"};return Object(r["a"])(i)}function u(e){var t=e.id,a=e.action,n={url:"plaza/task/".concat(t,"/").concat(a),method:""===a?"delete":"put"};return Object(r["a"])(n)}function d(e){return r["a"].get("plaza/task/get",{params:e})}function p(e){return r["a"].get("plaza/task/submit",{params:e})}function m(e){var t=e.id,a=e.action,i=Object(n["a"])(e,["id","action"]);return r["a"].post("plaza/task/".concat(t,"/").concat(a),i)}function f(e){return r["a"].get("plaza/task/report",{params:e})}function h(e){var t=e.id,a=Object(n["a"])(e,["id"]);return r["a"].post("plaza/task/report/".concat(t),a)}function b(e){var t=e.id,a=e.action,n={url:"plaza/task/report/".concat(t,"/").concat(a),method:"reissue"===a?"POST":"PUT"};return Object(r["a"])(n)}function g(e){return r["a"].get("plaza/task/wallet/logs",{params:e})}function v(e,t){return r["a"].post("plaza/task/".concat(e,"/export"),{status:t})}function _(e){return r["a"].get("plaza/task/".concat(e,"/zip"))}function w(e){return r["a"].delete("plaza/task/".concat(e,"/zip"))}},"11c1":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cui-page"},[e.$slots["header"]?a("div",{staticClass:"cui-page-header"},[e._t("header")],2):e._e(),e._t("default",null,null,{data:e.data}),e.pages&&!e.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:e.total,limit:e.limit,current:e.page},on:{"size-change":e.limitChangeHandle,"current-change":e.pageChangeHandle}})],1):e._e()],2)},r=[],i=(a("96cf"),a("3b8d")),s=a("cebc"),o=a("20ca"),l={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(e,t){this.$set(this.data,e,Object(s["a"])({},this.data[e],t))},deleteItem:function(e){this.data.splice(e,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:return this.loading=!0,e.next=5,this.formatSearchParams();case 5:return t=e.sent,e.prev=6,e.next=9,this.remoteMethod(t).then(this.formatSearchResult);case 9:a=e.sent,this.$emit("updateSuccess",a),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](6),this.$emit("updateFailed",e.t0);case 16:this.loading=!1;case 17:case"end":return e.stop()}},e,this,[[6,13]])}));function t(){return e.apply(this,arguments)}return t}(),formatSearchParams:function(){var e={};return this.pages&&Object.assign(e,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(e,this.searchParams),e},formatSearchResult:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a,n,r,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.formatResponse){e.next=4;break}return e.next=3,this.formatResponse(t);case 3:t=e.sent;case 4:return a=t,n=a.data,this.pages?(r=n.total,i=n.data,this.scroll?(this.isBottom=i.length<this.limit,this.data=this.data.concat(i)):this.data=i,this.total=r):this.data=n,e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),limitChangeHandle:function(e){this.limit=e,this.updateDataHandle()},pageChangeHandle:function(e){this.page=e,this.updateDataHandle()},scrollHandle:Object(o["a"])(function(){if(!this.isBottom){var e=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;e&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var e=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",e.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=l,u=a("2877"),d=Object(u["a"])(c,n,r,!1,null,null,null);t["a"]=d.exports},"20d6":function(e,t,a){"use strict";var n=a("5ca1"),r=a("0a49")(6),i="findIndex",s=!0;i in[]&&Array(1)[i](function(){s=!1}),n(n.P+n.F*s,"Array",{findIndex:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(i)},"25e0":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("cui-page",[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.tabClickHandle},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{lazy:"",label:"任务管理",name:"task"}},[a("task-list")],1),a("el-tab-pane",{attrs:{lazy:"",label:"任务分类管理",name:"cate"}},[a("task-cate-list")],1),a("el-tab-pane",{attrs:{lazy:"",label:"任务举报管理",name:"report"}},[a("task-report-list")],1),a("el-tab-pane",{attrs:{lazy:"",label:"任务领取记录",name:"receive"}},[a("task-receive-list")],1)],1)],1)},r=[],i=(a("7f7f"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-with-search",{ref:"wrapper",attrs:{"search-params":e.search,"remote-method":e.remoteMethod,pages:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("cui-table2",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"ID",align:"center",width:"80"}}),a("el-table-column",{attrs:{label:"任务名称","header-align":"center","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return a("a",{staticClass:"cui-userbox cui-userbox--large",on:{click:function(t){return e.showSubmit(n)}}},[a("img",{directives:[{name:"pic",rawName:"v-pic",value:{img:n.icon},expression:"{ img: row.icon }"}],staticClass:"cui-userbox__avatar",attrs:{alt:n.name}}),a("span",{staticClass:"cui-userbox__name"},[e._v(e._s(n.name))])])}}],null,!0)}),a("el-table-column",{attrs:{prop:"category.name",label:"任务分类",align:"center",width:"120"}}),a("el-table-column",{attrs:{prop:"status",label:"状态",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row.status;return[a("el-tag",{attrs:{type:e.statusOp[n]["type"]}},[e._v(e._s(e.statusOp[n]["name"]))])]}}],null,!0)}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间","header-align":"center",width:"100"}}),a("el-table-column",{attrs:{prop:"sort",label:"任务排序",align:"center",width:"100"}}),a("el-table-column",{attrs:{prop:"total_price",label:"任务总金额","header-align":"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.total_price;return[e._v(e._s(+a))]}}],null,!0)}),a("el-table-column",{attrs:{label:"剩余金额","header-align":"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,n=a.finish_price,r=a.total_price;return[e._v(e._s(+(r-n).toFixed(8)))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"finish_times",label:"提交总数",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.finish_times;return[e._v(e._s(a||"0"))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"waitSubmit",label:"待审核",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.waitSubmit;return[e._v(e._s(a||"0"))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"passSubmit",label:"审核通过",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.passSubmit;return[e._v(e._s(a||"0"))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"finish_times",label:"审核驳回",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,n=a.finish_times,r=a.waitSubmit,i=a.passSubmit;return[e._v(e._s(n-r-i))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"admin",label:"发布者",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.admin;return[e._v(e._s(a&&a.name||"--"))]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("task-dropdown",{attrs:{row:n},on:{moreActionHandle:e.moreActionHandle}})]}}],null,!0)})],1),e.showAddOrUpdate?a("add-or-update",{ref:"addOrUpdate",attrs:{taskCate:e.taskCate}}):e._e(),a("square-wallet-list",{ref:"squareWallet"})]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:"",model:e.search}},[a("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{title:"点击任务名，可查看用户提交记录",type:"success"}}),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择任务分类",clearable:""},on:{change:e.searchHandle},model:{value:e.search.category_name,callback:function(t){e.$set(e.search,"category_name",t)},expression:"search.category_name"}},e._l(e.taskCate,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})}),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.updateTableHandle}},[e._v("查询")]),a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(t){return e.addOrUpdateHandle()}}},[e._v("新增")]),a("el-button",{attrs:{type:"success"},on:{click:e.showTaskWallet}},[e._v("查看任务发布流水")])],1),a("el-form-item",[a("el-radio-group",{staticStyle:{"margin-left":"15px"},attrs:{size:"mini"},on:{change:e.searchHandle},model:{value:e.search.status,callback:function(t){e.$set(e.search,"status",t)},expression:"search.status"}},[a("el-radio",{attrs:{label:-1}},[e._v("全部")]),a("el-radio",{attrs:{label:1}},[e._v("进行中")]),a("el-radio",{attrs:{label:2}},[e._v("已完结")]),a("el-radio",{attrs:{label:3}},[e._v("已退款")])],1)],1),a("el-form-item",[a("el-switch",{staticStyle:{"margin-left":"32px"},attrs:{"active-value":1,"inactive-value":-1,"active-text":"只显示客服介入任务"},on:{change:e.searchHandle},model:{value:e.search.report,callback:function(t){e.$set(e.search,"report",t)},expression:"search.report"}})],1),a("el-form-item",[a("el-switch",{staticStyle:{"margin-left":"32px"},attrs:{"active-value":"sort","inactive-value":"id","active-text":"任务排序"},on:{change:e.searchHandle},model:{value:e.search.sort_order,callback:function(t){e.$set(e.search,"sort_order",t)},expression:"search.sort_order"}})],1)],1)],1)],2)}),s=[],o=a("768b"),l=(a("ac6a"),a("5df3"),a("f400"),a("11c1")),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{top:"6vh",title:e.action+"任务","close-on-click-modal":!1,visible:e.visible,width:"1000px",center:""},on:{"update:visible":function(t){e.visible=t}}},[a("el-steps",{staticStyle:{"margin-bottom":"10px"},attrs:{simple:"",active:e.currentStep,"finish-status":"success"}},[a("el-step",{attrs:{title:"1. 任务基础信息"}}),a("el-step",{attrs:{title:"2. 任务奖励信息"}})],1),a("section",{directives:[{name:"show",rawName:"v-show",value:1===e.currentStep,expression:"currentStep === 1"}]},[a("el-form",{ref:"baseInfoForm",staticClass:"m-auto",staticStyle:{width:"800px"},attrs:{model:e.baseInfoForm,rules:e.baseInfoRules,"label-width":"120px","label-suffix":"："},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"d-none",attrs:{prop:"id"}}),a("el-form-item",{attrs:{prop:"icon",label:"任务图标"}},[a("image-upload-wrapper",{attrs:{url:e.baseInfoForm.icon,canDelete:!e.onlyScan},on:{click:function(t){return e.toggleUploadBrowse("icon")},delete:function(t){return e.deleteImage("icon")}}})],1),a("el-form-item",{attrs:{prop:"cate_id",label:"任务分类"}},[a("el-select",{attrs:{placeholder:"请选择任务分类",clearable:"",disabled:e.onlyScan},on:{change:e.changeWayHandle},model:{value:e.baseInfoForm.cate_id,callback:function(t){e.$set(e.baseInfoForm,"cate_id",t)},expression:"baseInfoForm.cate_id"}},e._l(e.taskCate,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),a("el-form-item",{attrs:{prop:"sort",label:"任务排序"}},[a("el-input-number",{attrs:{precision:0,step:1,min:0,disabled:e.onlyScan},model:{value:e.baseInfoForm.sort,callback:function(t){e.$set(e.baseInfoForm,"sort",t)},expression:"baseInfoForm.sort"}}),a("div",{staticClass:"u-help",staticStyle:{"margin-top":"10px"}},[e._v("数字越大，排序越靠前")])],1),a("el-form-item",{attrs:{prop:"way",label:"审核方式"}},[a("el-radio-group",{attrs:{disabled:""},model:{value:e.way,callback:function(t){e.way=t},expression:"way"}},[a("el-radio",{attrs:{label:1}},[e._v("手动审核")]),a("el-radio",{attrs:{label:2}},[e._v("自动审核（非观看视频任务）")]),a("el-radio",{attrs:{label:3}},[e._v("自动审核（观看视频任务）")])],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:2===e.way,expression:"way === 2"}],attrs:{prop:"audit_time",label:"自动审核(s)"}},[a("el-input-number",{attrs:{precision:0,step:100,min:0,"controls-position":"right",disabled:e.isEdit},model:{value:e.baseInfoForm.audit_time,callback:function(t){e.$set(e.baseInfoForm,"audit_time",t)},expression:"baseInfoForm.audit_time"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3===e.way,expression:"way === 3"}],attrs:{prop:"",label:"上传视频"}},[a("el-button",{attrs:{size:"mini",icon:"el-icon-video-camera-solid"},on:{click:function(t){return e.toggleUploadBrowse("video")}}},[e._v("添加视频")]),e.video?a("div",{staticClass:"dynamic__viedo"},[a("video",{attrs:{controls:"",width:"320",preload:"metadata",muted:""},domProps:{muted:!0}},[a("source",{attrs:{src:e.video,type:"video/mp4"}}),a("p",[e._v("Your browser doesn't support HTML5 video. Here is a"),a("a",{attrs:{href:e.video}},[e._v("link to the video")]),e._v("instead.")])])]):e._e()],1),a("el-form-item",{attrs:{prop:"link.link_url",label:"链接地址",required:2===e.way}},[a("el-input",{attrs:{type:"text",placeholder:"例如：https://www.imeet.com",clearable:"",disabled:e.isEdit||3===e.way},model:{value:e.baseInfoForm.link.link_url,callback:function(t){e.$set(e.baseInfoForm.link,"link_url",t)},expression:"baseInfoForm.link.link_url"}})],1),a("el-form-item",{attrs:{prop:"link.link_name",label:"链接名称",required:2===e.way}},[a("el-input",{attrs:{type:"text",placeholder:"请输入链接名称",clearable:"",disabled:e.isEdit},model:{value:e.baseInfoForm.link.link_name,callback:function(t){e.$set(e.baseInfoForm.link,"link_name",t)},expression:"baseInfoForm.link.link_name"}})],1),a("el-form-item",{attrs:{prop:"name",label:"任务名称"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入任务名称",clearable:"",disabled:e.onlyScan},model:{value:e.baseInfoForm.name,callback:function(t){e.$set(e.baseInfoForm,"name",t)},expression:"baseInfoForm.name"}})],1),a("el-form-item",{attrs:{prop:"describe.text",label:"任务描述"}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入任务描述",clearable:"",disabled:e.onlyScan},model:{value:e.baseInfoForm.describe.text,callback:function(t){e.$set(e.baseInfoForm.describe,"text",t)},expression:"baseInfoForm.describe.text"}})],1),a("el-form-item",{attrs:{prop:"describe.images",label:"描述图片"}},[e.baseInfoForm.describe.images.length?e._l(e.baseInfoForm.describe.images,function(t,n){return a("image-upload-wrapper",{key:n,staticClass:"f-left",staticStyle:{"margin-right":"5px"},attrs:{url:t.filename,canDelete:!e.onlyScan},on:{click:function(t){return e.toggleUploadBrowse("describe",n)},delete:function(t){return e.deleteImage("describe",n)}}})}):e._e(),e.onlyScan?e._e():a("image-upload-wrapper",{staticClass:"f-left",on:{click:function(t){return e.toggleUploadBrowse("describe",e.baseInfoForm.describe.images.length)}}}),e.onlyScan&&!e.baseInfoForm.describe.images.length?a("div",{staticClass:"u-help",staticStyle:{"line-height":"unset"}},[e._v("暂无图片")]):e._e()],2),a("el-form-item",{attrs:{prop:"require.text",label:"任务要求"}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入任务要求",clearable:"",disabled:e.onlyScan},model:{value:e.baseInfoForm.require.text,callback:function(t){e.$set(e.baseInfoForm.require,"text",t)},expression:"baseInfoForm.require.text"}})],1),a("el-form-item",{attrs:{prop:"require.images",label:"要求图片"}},[e.baseInfoForm.require.images.length?e._l(e.baseInfoForm.require.images,function(t,n){return a("image-upload-wrapper",{key:n,staticClass:"f-left",staticStyle:{"margin-right":"5px"},attrs:{url:t.filename,canDelete:!e.onlyScan},on:{click:function(t){return e.toggleUploadBrowse("require",n)},delete:function(t){return e.deleteImage("require",n)}}})}):e._e(),e.onlyScan?e._e():a("image-upload-wrapper",{staticClass:"f-left",on:{click:function(t){return e.toggleUploadBrowse("require",e.baseInfoForm.require.images.length)}}}),e.onlyScan&&!e.baseInfoForm.require.images.length?a("div",{staticClass:"u-help",staticStyle:{"line-height":"unset"}},[e._v("暂无图片")]):e._e()],2)],1)],1),a("section",{directives:[{name:"show",rawName:"v-show",value:2===e.currentStep,expression:"currentStep === 2"}]},[a("el-form",{ref:"rewardInfoForm",staticClass:"m-auto",staticStyle:{width:"800px"},attrs:{model:e.rewardInfoForm,rules:e.rewardInfoRules,"label-width":"170px","label-suffix":"："},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{title:"矿石奖励计算公式：任务总次数 * 矿石奖励比例 * 单次奖励",type:"success"}}),a("el-row",[a("el-col",{attrs:{span:13}},[a("el-form-item",{attrs:{prop:"type",label:"奖励类型"}},[a("el-radio-group",{attrs:{disabled:e.isEdit},model:{value:e.rewardInfoForm.type,callback:function(t){e.$set(e.rewardInfoForm,"type",t)},expression:"rewardInfoForm.type"}},[a("el-radio",{attrs:{label:"ct"}},[e._v("CT(矿石)")])],1)],1),a("el-form-item",{attrs:{prop:"unit_price",label:"单次奖励",required:""}},[a("el-input-number",{attrs:{precision:2,step:1,min:0,"controls-position":"right",disabled:e.isEdit},model:{value:e.rewardInfoForm.unit_price,callback:function(t){e.$set(e.rewardInfoForm,"unit_price",t)},expression:"rewardInfoForm.unit_price"}})],1),a("el-form-item",{attrs:{prop:"end_time",label:"结束时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm:ss",disabled:e.onlyScan},model:{value:e.rewardInfoForm.end_time,callback:function(t){e.$set(e.rewardInfoForm,"end_time",t)},expression:"rewardInfoForm.end_time"}})],1),a("el-form-item",{attrs:{prop:"total_times",label:"任务奖励次数",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:3===e.status?e.current_times:e.finish_times,"controls-position":"right",disabled:e.onlyScan},model:{value:e.rewardInfoForm.total_times,callback:function(t){e.$set(e.rewardInfoForm,"total_times",t)},expression:"rewardInfoForm.total_times"}})],1),a("el-form-item",{attrs:{prop:"limit_expire",label:"限时完成(h)",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:0,max:72,"controls-position":"right",disabled:e.onlyScan},model:{value:e.rewardInfoForm.limit_expire,callback:function(t){e.$set(e.rewardInfoForm,"limit_expire",t)},expression:"rewardInfoForm.limit_expire"}})],1),a("el-form-item",{attrs:{prop:"limit_check_time",label:"自动审核(h)",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:0,"controls-position":"right",disabled:e.onlyScan},model:{value:e.rewardInfoForm.limit_check_time,callback:function(t){e.$set(e.rewardInfoForm,"limit_check_time",t)},expression:"rewardInfoForm.limit_check_time"}})],1),e.isEdit?a("el-form-item",{attrs:{prop:"status",label:"任务状态",required:""}},[a("el-radio-group",{model:{value:e.rewardInfoForm.status,callback:function(t){e.$set(e.rewardInfoForm,"status",t)},expression:"rewardInfoForm.status"}},[a("el-radio",{attrs:{label:1,disabled:e.onlyScan}},[e._v("进行中")]),a("el-radio",{attrs:{label:2,disabled:e.onlyScan}},[e._v("已完结")]),a("el-radio",{attrs:{label:3,disabled:""}},[e._v("已退款")])],1)],1):e._e()],1),a("el-col",{staticStyle:{"padding-left":"50px"},attrs:{span:11}},[a("el-form-item",{attrs:{label:"任务提交次数"}},[a("span",{staticClass:"c-primary"},[e._v(e._s(this.finish_times)+" 次")])]),e.totalPrice>=0?[a("el-form-item",{attrs:{label:"任务总奖励"}},[a("span",{staticClass:"c-warning"},[e._v(e._s(this.totalPrice)+" 个")])]),a("el-form-item",{attrs:{label:"群主矿石奖励比例"}},[a("span",{staticClass:"c-primary"},[e._v(e._s(this.groupPercentage))])]),a("el-form-item",{attrs:{label:"群主矿石奖励共计"}},[a("span",{staticClass:"c-success"},[e._v(e._s(this.groupNumber)+" 个")])]),a("el-form-item",{attrs:{label:"社区领袖矿石奖励比例"}},[a("span",{staticClass:"c-primary"},[e._v(e._s(this.commPercentage))])]),a("el-form-item",{attrs:{label:"社区领袖矿石奖励共计"}},[a("span",{staticClass:"c-success"},[e._v(e._s(this.commNumber)+" 个")])])]:e._e(),a("span",{staticClass:"c-success",staticStyle:{"font-size":"20px"}},[e._v(e._s(e.totalPrice>=0?"发布任务矿石共计扣除："+this.allNumber:"退还矿石："+-this.allNumber)+" 个")])],2)],1)],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:e.currentStep<=1},on:{click:function(t){return e.changeStepHandle(-1)}}},[e._v("上一步")]),e.currentStep!==e.totalStep||e.onlyScan?e._e():a("el-button",{attrs:{type:"success",loading:e.submitting,disabled:e.submitting},on:{click:e.beforeSubmitHandle}},[e._v("保存")]),a("el-button",{attrs:{type:"primary",disabled:e.currentStep>=e.totalStep},on:{click:function(t){return e.changeStepHandle(1)}}},[e._v("下一步")])],1),a("cui-upload",e._b({ref:"cui-upload",on:{"on-upload-success":e.imageChangeHandle}},"cui-upload",e.uploadOptions,!1))],2)},u=[],d=(a("6762"),a("2fdb"),a("b54a"),a("cebc")),p=(a("20d6"),a("90e7")),m=a("ed08"),f=a("08da"),h=a("9dac"),b={multiple:!0,limit:9,accept:"image/jpeg,image/gif,image/png",listType:"picture",tip:"只能上传jpg/png文件，且不超过500kb，最多选择9张"},g={multiple:!1,accept:"video/mp4",tip:"只能上传mp4文件"},v={data:function(){return{imageType:"icon",index:0,baseInfoForm:{id:0,icon:"",cate_id:"",name:"",describe:{text:"",images:[]},require:{text:"",images:[]},audit_time:0,link:{link_url:"",link_name:""},sort:0},baseInfoRules:{cate_id:[{required:!0,message:"请选择任务分类",trigger:"blur"}],name:[{required:!0,message:"请填写任务名称",trigger:"blur"}],icon:[{required:!0,message:"请选择任务图标",trigger:"blur"}],"describe.text":[{required:!0,message:"请填写任务描述",trigger:"blur"}],"require.text":[{required:!0,message:"请填写任务要求",trigger:"blur"}]},way:1,labelOpt:{icon:"任务图标",describe:"描述图片",require:"要求图片"}}},computed:{uploadOptions:function(){return"video"===this.imageType?g:b},video:function(){return this.baseInfoForm.link.link_url}},methods:{validateBaseInfo:function(){var e=this;return new Promise(function(t,a){e.$refs["baseInfoForm"].validate(function(e){e?t():a("任务基础信息未填写完整")})})},findIndex:function(e){var t=this.taskCate.map(function(e){return e.id}),a=t.indexOf(e);return this.taskCate[a].audit_way},changeWayHandle:function(e){e&&(this.way=this.findIndex(e))},toggleUploadBrowse:function(e,t){this.onlyScan||(t&&(this.index=t),this.imageType=e,this.$refs["cui-upload"]["toggleBrowse"]())},deleteImage:function(e,t){var a=this,n=this.labelOpt[e];this.$confirm("是否删除「".concat(n,"」图片?"),"提示",{type:"warning"}).then(function(){switch(e){case"icon":a.baseInfoForm.icon="";break;case"describe":a.baseInfoForm.describe.images.splice(t,1);break;case"require":a.baseInfoForm.require.images.splice(t,1);break}}).catch(m["i"])},imageChangeHandle:function(e){var t=this,a=e.filename,n=e.width,r=e.height;this.$message.success("图片上传成功！"),this.$refs["cui-upload"]["toggleBrowse"](),this.$nextTick(function(){switch(t.imageType){case"icon":t.baseInfoForm.icon=a;break;case"describe":t.baseInfoForm.describe.images.splice(t.index,1,Object(d["a"])({},e,{filename:a,width:+n,height:+r}));break;case"require":t.baseInfoForm.require.images.splice(t.index,1,Object(d["a"])({},e,{filename:a,width:+n,height:+r}));break;case"video":t.baseInfoForm.link.link_url="http://resource.immeet.com/"+a;break}})}}},_={data:function(){var e=this,t=function(e,t,a){if(/^0(\.0{1,2})?$/.test(t))return a(new Error);a()},a=function(t,a,n){var r=e.rewardInfoForm.status;if(2===r||3===r)return n();if(a){var i=(new Date).getTime(),s=new Date(a).getTime();return i<s?n():n(new Error)}return n()};return{options:[{value:1,label:"进行中"},{value:2,label:"已完结"},{value:3,label:"已退款",disabled:!0}],rewardInfoForm:{type:"ct",unit_price:0,total_times:0,limit_expire:0,limit_check_time:0,end_time:null,status:1},rewardInfoRules:{type:[{required:!0,message:"选择奖励类型",trigger:"blur"}],way:[{required:!0,message:"请选择提交方式",trigger:"blur"}],end_time:[{validator:a,message:"结束时间不得小于当前时间",trigger:"change"}],limit_check_time:[{validator:t,message:"等待审核时间不能为0",trigger:"change"}],limit_expire:[{validator:t,message:"限时完成时间不能为0",trigger:"change"}],total_times:[{required:!0,message:"次数不能为0",trigger:"change"}],unit_price:[{validator:t,message:"单次奖励不能为0",trigger:"change"}]}}},methods:{validateRewardInfo:function(){var e=this;return new Promise(function(t,a){e.$refs["rewardInfoForm"].validate(function(e){e?t():a("任务奖励信息填写有误")})})}}},w={name:"addOrUpdate",mixins:[v,_],props:{taskCate:{type:Array,required:!0}},components:{cuiUpload:h["a"]},inject:["updateTableHandle"],data:function(){return{totalStep:2,currentStep:1,visible:!1,submitting:!1,onlyScan:!1,action:"新增",paramsKeys:["id","icon","cate_id","name","describe","require","audit_time","sort"],rewardParamsKeys:["type","unit_price","total_times","limit_expire","limit_check_time","end_time","status"],ct:{comm:0,group:0},finish_times:0,status:1,current_times:0}},computed:{isEdit:function(){return!!this.baseInfoForm.id},totalPrice:function(){var e=this.rewardInfoForm,t=e.unit_price,a=e.total_times;if(this.onlyScan){var n=parseInt(a*t);return n||0}if(this.isEdit)return 3===this.status?(a-this.finish_times)*t:(a-this.current_times)*t;var r=parseInt(a*t);return r||0},groupNumber:function(){var e=this.totalPrice,t=Math.floor(e*this.ct.group*100)/100;return t||0},commNumber:function(){var e=this.totalPrice,t=Math.floor(e*this.ct.comm*100)/100;return t||0},groupPercentage:function(){return 100*this.ct.group+" %"},commPercentage:function(){return 100*this.ct.comm+" %"},allNumber:function(){var e=this.groupNumber,t=this.commNumber,a=this.totalPrice,n=e+t+a;return+(+n).toFixed(8)}},methods:{getTaskPower:function(){var e=this;Object(p["p"])().then(function(t){var a=t.data.value.ct;Object(m["a"])(e.ct,a)})},resetData:function(){var e=this;this.currentStep=1,this.way=1,this.action="新增",this.ct.comm=this.ct.group=0,this.finish_times=this.current_times=0,this.status=1,["baseInfoForm","rewardInfoForm"].forEach(function(t){e.$refs[t]&&e.$refs[t].resetFields()})},init:function(e,t){var a=this;this.resetData(),this.getTaskPower(),this.onlyScan=!!t,this.visible=!0,this.$nextTick(function(){if(e&&e.id){a.action="修改",a.way=a.findIndex(e.cate_id),t&&(a.action="浏览");var n=e.finish_times,r=e.status,i=e.total_times;a.finish_times=n,a.status=r,a.current_times=i,a.baseInfoForm=Object(m["b"])(Object(d["a"])({},e,{link:e.link||{link_url:"",link_name:""}})),a.rewardInfoForm=Object(m["b"])(e)}})},validateFormByStep:function(e){switch(e){case 1:return this.validateBaseInfo();case 2:return this.validateRewardInfo()}},changeStepHandle:function(e){var t=this;if(e>0)return this.validateFormByStep(this.currentStep).then(function(){t.currentStep+=e}).catch(function(e){t.$message.error(e)});this.currentStep+=e},beforeSubmitHandle:function(){var e=this;this.validateFormByStep(2).then(function(){e.submitHandle()}).catch(function(t){e.$message.error(t)})},submitHandle:function(){var e=this;if(!this.submitting){this.submitting=!0;var t=this.baseInfoForm.link,a=t.link_url,n=t.link_name;(n||a)&&!this.paramsKeys.includes("link")&&this.paramsKeys.push("link");var r=Object(m["k"])(this.baseInfoForm,this.paramsKeys),i=Object(m["k"])(this.rewardInfoForm,this.rewardParamsKeys),s=Object(d["a"])({},r,i);Object(f["k"])(s).then(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"任务成功！"):a;e.visible=!1,e.$message.success(n),e.updateTableHandle()}).catch(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"任务失败！"):a;e.$message.error(n)}).finally(function(){e.submitting=!1})}}}},y=w,k=a("2877"),x=Object(k["a"])(y,c,u,!1,null,null,null),S=x.exports,H=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dropdown",{attrs:{placement:"bottom-start",trigger:"click"},on:{command:e.moreActionHandle}},[a("i",{staticClass:"el-icon-more"}),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"editHandle",icon:"el-icon-edit"}},[e._v("编辑")]),a("el-dropdown-item",{attrs:{command:"scanHandle",icon:"el-icon-view"}},[e._v("任务详情")]),a("el-dropdown-item",{attrs:{command:"serviceHandle",icon:"el-icon-phone-outline",disabled:3===e.row.status||!!e.row.is_report}},[e._v("客服介入")]),a("el-dropdown-item",{attrs:{command:"finishHandle",icon:"el-icon-check",disabled:1!==e.row.status}},[e._v("完结")]),a("el-dropdown-item",{attrs:{command:"refundHandle",icon:"el-icon-warning-outline",disabled:2!==e.row.status}},[e._v("退款")]),a("el-dropdown-item",{attrs:{command:"deleteHandle",icon:"el-icon-delete",disabled:1===e.row.status}},[e._v("删除")])],1)],1)},O=[],F={name:"TaskDropdown",props:{row:{type:Object,required:!0}},methods:{moreActionHandle:function(e){this.$emit("moreActionHandle",e,this.row)}}},$=F,I=Object(k["a"])($,H,O,!1,null,null,null),T=I.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"square-wallet-list",attrs:{top:"3vh",title:"发布任务流水",visible:e.visible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.visible=t}}},[a("list-with-search",{ref:"wrapper",attrs:{searchParams:e.search,remoteMethod:e.getTaskWalletList,pages:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{fixed:"left",prop:"id",label:"ID",align:"center",width:"60px"}}),a("el-table-column",{attrs:{prop:"title",label:"收支",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row.action;return[a("el-tag",{attrs:{type:e.actionOptions[n]["type"]}},[e._v(e._s(e.actionOptions[n]["label"]))])]}}],null,!0)}),a("el-table-column",{attrs:{prop:"type",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.type;return[e._v(e._s(e.walletTypesMap.get(a)["label"]))]}}],null,!0)}),a("el-table-column",{attrs:{label:"金额",prop:"amount","header-align":"center"}}),a("el-table-column",{attrs:{label:"时间",prop:"created_at","header-align":"center",width:"100px"}}),a("el-table-column",{attrs:{label:"币种",prop:"coin",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.coin;return[e._v(e._s(e.coinType[a]))]}}],null,!0)}),a("el-table-column",{attrs:{label:"发布任务",prop:"task",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.task;return[e._v(e._s(a&&a.name||"--"))]}}],null,!0)}),a("el-table-column",{attrs:{label:"发布人",prop:"target_admin",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.target_admin;return[e._v(e._s(a&&a.name||"--"))]}}],null,!0)}),a("el-table-column",{attrs:{label:"状态",prop:"status",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row.status;return[a("el-tag",{attrs:{type:e.statusOptions[n]["type"]}},[e._v(e._s(e.statusOptions[n]["label"]))])]}}],null,!0)})],1)]}}])},[a("template",{slot:"header"},[a("el-row",{staticStyle:{"margin-bottom":"20px"}},[a("el-col",{attrs:{span:7}},[a("svg-icon",{staticClass:"va-middle",attrs:{name:"ore"}}),a("label",{staticStyle:{"margin-left":"8px"}},[e._v("CT(矿石)余额：")]),a("b",[e._v(e._s(e.wallet.balance))])],1),a("el-col",{attrs:{span:5}},[a("span",{staticClass:"sc--ore"},[e._v("iwallet充值：")]),a("b",[e._v(e._s(e.wallet.iwallet))])]),a("el-col",{attrs:{span:5}},[a("span",{staticClass:"sc--ore"},[e._v("发布任务总花费：")]),a("b",[e._v(e._s(e.wallet.task))])]),a("el-col",{attrs:{span:5}},[a("span",{staticClass:"sc--ore"},[e._v("任务退款总金额：")]),a("b",[e._v(e._s(e.wallet.refund))])])],1),a("el-form",{attrs:{size:"mini",model:e.search,"label-width":"90px","label-suffix":"："},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.updateDataHandle()}}},[a("el-form-item",{attrs:{label:"收支类型"}},[a("el-radio-group",{model:{value:e.search.action,callback:function(t){e.$set(e.search,"action",t)},expression:"search.action"}},[a("el-radio",{attrs:{label:""}},[e._v("全部")]),a("el-radio",{attrs:{label:1}},[e._v("收入")]),a("el-radio",{attrs:{label:2}},[e._v("支出")])],1)],1),a("el-form-item",{attrs:{label:"代币类型"}},[a("el-radio-group",{model:{value:e.search.coin,callback:function(t){e.$set(e.search,"coin",t)},expression:"search.coin"}},[a("el-radio",{attrs:{label:""}},[e._v("全部")]),a("el-radio",{attrs:{label:"ct"}},[e._v("CT(矿石)")])],1)],1),a("el-form-item",{attrs:{label:"筛选时间"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"——","end-placeholder":"结束时间","start-placeholder":"开始时间","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.updateDataHandle()}}},[e._v("查询")])],1)],1)],1)],2)],1)},C=[],q=(a("456d"),a("386d"),a("f121")),U={name:"SquareWalletList",components:{listWithSearch:l["a"]},data:function(){return{walletTypesMap:q["p"],search:{action:"",coin:"",start:"",end:""},wallet:{balance:0,iwallet:0,task:0,refund:0},actionOptions:["",{label:"收入",type:"info"},{label:"支出",type:"danger"}],statusOptions:[{label:"待处理",type:"warning"},{label:"成功",type:"success"},{label:"失败",type:"info"}],coinType:{ct:"CT(矿石)"},visible:!1}},computed:{time:{get:function(){var e=this.search,t=e.start,a=e.end;return t&&a?[t,a]:""},set:function(e){var t=e||[],a=Object(o["a"])(t,2),n=a[0],r=void 0===n?"":n,i=a[1],s=void 0===i?"":i;this.search.start=r,this.search.end=s}}},methods:{getTaskWalletList:function(){var e=this;return Object(f["f"])(arguments.length<=0?void 0:arguments[0]).then(function(t){var a=t.data;return Object.keys(e.wallet).forEach(function(t){e.wallet[t]=a[t]}),t})},init:function(){var e=this;this.visible=!0,["action","coin","start","end"].forEach(function(t){e.search[t]=""}),this.$nextTick(function(){e.updateDataHandle()})},updateDataHandle:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].updateDataHandle()}}},z=U,D=(a("b74f2"),Object(k["a"])(z,j,C,!1,null,null,null)),E=D.exports,P={components:{addOrUpdate:S,taskDropdown:T,listWithSearch:l["a"],squareWalletList:E},provide:function(){return{updateTableHandle:this.updateTableHandle}},data:function(){return{row:{},search:{category_name:"",status:-1,report:"",sort_order:"id"},statusOp:["",{name:"进行中",type:"primary"},{name:"已完结",type:"success"},{name:"已退款",type:"danger"}],reportOp:[{name:"未介入",type:"primary"},{name:"已介入",type:"success"}],coinType:{ct:"CT(矿石)"},dealMap:new Map([["",{label:"删除"}],["finish",{label:"完结"}],["service",{label:"客服介入"}],["refund",{label:"退款"}]]),taskCate:[],showAddOrUpdate:!1}},methods:{showTaskWallet:function(){this.$refs["squareWallet"].init()},showSubmit:function(e){this.$router.push({name:"submit",params:{row:e}})},remoteMethod:function(){var e=this,t=[f["p"].apply(void 0,arguments)];return this.taskCate.length||t.push(Object(f["a"])({page_sign:2})),Promise.all(t).then(function(t){var a=Object(o["a"])(t,2),n=a[0],r=a[1];r=void 0===r?{data:[]}:r;var i=r.data;return!e.taskCate.length&&(e.taskCate=i),n})},searchHandle:function(){this.$refs["wrapper"].searchHandle()},updateTableHandle:function(){this.$refs["wrapper"]["updateDataHandle"]()},addOrUpdateHandle:function(e,t){var a=this;this.showAddOrUpdate=!0,this.$nextTick(function(){a.$refs["addOrUpdate"]&&a.$refs["addOrUpdate"].init(e,t)})},dealTaskHandle:function(e,t){var a=this,n=e.name,r=e.id,i=this.dealMap.get(t),s=i.label;this.$confirm("确认".concat(s,"任务「").concat(n,"」？"),"".concat(s,"任务")).then(function(){Object(f["c"])({id:r,action:t}).then(function(e){var t=e.message,n=void 0===t?"".concat(s,"任务成功！"):t;a.$message.success(n),a.updateTableHandle()}).catch(function(e){var t=e.message,n=void 0===t?"".concat(s,"任务失败！"):t;a.$message.error(n)})}).catch(m["i"])},moreActionHandle:function(e,t){switch(e){case"editHandle":this.addOrUpdateHandle(t);break;case"scanHandle":this.addOrUpdateHandle(t,"scan");break;case"deleteHandle":this.dealTaskHandle(t,"");break;case"finishHandle":this.dealTaskHandle(t,"finish");break;case"serviceHandle":this.dealTaskHandle(t,"service");break;case"refundHandle":this.dealTaskHandle(t,"refund");break}}}},B=P,R=Object(k["a"])(B,i,s,!1,null,null,null),L=R.exports,N=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-with-search",{ref:"wrapper",attrs:{"search-params":e.search,"remote-method":e.cateList,pages:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("cui-table2",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"分类ID",align:"center",width:"80"}}),a("el-table-column",{attrs:{prop:"icon",label:"分类图标",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row.icon;return a("div",{staticClass:"u-img-box",staticStyle:{width:"80px"}},[a("img",{directives:[{name:"pic",rawName:"v-pic",value:{img:t},expression:"{ img: icon }"}]})])}}],null,!0)}),a("el-table-column",{attrs:{prop:"name",label:"分类名称",align:"center"}}),a("el-table-column",{attrs:{prop:"task_count",label:"子任务数量",align:"center"}}),a("el-table-column",{attrs:{prop:"audit_way",label:"审核方式",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row.audit_way;return[a("el-tag",{attrs:{type:e.auditWay[n]["tag"]}},[e._v(e._s(e.auditWay[n]["name"]))])]}}],null,!0)}),a("el-table-column",{attrs:{prop:"sort",label:"分类排序",align:"center"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;t.$index;return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addOrUpdateHandle(n)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.deleteHandle(n)}}},[e._v("删除")])]}}],null,!0)})],1),e.showAddOrUpdate?a("add-or-update",{ref:"addOrUpdate"}):e._e()]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:"",model:e.search}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入广场任务类名",clearable:""},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("分类名称")])])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.searchHandle()}}},[e._v("查询")]),a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(t){return e.addOrUpdateHandle()}}},[e._v("新增")])],1)],1)],1)],2)},W=[],A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.action+"任务分类","close-on-click-modal":!1,visible:e.visible,width:"700px"},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"95px","label-suffix":"："},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"d-none",attrs:{prop:"id"}}),a("el-form-item",{attrs:{prop:"icon",label:"分类图标"}},[a("image-upload-wrapper",{attrs:{url:e.dataForm.icon},on:{click:e.toggleUploadBrowse}})],1),a("el-form-item",{attrs:{prop:"name",label:"分类名称"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入分类名称",clearable:""},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1),a("el-form-item",{attrs:{prop:"audit_way",label:"审核方式"}},[a("el-radio-group",{model:{value:e.dataForm.audit_way,callback:function(t){e.$set(e.dataForm,"audit_way",t)},expression:"dataForm.audit_way"}},[a("el-radio",{attrs:{label:1}},[e._v("手动审核")]),a("el-radio",{attrs:{label:2}},[e._v("自动审核（非视频）")]),a("el-radio",{attrs:{label:3}},[e._v("自动审核（视频）")])],1)],1),a("el-form-item",{attrs:{prop:"sort",label:"分类排序"}},[a("el-input-number",{attrs:{step:1,min:0,"controls-position":"right"},model:{value:e.dataForm.sort,callback:function(t){e.$set(e.dataForm,"sort",t)},expression:"dataForm.sort"}})],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:e.submitting,loading:e.submitting},on:{click:function(t){return e.submitHandle()}}},[e._v("确定")])],1),a("cui-upload",{ref:"cui-upload",attrs:{listType:"picture"},on:{"on-upload-success":e.imageChangeHandle}})],2)},M=[],K={name:"addOrUpdate",inject:["updateTableHandle"],components:{cuiUpload:h["a"]},data:function(){return{dataForm:{id:0,name:"",icon:"",audit_way:1,sort:0},dataRule:{name:[{required:!0,message:"分类名称不能为空",trigger:"blur"}],icon:[{required:!0,message:"请选择分类图标",trigger:"blur"}]},visible:!1,submitting:!1,paramsKeys:["id","icon","audit_way","sort"],oldData:{}}},computed:{action:function(){return this.dataForm.id?"修改":"新增"}},methods:{resetFields:function(){this.paramsKeys=["id","icon","audit_way","sort"],this.$refs["dataForm"].resetFields()},init:function(e){var t=this;this.visible=!0,this.$nextTick(function(){t.resetFields(),e&&e.id&&(t.oldData=e,Object(m["a"])(t.dataForm,e))})},toggleUploadBrowse:function(){this.$refs["cui-upload"]["toggleBrowse"]()},imageChangeHandle:function(e){var t=this,a=e.filename;this.$message.success("图片上传成功！"),this.$refs["cui-upload"]["toggleBrowse"](),this.$nextTick(function(){t.dataForm.icon=a})},submitHandle:function(){var e=this;this.submitting||(this.submitting=!0,this.$refs["dataForm"].validate(function(t){if(t){["name"].forEach(function(t){e.compareData(t)});var a=Object(m["k"])(e.dataForm,e.paramsKeys);Object(f["j"])(a).then(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"任务分类成功！"):a;e.visible=!1,e.$message.success(n),e.updateTableHandle()}).catch(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"任务分类失败！"):a;e.$message.error(n)}).finally(function(){e.submitting=!1})}else e.submitting=!1}))},compareData:function(e){this.oldData[e]!==this.dataForm[e]&&this.fieldChangeHandle(e)},fieldChangeHandle:function(e){this.paramsKeys.includes(e)||this.paramsKeys.push(e)}}},V=K,J=Object(k["a"])(V,A,M,!1,null,null,null),Q=J.exports,G={components:{addOrUpdate:Q,listWithSearch:l["a"]},provide:function(){return{updateTableHandle:this.updateTableHandle}},data:function(){return{search:{name:""},showAddOrUpdate:!1,auditWay:["",{tag:"success",name:"手动审核"},{tag:"primary",name:"自动审核（非视频）"},{tag:"warning",name:"自动审核（视频）"}]}},methods:{cateList:f["a"],searchHandle:function(){this.$refs["wrapper"].searchHandle()},updateTableHandle:function(){this.$refs["wrapper"]["updateDataHandle"]()},addOrUpdateHandle:function(e){var t=this;this.showAddOrUpdate=!0,this.$nextTick(function(){t.$refs["addOrUpdate"]&&t.$refs["addOrUpdate"].init(e)})},deleteHandle:function(e){var t=this,a=e.name,n=e.id;this.$confirm("确认删除任务分类「".concat(a,"」？"),"删除任务分类").then(function(){Object(f["d"])(n).then(function(e){var a=e.message,n=void 0===a?"删除成功！":a;t.$message.success(n),t.updateTableHandle()}).catch(function(e){var a=e.message,n=void 0===a?"删除失败！":a;t.$message.error(n)})}).catch(m["i"])}}},Y=G,X=Object(k["a"])(Y,N,W,!1,null,null,null),Z=X.exports,ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-with-search",{ref:"wrapper",attrs:{"search-params":e.search,"remote-method":e.reportList,pages:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{label:"ID",prop:"id",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"举报任务",prop:"task","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.task,n=a.name,r=a.id;return[e._v(e._s(n)+" (#"+e._s(r)+")")]}}],null,!0)}),a("el-table-column",{attrs:{label:"举报内容",prop:"content","header-align":"center"}}),a("el-table-column",{attrs:{prop:"content",label:"举报截图",align:"center",width:"220"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row.images;return[a("image-dialog-wrapper",{attrs:{images:t||[]}})]}}],null,!0)}),a("el-table-column",{attrs:{label:"举报人",prop:"user",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.user,n=a.id,r=a.name;return[e._v(e._s(r)+" (#\\"+e._s(n)+")")]}}],null,!0)}),a("el-table-column",{attrs:{label:"联系方式",prop:"contact",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.contact;return[e._v(e._s(a||"--"))]}}],null,!0)}),a("el-table-column",{attrs:{label:"审核员",prop:"admin.name",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.admin;return[e._v(e._s(a&&a.name||"--"))]}}],null,!0)}),a("el-table-column",{attrs:{label:"状态",prop:"status",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row.status;return[a("el-tag",{attrs:{type:e.statusOp[n]["type"]}},[e._v(e._s(e.statusOp[n]["name"]))])]}}],null,!0)}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button-group",[0===n.status?[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.dealReportHandle(n,1)}}},[e._v("通过举报")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.dealReportHandle(n,2)}}},[e._v("驳回举报")])]:e._e(),1===n.status?[a("el-button",{attrs:{type:"success",size:"mini",disabled:!!n.reissue},on:{click:function(t){return e.reissueOrFinishHandle(n,"reissue")}}},[e._v("补发奖励")])]:e._e(),2===n.status?[a("el-tooltip",{attrs:{placement:"bottom-end"}},[a("span",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(n.fail_reason||"暂无理由"))]),a("span",[e._v("驳回理由"),a("i",{staticClass:"c-danger el-icon-info",staticStyle:{"margin-left":"3px"}})])])]:e._e()],2)]}}],null,!0)})],1)]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:"",model:e.search}},[a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入任务名称",clearable:""},model:{value:e.search.task_name,callback:function(t){e.$set(e.search,"task_name",t)},expression:"search.task_name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("任务名称")])])],1),a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入用户名称",clearable:""},model:{value:e.search.user_name,callback:function(t){e.$set(e.search,"user_name",t)},expression:"search.user_name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("用户名称")])])],1),a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入审核员名称",clearable:""},model:{value:e.search.admin_name,callback:function(t){e.$set(e.search,"admin_name",t)},expression:"search.admin_name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("审核员")])])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.searchHandle()}}},[e._v("查询")])],1),a("el-form-item",[a("el-radio-group",{on:{change:e.searchHandle},model:{value:e.search.status,callback:function(t){e.$set(e.search,"status",t)},expression:"search.status"}},[a("el-radio",{attrs:{label:-1}},[e._v("全部")]),a("el-radio",{attrs:{label:0}},[e._v("待处理")]),a("el-radio",{attrs:{label:1}},[e._v("成功")]),a("el-radio",{attrs:{label:2}},[e._v("失败")])],1)],1)],1)],1)],2)},te=[],ae=a("054f"),ne={components:{listWithSearch:l["a"]},data:function(){return{search:{task_name:"",user_name:"",admin_name:"",status:-1},statusOp:[{type:"info",name:"待处理"},{type:"success",name:"成功"},{type:"danger",name:"失败"}]}},methods:{getImageUrlByKey:ae["b"],reportList:f["n"],searchHandle:function(){this.$refs["wrapper"].searchHandle()},updateTableHandle:function(){this.$refs["wrapper"]&&this.$refs["wrapper"]["updateDataHandle"]()},dealReportHandle:function(e,t){var a=this,n=e.id,r=e.task.name,i=1===t?"通过":"驳回";this.$prompt("".concat(i,"举报任务「").concat(r,"」"),"".concat(i,"举报任务")).then(function(e){var s=e.value;a.$confirm("确认".concat(i,"举报任务「").concat(r,"」"),"".concat(i,"举报任务")).then(function(){Object(f["b"])({id:n,type:t,reason:s}).then(function(e){var t=e.message,n=void 0===t?"".concat(i,"举报任务成功！"):t;a.$message.success(n),a.updateTableHandle()}).catch(function(e){var t=e.message,n=void 0===t?"操作失败！":t;a.$message.error(n)})}).catch(m["i"])}).catch(m["i"])},reissueOrFinishHandle:function(e,t){var a=this,n=e.id,r=e.task.name,i="reissue"===t?"补发奖励":"完结任务";this.$confirm("「".concat(r,"」确认").concat(i,"?"),"".concat(i)).then(function(){Object(f["m"])({id:n,action:t}).then(function(e){var t=e.message,n=void 0===t?"".concat(i,"成功！"):t;a.$message.success(n),a.updateTableHandle()}).catch(function(e){var t=e.message,n=void 0===t?"操作失败！":t;a.$message.error(n)})}).catch(m["i"])}}},re=ne,ie=Object(k["a"])(re,ee,te,!1,null,null,null),se=ie.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-with-search",{ref:"wrapper",attrs:{"search-params":e.search,"remote-method":e.receiveList,pages:""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"ID",align:"center",width:"80"}}),a("el-table-column",{attrs:{prop:"task",label:"任务信息","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.task,n=a.id,r=a.name;return[e._v(e._s(r)+"(#"+e._s(n)+")")]}}],null,!0)}),a("el-table-column",{attrs:{prop:"user",label:"领取人","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.user,n=a.id,r=a.name;return[e._v(e._s(r)+"(#"+e._s(n)+")")]}}],null,!0)}),a("el-table-column",{attrs:{prop:"community",label:"社区信息","header-align":"center","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row.community,n=a.id,r=a.name;return[e._v(e._s(r)+"(#"+e._s(n)+")")]}}],null,!0)}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间","header-align":"center"}})],1)]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:"",model:e.search}},[a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入任务名称",clearable:""},model:{value:e.search.task_name,callback:function(t){e.$set(e.search,"task_name",t)},expression:"search.task_name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("任务名")])])],1),a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入领取人姓名",clearable:""},model:{value:e.search.user_name,callback:function(t){e.$set(e.search,"user_name",t)},expression:"search.user_name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("领取人")])])],1),a("el-form-item",[a("el-input",{attrs:{type:"text",placeholder:"请输入社区名称",clearable:""},model:{value:e.search.community_name,callback:function(t){e.$set(e.search,"community_name",t)},expression:"search.community_name"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("社区名")])])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.searchHandle()}}},[e._v("查询")])],1)],1)],1)],2)},le=[],ce={components:{listWithSearch:l["a"]},data:function(){return{search:{task_name:"",user_name:"",community_name:""}}},methods:{receiveList:f["l"],searchHandle:function(){this.$refs["wrapper"].searchHandle()},updateTableHandle:function(){this.$refs["wrapper"]["updateDataHandle"]()}}},ue=ce,de=Object(k["a"])(ue,oe,le,!1,null,null,null),pe=de.exports,me={name:"Square",components:{taskList:L,taskCateList:Z,taskReportList:se,taskReceiveList:pe},data:function(){return{activeName:this.$route.query.tab||"task"}},methods:{tabClickHandle:function(e){var t=e.name;this.$router.push({name:"square",query:{tab:t}})}}},fe=me,he=Object(k["a"])(fe,n,r,!1,null,null,null);t["default"]=he.exports},"2fdb":function(e,t,a){"use strict";var n=a("5ca1"),r=a("d2c8"),i="includes";n(n.P+n.F*a("5147")(i),"String",{includes:function(e){return!!~r(this,e,i).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},"386b":function(e,t,a){var n=a("5ca1"),r=a("79e5"),i=a("be13"),s=/"/g,o=function(e,t,a,n){var r=String(i(e)),o="<"+t;return""!==a&&(o+=" "+a+'="'+String(n).replace(s,"&quot;")+'"'),o+">"+r+"</"+t+">"};e.exports=function(e,t){var a={};a[e]=t(o),n(n.P+n.F*r(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",a)}},"386d":function(e,t,a){"use strict";var n=a("cb7c"),r=a("83a1"),i=a("5f1b");a("214f")("search",1,function(e,t,a,s){return[function(a){var n=e(this),r=void 0==a?void 0:a[t];return void 0!==r?r.call(a,n):new RegExp(a)[t](String(n))},function(e){var t=s(a,e,this);if(t.done)return t.value;var o=n(e),l=String(this),c=o.lastIndex;r(c,0)||(o.lastIndex=0);var u=i(o,l);return r(o.lastIndex,c)||(o.lastIndex=c),null===u?-1:u.index}]})},"456d":function(e,t,a){var n=a("4bf8"),r=a("0d58");a("5eda")("keys",function(){return function(e){return r(n(e))}})},"469f":function(e,t,a){a("6c1c"),a("1654"),e.exports=a("7d7b")},5147:function(e,t,a){var n=a("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[n]=!1,!"/./"[e](t)}catch(r){}}return!0}},"5d73":function(e,t,a){e.exports=a("469f")},"5eda":function(e,t,a){var n=a("5ca1"),r=a("8378"),i=a("79e5");e.exports=function(e,t){var a=(r.Object||{})[e]||Object[e],s={};s[e]=t(a),n(n.S+n.F*i(function(){a(1)}),"Object",s)}},6762:function(e,t,a){"use strict";var n=a("5ca1"),r=a("c366")(!0);n(n.P,"Array",{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},"768b":function(e,t,a){"use strict";var n=a("a745"),r=a.n(n);function i(e){if(r()(e))return e}var s=a("5d73"),o=a.n(s);function l(e,t){var a=[],n=!0,r=!1,i=void 0;try{for(var s,l=o()(e);!(n=(s=l.next()).done);n=!0)if(a.push(s.value),t&&a.length===t)break}catch(c){r=!0,i=c}finally{try{n||null==l["return"]||l["return"]()}finally{if(r)throw i}}return a}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function u(e,t){return i(e)||l(e,t)||c()}a.d(t,"a",function(){return u})},"7d7b":function(e,t,a){var n=a("e4ae"),r=a("7cd6");e.exports=a("584a").getIterator=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"90e7":function(e,t,a){"use strict";a.d(t,"j",function(){return i}),a.d(t,"C",function(){return s}),a.d(t,"a",function(){return o}),a.d(t,"t",function(){return l}),a.d(t,"f",function(){return c}),a.d(t,"y",function(){return u}),a.d(t,"l",function(){return d}),a.d(t,"E",function(){return p}),a.d(t,"d",function(){return m}),a.d(t,"w",function(){return f}),a.d(t,"e",function(){return h}),a.d(t,"x",function(){return b}),a.d(t,"o",function(){return g}),a.d(t,"H",function(){return v}),a.d(t,"k",function(){return _}),a.d(t,"D",function(){return w}),a.d(t,"g",function(){return y}),a.d(t,"z",function(){return k}),a.d(t,"n",function(){return x}),a.d(t,"G",function(){return S}),a.d(t,"q",function(){return H}),a.d(t,"J",function(){return O}),a.d(t,"h",function(){return F}),a.d(t,"A",function(){return $}),a.d(t,"i",function(){return I}),a.d(t,"B",function(){return T}),a.d(t,"r",function(){return j}),a.d(t,"K",function(){return C}),a.d(t,"p",function(){return q}),a.d(t,"I",function(){return U}),a.d(t,"b",function(){return z}),a.d(t,"u",function(){return D}),a.d(t,"s",function(){return E}),a.d(t,"L",function(){return P}),a.d(t,"c",function(){return B}),a.d(t,"v",function(){return R}),a.d(t,"m",function(){return L}),a.d(t,"F",function(){return N});var n=a("cebc"),r=a("c1fb");function i(){return r["a"].get("configs/invite")}function s(e){return r["a"].put("configs/invite",Object(n["a"])({},e))}function o(){return r["a"].get("config/about")}function l(e){return r["a"].put("config/about",Object(n["a"])({},e))}function c(){return r["a"].get("config/contact")}function u(e){return r["a"].put("config/contact",Object(n["a"])({},e))}function d(){return r["a"].get("config/plaza/task")}function p(e){return r["a"].put("config/plaza/task",Object(n["a"])({},e))}function m(){return r["a"].get("configs/collection")}function f(e){return r["a"].put("configs/collection",{money:e})}function h(){return r["a"].get("configs/collection/switch")}function b(e){return r["a"].put("configs/collection/switch",{switch:e})}function g(){return r["a"].get("config/site")}function v(e){return r["a"].put("config/site",Object(n["a"])({},e))}function _(){return r["a"].get("configs/ore")}function w(e){return r["a"].put("configs/ore",Object(n["a"])({},e))}function y(){return r["a"].get("config/group")}function k(e){return r["a"].put("config/group",Object(n["a"])({},e))}function x(){return r["a"].get("config/group/rule")}function S(e){return r["a"].put("config/group/rule",Object(n["a"])({},e))}function H(){return r["a"].get("config/user/grade")}function O(e){return r["a"].put("config/user/grade",Object(n["a"])({},e))}function F(){return r["a"].get("config/group/condition")}function $(e){return r["a"].put("config/group/condition",{condition:e})}function I(){return r["a"].get("config/group/max")}function T(e){return r["a"].put("config/group/max",Object(n["a"])({},e))}function j(){return r["a"].get("config/virtual/user")}function C(e){return r["a"].put("config/virtual/user",Object(n["a"])({},e))}function q(){return r["a"].get("config/plaza/task/reward")}function U(e){return r["a"].put("config/plaza/task/reward",Object(n["a"])({},e))}function z(){return r["a"].get("config/business")}function D(e){return r["a"].put("config/business",Object(n["a"])({},e))}function E(){return r["a"].get("configs/withdrawal")}function P(e){return r["a"].put("configs/withdrawal",e)}function B(){return r["a"].get("configs/cl/price")}function R(e){return r["a"].put("configs/cl/price",e)}function L(){return r["a"].get("configs/account/receivable")}function N(e){return r["a"].put("configs/account/receivable",e)}},"9dac":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{center:"",width:"500px",title:"文件上传",visible:e.visible,"append-to-body":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"cui-upload"},on:{"update:visible":function(t){e.visible=t},close:function(t){return e.afterDialogCloseHandle()}}},[a("el-upload",e._g(e._b({ref:"upload",staticClass:"cui-upload__wrapper",attrs:{limit:e.limit,accept:e.accept,multiple:e.multiple,action:e.uploadUrl,"auto-upload":!1,"list-type":e.listType,"on-exceed":e.exceedHandle,"on-preview":e.previewHandle,"on-success":e.successHandle,"before-upload":e.beforeUpload,"before-remove":e.beforeRemoveHandle,"http-request":e.uploadFileWithQiniu}},"el-upload",e.$attrs,!1),e.$listeners),[a("el-button",{ref:"browse",attrs:{slot:"trigger",size:"small",type:"warning",icon:"el-icon-upload"},slot:"trigger"},[e._v("选取文件")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._t("tip",[e._v(e._s(e.tip||"只能上传jpg/png文件，且不超过500kb"))])],2)],1),a("el-dialog",{attrs:{title:e.previewTitle,visible:e.previewVisible,top:"5vh","append-to-body":""},on:{"update:visible":function(t){e.previewVisible=t}}},[a("img",{attrs:{width:"100%",src:e.previewUrl,alt:e.previewTitle}})]),a("template",{slot:"footer"},[a("el-button",{attrs:{type:"default"},on:{click:function(t){return e.beforeDialogCloseHandle()}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.submitUpload}},[e._v("上传")])],1)],2)},r=[],i=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("ac6a"),a("456d"),a("c5f6"),a("ed08")),o=a("054f"),l=a("5f87"),c=a("3786"),u={name:"cui-upload",props:{multiple:Boolean,listType:{type:String,default:"text"},accept:{type:String,default:"image/jpeg,image/gif,image/png"},tip:String,limit:Number,beforeUpload:Function,validFile:Function},data:function(){return{uploadUrl:"",previewUrl:"",previewTitle:"图片预览",visible:!1,previewVisible:!1,reqs:{},uploadToken:""}},computed:{submitting:function(){return Object.keys(this.reqs).length>0}},methods:{isImage:function(e){return-1!==e.indexOf("image")},toggleBrowse:function(){this.visible=!this.visible},afterDialogCloseHandle:function(){this.$refs["upload"].clearFiles()},beforeDialogCloseHandle:function(){var e=this;if(this.submitting)return this.$confirm("文件上传中，是否取消上传？","提示",{type:"warning",confirmButtonText:"继续上传",cancelButtonText:"取消上传并退出"}).then(s["i"]).catch(function(){e.clearReqs(null,function(){e.visible=!1})}),!1;this.visible=!1},exceedHandle:function(){this.$alert("超过最大文件数，请移除多余文件！","提示",{type:"warning"}).catch(s["i"])},beforeRemoveHandle:function(e){return this.$confirm("确定移除文件[".concat(e.name,"]？"),"移除文件")},clearReqs:function(e,t){if(e)this.reqs[e]["abort"](),this.$delete(this.reqs,e);else for(var a in this.reqs)this.reqs[a].abort();t()},previewHandle:function(e){var t=this,a=e.raw.type,n=e.url,r=e.name;this.isImage(a)&&n&&(this.previewUrl=n,this.previewTitle=r||this.previewTitle,this.$nextTick(function(){t.previewVisible=!0}))},successHandle:function(e,t,a){this.$emit("on-upload-success",e,t,a)},submitUpload:function(){if(!this.submitting){var e=this.$refs["upload"];e&&(e.uploadFiles.length?this.$refs["upload"].submit():this.$alert("请选择需要上传的文件！","提示",{type:"warning"}).catch(s["i"]))}},uploadFileWithQiniu:function(e){var t=this,a=e.file,n=e.onSuccess,r=e.onError,i=e.onProgress,s=a.uid,c=function(){t.$delete(t.reqs,s)},u=function(){c(),n.apply(void 0,arguments)},d=function(){c();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];401===t[0].code&&l["a"].logout("登录失效，是否前往登录页重新登录？","重新登录",{confirmButtonText:"重新登录",showCancelButton:!1}),r.apply(void 0,t)},p=function(e){var t=e.total;i(t)},m=Object(o["a"])(this.uploadToken,a,u,d,p);return this.$set(this.reqs,s,m),m.abort=function(){c(),m.unsubscribe()},m},refreshUploadToken:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["b"])();case 2:t=e.sent,a=t.data,this.uploadToken=a;case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.refreshUploadToken()}},d=u,p=a("2877"),m=Object(p["a"])(d,n,r,!1,null,null,null);t["a"]=m.exports},a8db:function(e,t,a){"use strict";var n=a("e265"),r=a.n(n),i=a("a4bb"),s=a.n(i);function o(e,t){if(null==e)return{};var a,n,r={},i=s()(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}function l(e,t){if(null==e)return{};var a,n,i=o(e,t);if(r.a){var s=r()(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}a.d(t,"a",function(){return l})},b54a:function(e,t,a){"use strict";a("386b")("link",function(e){return function(t){return e(this,"a","href",t)}})},b74f2:function(e,t,a){"use strict";var n=a("d3c3"),r=a.n(n);r.a},d2c8:function(e,t,a){var n=a("aae3"),r=a("be13");e.exports=function(e,t,a){if(n(t))throw TypeError("String#"+a+" doesn't accept regex!");return String(r(e))}},d3c3:function(e,t,a){}}]);