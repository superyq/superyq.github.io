(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages21"],{"11c1":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cui-page"},[e.$slots["header"]?n("div",{staticClass:"cui-page-header"},[e._t("header")],2):e._e(),e._t("default",null,null,{data:e.data}),e.pages&&!e.scroll?n("div",{staticClass:"cui-page-footer"},[n("cui-pagination",{attrs:{total:e.total,limit:e.limit,current:e.page},on:{"size-change":e.limitChangeHandle,"current-change":e.pageChangeHandle}})],1):e._e()],2)},i=[],r=(n("96cf"),n("3b8d")),s=n("cebc"),l=n("20ca"),c={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(e,t){this.$set(this.data,e,Object(s["a"])({},this.data[e],t))},deleteItem:function(e){this.data.splice(e,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:return this.loading=!0,e.next=5,this.formatSearchParams();case 5:return t=e.sent,e.prev=6,e.next=9,this.remoteMethod(t).then(this.formatSearchResult);case 9:n=e.sent,this.$emit("updateSuccess",n),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](6),this.$emit("updateFailed",e.t0);case 16:this.loading=!1;case 17:case"end":return e.stop()}},e,this,[[6,13]])}));function t(){return e.apply(this,arguments)}return t}(),formatSearchParams:function(){var e={};return this.pages&&Object.assign(e,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(e,this.searchParams),e},formatSearchResult:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,a,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.formatResponse){e.next=4;break}return e.next=3,this.formatResponse(t);case 3:t=e.sent;case 4:return n=t,a=n.data,this.pages?(i=a.total,r=a.data,this.scroll?(this.isBottom=r.length<this.limit,this.data=this.data.concat(r)):this.data=r,this.total=i):this.data=a,e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),limitChangeHandle:function(e){this.limit=e,this.updateDataHandle()},pageChangeHandle:function(e){this.page=e,this.updateDataHandle()},scrollHandle:Object(l["a"])(function(){if(!this.isBottom){var e=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;e&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var e=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",e.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},o=c,d=n("2877"),u=Object(d["a"])(o,a,i,!1,null,null,null);t["a"]=u.exports},"1f27":function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return l});var a=n("a8db"),i=n("c1fb");function r(e){return i["a"].get("menus",{params:e})}function s(e){var t=e.id,n=Object(a["a"])(e,["id"]),r={data:n,url:"menus/".concat(t||""),method:t?"PUT":"POST"};return Object(i["a"])(r)}function l(e){var t=e.id;return i["a"].delete("select-menu-error-shell/".concat(t))}},"2fdb":function(e,t,n){"use strict";var a=n("5ca1"),i=n("d2c8"),r="includes";a(a.P+a.F*n("5147")(r),"String",{includes:function(e){return!!~i(this,e,r).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},5147:function(e,t,n){var a=n("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[a]=!1,!"/./"[e](t)}catch(i){}}return!0}},6762:function(e,t,n){"use strict";var a=n("5ca1"),i=n("c366")(!0);a(a.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")("includes")},"895a":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("list-with-search",{ref:"wrapper",attrs:{"search-params":e.search,"remote-method":e.getRoles},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return[n("cui-table",{attrs:{data:a}},[n("el-table-column",{attrs:{prop:"id",label:"ID",align:"center",width:"80"}}),n("el-table-column",{attrs:{prop:"name",label:"角色名称",align:"center"}}),n("el-table-column",{attrs:{prop:"alias",label:"角色标识",align:"center"}}),n("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;t.$index;return[n("el-button-group",[n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.addOrUpdateHandle(a)}}},[e._v("编辑")]),n("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.deleteHandle(a)}}},[e._v("删除")])],1)]}}],null,!0)})],1),e.showAddOrUpdate?n("add-or-update",{ref:"addOrUpdate"}):e._e()]}}])},[n("template",{slot:"header"},[n("el-form",{attrs:{size:"mini",inline:"",model:e.search}},[n("el-form-item",{attrs:{prop:"name"}},[n("el-input",{attrs:{type:"text",placeholder:"支持模糊查询",clearable:""},model:{value:e.search.name,callback:function(t){e.$set(e.search,"name",t)},expression:"search.name"}},[n("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("名称")])])],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.updateTableHandle()}}},[e._v("查询")]),n("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(t){return e.addOrUpdateHandle()}}},[e._v("新增")])],1)],1)],1)],2)},i=[],r=(n("7f7f"),n("11c1")),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.action+"角色","close-on-click-modal":!1,visible:e.visible,width:"800px"},on:{"update:visible":function(t){e.visible=t}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{model:e.dataForm,rules:e.dataRule,"label-width":"95px","label-suffix":"："},nativeOn:{submit:function(e){e.preventDefault()}}},[n("el-form-item",{attrs:{prop:"name",label:"角色名称"}},[n("el-input",{attrs:{type:"text",placeholder:"名称"},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1),n("el-form-item",{attrs:{prop:"alias",label:"角色标识"}},[n("el-input",{attrs:{type:"text",placeholder:"标识"},model:{value:e.dataForm.alias,callback:function(t){e.$set(e.dataForm,"alias",t)},expression:"dataForm.alias"}})],1),n("el-form-item",{attrs:{prop:"permissions",label:"角色权限"}},[e.permsEditable?[n("menu-tree",{ref:"menu-tree",attrs:{defaultCheckedkeys:e.dataForm.permissions}})]:n("span",[e._v("请在新增角色成功后，通过「编辑」操作为新增角色添加「角色权限」")])],2)],1),n("template",{slot:"footer"},[n("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),n("el-button",{attrs:{type:"primary",disabled:e.submitting,loading:e.submitting},on:{click:function(t){return e.submitHandle()}}},[e._v("确定")])],1)],2)},l=[],c=n("ed08"),o=n("cc5e"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"menu-tree",attrs:{"node-key":"id","show-checkbox":"",data:e.menus,"check-on-click-node":!0,"expand-on-click-node":!1,props:{label:"name",children:"children"}}})},u=[],h=(n("6762"),n("2fdb"),n("ac6a"),n("75fc")),f=n("1f27"),m=n("c0a5"),p={name:"menuTree",props:{defaultCheckedkeys:Array},data:function(){return{menus:[],loading:!1}},methods:{getMenusHandle:function(){var e=this;this.loading||(this.loading=!0,Object(f["b"])().then(function(t){var n=t.data;e.formatMenuData(n),e.loading=!1}).catch(function(){e.loading=!1}))},formatMenuData:function(e){this.menus=Object(m["a"])(e),this.defaultCheckedkeys&&this.defaultCheckedkeys.length>0&&this.setCheckedKeys(this.filterFullCheckedKeys(this.menus,this.defaultCheckedkeys))},setCheckedKeys:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.$refs["menu-tree"].setCheckedKeys(e)},getAllCheckedKeys:function(){var e=this.$refs["menu-tree"];return[].concat(Object(h["a"])(e.getCheckedKeys()),Object(h["a"])(e.getHalfCheckedKeys()))},filterFullCheckedKeys:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return!n.length>0?a:(e.forEach(function(e){var i=e.id,r=e.children;if(n.includes(i)){var s=Array.isArray(r)?r.length:0;s?t.filterFullCheckedKeys(r,n,a):a.push(i)}}),a)}},mounted:function(){this.getMenusHandle()}},g=p,b=n("2877"),v=Object(b["a"])(g,d,u,!1,null,null,null),k=v.exports,y={name:"addOrUpdate",components:{menuTree:k},inject:["updateTableHandle"],data:function(){return{dataForm:{id:0,name:"",alias:"",permissions:[]},dataRule:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],alias:[{required:!0,message:"标识不能为空",trigger:"blur"}]},action:"新增",visible:!1,permsEditable:!1,loading:!1,submitting:!1}},methods:{init:function(e){var t=this;this.visible=!0,this.$nextTick(function(){t.action="新增",t.permsEditable=!1,t.$refs["dataForm"].resetFields(),e&&e.id&&(t.action="编辑",t.permsEditable=!0,e.permissions=e.permissions?e.permissions.map(function(e){var t=e.id;return t}):[],Object(c["a"])(t.dataForm,e))})},submitHandle:function(){var e=this;this.submitting||(this.submitting=!0,this.$confirm("确认".concat(this.action,"角色？"),"".concat(this.action),{type:"warning"}).then(function(){var t=e.dataForm;t.id&&(t.permissions=e.getPermissions()),Object(o["c"])(t).then(function(){e.$message.success("".concat(e.action,"角色成功！")),e.visible=!1,e.updateTableHandle()}).catch(function(t){var n=t.message,a=void 0===n?"".concat(e.action,"角色失败！"):n;e.$message.error(a)}).finally(function(){e.submitting=!1})}).catch(function(){e.submitting=!1}))},getPermissions:function(){return this.$refs["menu-tree"].getAllCheckedKeys()}}},O=y,w=Object(b["a"])(O,s,l,!1,null,null,null),x=w.exports,H={name:"pageRole",components:{addOrUpdate:x,listWithSearch:r["a"]},provide:function(){return{updateTableHandle:this.updateTableHandle}},data:function(){return{search:{name:""},deleting:!1,showAddOrUpdate:!1}},methods:{getRoles:o["b"],updateTableHandle:function(){this.$refs["wrapper"]["updateDataHandle"]()},addOrUpdateHandle:function(e){var t=this;this.showAddOrUpdate=!0,this.$nextTick(function(){t.$refs["addOrUpdate"]&&t.$refs["addOrUpdate"].init(e)})},deleteHandle:function(e){var t=this;if(!this.deleting){this.deleting=!0;var n=e.name,a=e.id;this.$confirm("确认删除角色「".concat(n,"」？"),"删除角色").then(function(){Object(o["a"])(a).then(function(){t.$message.success("删除成功！"),t.updateTableHandle(),t.deleting=!1}).catch(function(e){var n=e.message,a=void 0===n?"删除失败！":n;t.$message.error(a),t.deleting=!1})}).catch(c["i"])}}}},$=H,_=Object(b["a"])($,a,i,!1,null,null,null);t["default"]=_.exports},a8db:function(e,t,n){"use strict";var a=n("e265"),i=n.n(a),r=n("a4bb"),s=n.n(r);function l(e,t){if(null==e)return{};var n,a,i={},r=s()(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}function c(e,t){if(null==e)return{};var n,a,r=l(e,t);if(i.a){var s=i()(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}n.d(t,"a",function(){return c})},c0a5:function(e,t,n){"use strict";function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"id",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"pid",a=[],i={},r=0;r<e.length;r++)i[e[r][t]]=e[r];for(var s=0;s<e.length;s++)i[e[s][n]]&&e[s][t]!==e[s][n]?(i[e[s][n]]["children"]||(i[e[s][n]]["children"]=[]),i[e[s][n]]["_level"]||(i[e[s][n]]["_level"]=1),e[s]["parent"]=i[e[s][n]],e[s]["_level"]=i[e[s][n]]._level+1,i[e[s][n]]["children"].push(e[s])):a.push(e[s]);return a}n.d(t,"a",function(){return a})},cc5e:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return l});var a=n("a8db"),i=n("c1fb");function r(e){return i["a"].get("roles",{params:e})}function s(e){var t=e.id,n=Object(a["a"])(e,["id"]),r={data:n,url:"roles/".concat(t||""),method:t?"PUT":"POST"};return Object(i["a"])(r)}function l(e){return i["a"].delete("roles/".concat(e))}},d2c8:function(e,t,n){var a=n("aae3"),i=n("be13");e.exports=function(e,t,n){if(a(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}}}]);