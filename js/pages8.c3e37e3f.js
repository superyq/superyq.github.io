(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages8"],{"11c1":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cui-page"},[e.$slots["header"]?a("div",{staticClass:"cui-page-header"},[e._t("header")],2):e._e(),e._t("default",null,null,{data:e.data}),e.pages&&!e.scroll?a("div",{staticClass:"cui-page-footer"},[a("cui-pagination",{attrs:{total:e.total,limit:e.limit,current:e.page},on:{"size-change":e.limitChangeHandle,"current-change":e.pageChangeHandle}})],1):e._e()],2)},i=[],r=(a("96cf"),a("3b8d")),s=a("cebc"),l=a("20ca"),o={name:"listWithSearch",props:{scroll:Boolean,pages:Boolean,searchParams:Object,remoteMethod:{type:Function,required:!0},formatResponse:Function},data:function(){return{data:[],page:1,total:0,limit:20,loading:!1,isBottom:!1}},methods:{changeItem:function(e,t){this.$set(this.data,e,Object(s["a"])({},this.data[e],t))},deleteItem:function(e){this.data.splice(e,1)},searchHandle:function(){this.data=[],this.page=1,this.updateDataHandle()},updateDataHandle:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:return this.loading=!0,e.next=5,this.formatSearchParams();case 5:return t=e.sent,e.prev=6,e.next=9,this.remoteMethod(t).then(this.formatSearchResult);case 9:a=e.sent,this.$emit("updateSuccess",a),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](6),this.$emit("updateFailed",e.t0);case 16:this.loading=!1;case 17:case"end":return e.stop()}},e,this,[[6,13]])}));function t(){return e.apply(this,arguments)}return t}(),formatSearchParams:function(){var e={};return this.pages&&Object.assign(e,{page:this.page,limit:this.limit}),this.searchParams&&Object.assign(e,this.searchParams),e},formatSearchResult:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var a,n,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.formatResponse){e.next=4;break}return e.next=3,this.formatResponse(t);case 3:t=e.sent;case 4:return a=t,n=a.data,this.pages?(i=n.total,r=n.data,this.scroll?(this.isBottom=r.length<this.limit,this.data=this.data.concat(r)):this.data=r,this.total=i):this.data=n,e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),limitChangeHandle:function(e){this.limit=e,this.updateDataHandle()},pageChangeHandle:function(e){this.page=e,this.updateDataHandle()},scrollHandle:Object(l["a"])(function(){if(!this.isBottom){var e=document.documentElement.offsetHeight-document.documentElement.scrollTop-window.innerHeight<=200;e&&(this.page+=1,this.updateDataHandle())}},1e3),resetScroll:function(){var e=this;window.removeEventListener("scroll",this.scrollHandle,!1),this.$nextTick(function(){window.addEventListener("scroll",e.scrollHandle,!1)})}},mounted:function(){this.scroll&&window.addEventListener("scroll",this.scrollHandle,!1),this.updateDataHandle()},destroyed:function(){this.scroll&&window.removeEventListener("scroll",this.scrollHandle,!1)}},c=o,d=a("2877"),u=Object(d["a"])(c,n,i,!1,null,null,null);t["a"]=u.exports},"28a6":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("list-with-search",{ref:"wrapper",attrs:{"remote-method":e.getLevelList},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return[a("cui-table",{attrs:{data:n}},[a("el-table-column",{attrs:{prop:"id",label:"ID",align:"center",width:"80"}}),a("el-table-column",{attrs:{prop:"level",label:"等级",align:"center",width:"80"}}),a("el-table-column",{attrs:{prop:"max_members",label:"成员上限","header-align":"center"}}),a("el-table-column",{attrs:{prop:"max_admins",label:"管理员上限","header-align":"center"}}),a("el-table-column",{attrs:{prop:"price.cny",label:"现金价格","header-align":"center"}}),a("el-table-column",{attrs:{prop:"price.ct",label:"CT(矿石)价格","header-align":"center"}}),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间",align:"center",width:"200"}}),a("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"190"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.addOrUpdateHandle(n)}}},[e._v("修改")]),a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(t){return e.deleteHandle(n)}}},[e._v("删除")])],1)]}}],null,!0)})],1),e.showAddOrUpdate?a("add-or-update",{ref:"addOrUpdate"}):e._e()]}}])},[a("template",{slot:"header"},[a("el-form",{attrs:{size:"mini",inline:""}},[a("el-form-item",[a("el-button",{attrs:{type:"warning",icon:"el-icon-plus"},on:{click:function(t){return e.addOrUpdateHandle()}}},[e._v("新增")])],1)],1)],1)],2)},i=[],r=a("a8db"),s=a("c1fb");function l(e){return s["a"].get("group/upgrade",{params:e})}function o(e){var t=e.id,a=Object(r["a"])(e,["id"]),n={data:a,url:"group/upgrade/".concat(t||""),method:t?"PUT":"POST"};return Object(s["a"])(n)}function c(e){return s["a"].delete("group/upgrade/".concat(e))}var d=a("ed08"),u=a("11c1"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.action+"群等级","close-on-click-modal":!1,visible:e.visible,width:"600px"},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"dataForm",staticClass:"m-auto",staticStyle:{width:"400px"},attrs:{model:e.dataForm,"label-width":"120px","label-suffix":"："},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"d-none",attrs:{prop:"id"}}),a("el-form-item",{attrs:{prop:"level",label:"等级",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:2,max:127},model:{value:e.dataForm.level,callback:function(t){e.$set(e.dataForm,"level",t)},expression:"dataForm.level"}})],1),a("el-form-item",{attrs:{prop:"max_members",label:"成员上限",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:e.dataForm.max_members,callback:function(t){e.$set(e.dataForm,"max_members",t)},expression:"dataForm.max_members"}})],1),a("el-form-item",{attrs:{prop:"max_admins",label:"管理员上限",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:e.dataForm.max_admins,callback:function(t){e.$set(e.dataForm,"max_admins",t)},expression:"dataForm.max_admins"}})],1),a("el-form-item",{attrs:{prop:"price.cny",label:"现金价格",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:e.dataForm.price.cny,callback:function(t){e.$set(e.dataForm.price,"cny",t)},expression:"dataForm.price.cny"}})],1),a("el-form-item",{attrs:{prop:"price.ct",label:"CT(矿石)价格",required:""}},[a("el-input-number",{attrs:{precision:0,step:1,min:0},model:{value:e.dataForm.price.ct,callback:function(t){e.$set(e.dataForm.price,"ct",t)},expression:"dataForm.price.ct"}})],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",disabled:e.submitting,loading:e.submitting},on:{click:function(t){return e.submitHandle()}}},[e._v("确定")])],1)],2)},p=[],h=(a("6762"),a("2fdb"),a("ac6a"),{name:"AddOrUpdate",inject:["updateTableHandle"],data:function(){return{dataForm:{id:0,level:2,max_members:1,max_admins:1,price:{ct:0,cny:0}},visible:!1,submitting:!1,paramsKeys:["id","max_members","max_admins","price"],oldData:{}}},computed:{isEdit:function(){return!!this.dataForm.id},action:function(){return this.dataForm.id?"修改":"新增"}},methods:{resetFields:function(){this.paramsKeys=["id","max_members","max_admins","price"],this.$refs["dataForm"].resetFields()},init:function(e){var t=this;this.visible=!0,this.$nextTick(function(){t.resetFields(),e&&e.id&&(t.oldData=e,t.dataForm=Object(d["b"])(e))})},submitHandle:function(){var e=this;if(!this.submitting){this.submitting=!0;var t=this.dataForm.price,a=t.ct,n=t.cny;if(!a&&!n)return this.submitting=!1,this.$message.error("CT(矿石)价格和现金价格必填一个");this.$refs["dataForm"].validate(function(t){if(t){["level"].forEach(function(t){e.compareData(t)});var a=Object(d["k"])(e.dataForm,e.paramsKeys);o(a).then(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"成功！"):a;e.$message.success(n),e.visible=!1,e.updateTableHandle()}).catch(function(t){var a=t.message,n=void 0===a?"".concat(e.action,"失败！"):a;e.$message.error(n)}).finally(function(){e.submitting=!1})}else e.submitting=!1})}},compareData:function(e){this.oldData[e]!==this.dataForm[e]&&this.fieldChangeHandle(e)},fieldChangeHandle:function(e){this.paramsKeys.includes(e)||this.paramsKeys.push(e)}}}),f=h,b=a("2877"),g=Object(b["a"])(f,m,p,!1,null,null,null),v=g.exports,x={name:"GroupLevel",components:{listWithSearch:u["a"],addOrUpdate:v},provide:function(){return{updateTableHandle:this.updateTableHandle}},data:function(){return{showAddOrUpdate:!1}},methods:{getLevelList:l,updateTableHandle:function(){this.$refs["wrapper"]&&this.$refs["wrapper"].updateDataHandle()},addOrUpdateHandle:function(e){var t=this;this.showAddOrUpdate=!0,this.$nextTick(function(){t.$refs["addOrUpdate"]&&t.$refs["addOrUpdate"].init(e)})},deleteHandle:function(e){var t=this,a=e.level,n=e.id;this.$confirm("确认删除「".concat(a,"」等级？"),"删除等级").then(function(){c(n).then(function(e){var a=e.message,n=void 0===a?"删除成功！":a;t.$message.success(n),t.updateTableHandle()}).catch(function(e){var a=e.message,n=void 0===a?"删除失败！":a;t.$message.error(n)})}).catch(d["i"])}}},w=x,_=Object(b["a"])(w,n,i,!1,null,null,null);t["default"]=_.exports},"2fdb":function(e,t,a){"use strict";var n=a("5ca1"),i=a("d2c8"),r="includes";n(n.P+n.F*a("5147")(r),"String",{includes:function(e){return!!~i(this,e,r).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},5147:function(e,t,a){var n=a("2b4c")("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[n]=!1,!"/./"[e](t)}catch(i){}}return!0}},6762:function(e,t,a){"use strict";var n=a("5ca1"),i=a("c366")(!0);n(n.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")("includes")},a8db:function(e,t,a){"use strict";var n=a("e265"),i=a.n(n),r=a("a4bb"),s=a.n(r);function l(e,t){if(null==e)return{};var a,n,i={},r=s()(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}function o(e,t){if(null==e)return{};var a,n,r=l(e,t);if(i.a){var s=i()(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}a.d(t,"a",function(){return o})},d2c8:function(e,t,a){var n=a("aae3"),i=a("be13");e.exports=function(e,t,a){if(n(t))throw TypeError("String#"+a+" doesn't accept regex!");return String(i(e))}}}]);