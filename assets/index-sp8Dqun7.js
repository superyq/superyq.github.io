import{g as O,r as s,U as $,aV as M,B as V,C as T,F as t,ai as D,h as S,o as A,D as p,J as u,a7 as R,a3 as q,aj as E,N as P,al as j}from"./index-C89OI0f9.js";import{_ as B}from"./YTable.vue_vue_type_script_setup_true_lang-BEU5Wls0.js";import{d as K,g as Y,a as z,_ as H}from"./menu-CsxBV6zb.js";import{a as J,c as L,b as G}from"./table-DQ5GbIjj.js";import{_ as Q}from"./YRadio.vue_vue_type_script_setup_true_lang-DDDAGbL0.js";import{_ as C}from"./YInput.vue_vue_type_script_setup_true_lang-Dl0ZddmA.js";import{N as y,_ as W}from"./FormItem-7-0DUW0z.js";import"./Checkbox-CDa4N757.js";import"./RadioGroup-CzrGAwm-.js";import"./Dropdown-B4qkqsJv.js";import"./use-keyboard-CzUaIFAX.js";const X=O({__name:"Table",props:{params:{type:Object,required:!0}},emits:["edit","add"],setup(w,{expose:I,emit:d}){const i=w,l=d,k=G("menuId"),N=J([{title:"菜单名称",key:"menuName",width:"200",fixed:"left"},{title:"排序",key:"menuIndex",width:"80"},{title:"组件路径",key:"component",width:"200"},{title:"路由",key:"path",width:"200"},{title:"操作",key:"action",fixed:"right",width:160,render(e){return L([{label:"修改",icon:"edit",onClick:g.bind(null,e)},{label:"新增",icon:"add",onClick:x.bind(null,e)},{label:"删除",icon:"delete",onClick:h.bind(null,e)}])}}],{align:"center"}),g=e=>{l("edit",e)},x=e=>{l("add",e)},h=e=>{window.$dialog.warning({title:"警告",content:`确定删除 '${e.menuName}' ?`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{K(e.menuId).then(()=>{window.$msg.success("删除成功"),m()})}})},c=e=>{let r=[];return e.forEach(a=>{a.childs?r.push({label:a.menuName,key:a.menuId,children:c(a.childs)}):r.push({label:a.menuName,key:a.menuId})}),r};let o=s(!1),f=$([]),_=$([]);const m=()=>(o.value=!0,new Promise(e=>{Y(i.params).then(r=>{f=M(r.data,0),_=[{key:0,label:"主类目",children:c(f)}],o.value=!1,e(_)})}));return I({getTable:m}),(e,r)=>{const a=B;return V(),T(a,{loading:t(o),columns:t(N),data:t(f),"row-key":t(k),"children-key":"childs"},null,8,["loading","columns","data","row-key"])}}}),Z=O({__name:"Form",props:{formId:[Number,String],parentId:Number,options:{type:Array,required:!0},form:{type:Object,default:{}}},setup(w,{expose:I}){const d=w;let i={parentId:0,menuType:"M",menuName:"",menuIndex:1,path:"",component:""},l=s(D(i));const k={menuName:{required:!0,trigger:["input","blur"],message:"请输入菜单名称"},sort:{required:!0,message:"请输入排序"},path:{required:!0,trigger:["input","blur"],message:"请输入路由地址"}},N=()=>{l.value=d.form};let g=s(null);const x=()=>{l.value=D(i)},h=()=>new Promise((m,e)=>{g.value.validate(r=>{r?e(!1):z(l.value).then(()=>{window.$msg.success(`${l.value.userId?"修改":"新增"}目录成功！`),m(!0)}).catch(()=>{e(!1)})})}),c=m=>{l.value.parentId=m},o=[{label:"目录",value:"M"},{label:"菜单",value:"C"}],f={M:["icon","path","status"],C:["icon","path","component","status","perms"],F:["perms"]};let _=S(()=>f[l.value.menuType]);return I({validateForm:h}),A(()=>{x(),d.formId&&N(),d.parentId&&(l.value.parentId=d.parentId),console.log(1,d.parentId)}),(m,e)=>{const r=H,a=Q,F=W;return V(),T(F,{class:"u__grid-c2",ref_key:"formRef",ref:g,model:t(l),rules:k,"label-placement":"left","require-mark-placement":"left","label-width":"80"},{default:p(()=>[u(t(y),{path:"parentId",label:"上级菜单",style:{"grid-area":"1 / 1 / 2 / 3"}},{default:p(()=>[u(r,{value:t(l).parentId,options:w.options,"onUpdate:value":c,size:"small"},null,8,["value","options"])]),_:1}),u(t(y),{path:"menuType",label:"菜单类型"},{default:p(()=>[u(a,{modelValue:t(l).menuType,"onUpdate:modelValue":e[0]||(e[0]=n=>t(l).menuType=n),options:o},null,8,["modelValue"])]),_:1}),u(t(y),{path:"menuName",label:"菜单名称"},{default:p(()=>[u(C,{modelValue:t(l).menuName,"onUpdate:modelValue":e[1]||(e[1]=n=>t(l).menuName=n)},null,8,["modelValue"])]),_:1}),t(_).includes("path")?(V(),T(t(y),{key:0,path:"path",label:"路由地址"},{default:p(()=>[u(C,{modelValue:t(l).path,"onUpdate:modelValue":e[2]||(e[2]=n=>t(l).path=n)},null,8,["modelValue"])]),_:1})):R("",!0),t(_).includes("component")?(V(),T(t(y),{key:1,path:"component",label:"组件路径"},{default:p(()=>[u(C,{modelValue:t(l).component,"onUpdate:modelValue":e[3]||(e[3]=n=>t(l).component=n)},null,8,["modelValue"])]),_:1})):R("",!0),u(t(y),{path:"menuIndex",label:"显示排序"},{default:p(()=>[u(C,{isNumber:"",modelValue:t(l).menuIndex,"onUpdate:modelValue":e[4]||(e[4]=n=>t(l).menuIndex=n),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),ee=q(Z,[["__scopeId","data-v-61a17c41"]]),pe=O({__name:"index",setup(w){let I=s(null);const d=s(null),i=()=>{d.value.getTable().then(n=>{I.value=l(n)})},l=n=>(console.log(1,n),n.map(v=>(v.children.length?v.children=l(v.children):delete v.children,v))),k=$({del:!1,export:!1,import:!1});let N=$({}),g=S(()=>Object.assign({},N));const x=()=>{i()};let h=s(""),c=s(!1),o=s(!1),f=s(null),_=s(""),m=s(null);const e=(n=null)=>{const b=!!n;_.value=b?n.menuId:"",m.value=b?n:null,h.value=`${b?"编辑":"新增"}菜单`,o.value=!0,a.value=0},r=()=>{c.value=!0,f.value.validateForm().then(()=>{o.value=!1,i()}).catch(()=>{}).finally(()=>{c.value=!1})};let a=s(0);const F=n=>{a.value=n.menuId,h.value="新增菜单",o.value=!0};return E("btnload",c),A(()=>{i()}),(n,b)=>{const v=j;return V(),T(v,{title:t(h),controlShow:k,uploadTitle:"导入用户列表",show:t(o),"onUpdate:show":b[0]||(b[0]=U=>P(o)?o.value=U:o=U),onAdd:e,onSearch:i,onReset:x,onSubmit:r},{table:p(()=>[u(X,{ref_key:"table",ref:d,params:t(g),onEdit:e,onAdd:F},null,8,["params"])]),form:p(()=>[u(ee,{ref_key:"form",ref:f,formId:t(_),form:t(m),parentId:t(a),options:t(I)},null,8,["formId","form","parentId","options"])]),_:1},8,["title","controlShow","show"])}}});export{pe as default};
