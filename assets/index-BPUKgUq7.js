import{g as V,h as O,B as T,C as N,aU as $,t as K,r as u,U as D,F as a,ai as F,o as U,D as C,J as k,aV as P,a3 as M,aj as j,N as R,a7 as z,al as H}from"./index-_v_ROuBL.js";import{_ as q,g as A}from"./menu-CqgK61q6.js";import{_ as L}from"./YTable.vue_vue_type_script_setup_true_lang-BQ6OwsLK.js";import{a as W,c as J,b as Y}from"./table-a_mX3Frg.js";import{R as G}from"./Rich-PfdfXcev.js";import{N as S,_ as Q}from"./FormItem-BtzGq-Ay.js";import"./Checkbox-CY6MvvVb.js";import"./RadioGroup-C0TaMrjb.js";import"./Dropdown-Ct-AoJJL.js";import"./use-keyboard-Bv3MiPgx.js";const X=V({__name:"Search",props:{modelValue:{type:Object,required:!0},options:{type:Array,required:!0}},emits:["update:modelaValue","search"],setup(r,{emit:i}){const c=r,f=i,t=O({get(){return c.modelValue},set(l){f("update:modelaValue",l)}}),p=l=>{t.value.menuId=l,f("search")};return(l,g)=>{const v=q;return T(),N(v,{value:t.value.menuId,options:r.options,"onUpdate:value":p,size:"small"},null,8,["value","options"])}}}),Z=r=>$({url:"/backend/addContentData",method:"post",data:r}),E=r=>$({url:"/backend/updateContentById",method:"post",data:r}),B=r=>$({url:"/backend/getContentData",method:"POST",data:r}),ee=V({__name:"Table",props:{params:{type:Object,required:!0}},emits:["edit","delarr"],setup(r,{expose:i,emit:c}){const f=r,t=c,p=Y("roleId"),l=W([{title:"dataId",key:"dataId",minWidth:80},{title:"内容",key:"content",minWidth:200,render(o){return K("div",null,{default:()=>`${o.content.slice(0,100)}...`})}},{title:"操作",key:"action",fixed:"right",width:160,render(o){return J([{label:"修改",icon:"edit",onClick:g.bind(null,o)},{label:"删除",icon:"delete",onClick:v.bind(null,o)}])}}],{align:"center"}),g=o=>{t("edit",o)},v=o=>{window.$dialog.warning({title:"警告",content:`确定删除 '${o.roleName}' ?`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{E({...o,isDeleted:1}).then(()=>{window.$msg.success("删除成功"),h()})}})};let b=u(!1),_=D([]);const h=()=>(b.value=!0,new Promise(o=>{B(f.params).then(w=>{b.value=!1,_=w.data,o(w.data.total)})})),d=[],I=o=>{d.length=0,d.push(...o)};return i({getTable:h,delArr:()=>{if(!d.length)return window.$msg.info("请选择删除项");window.$dialog.warning({title:"警告",content:"确定批量删除?",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{}})}}),(o,w)=>{const s=L;return T(),N(s,{loading:a(b),columns:a(l),data:a(_),"row-key":a(p),"onUpdate:checkedRowKeys":I},null,8,["loading","columns","data","row-key"])}}}),te=V({__name:"Form",props:{options:{type:Array,required:!0},formId:[Number,String]},setup(r,{expose:i}){const c=r;let f={dataId:"",menuId:1,type:"1",content:"",childIndex:1},t=u(F(f));const p={content:[{required:!0,message:"内容不能为空",trigger:"blur"}],childIndex:{required:!0,message:"排序不能为空"}},l=()=>{B({menuId:c.formId}).then(s=>{console.log(s),t.value=s.data[0]})};let g=u(null);const v=()=>{t.value=F(f)},b=()=>(console.log(t.value),t.value.dataId=`666_${t.value.menuId}`,new Promise((s,n)=>{g.value.validate(e=>{e?n(!1):(c.formId?E(t.value):Z([t.value])).then(()=>{window.$msg.success(`${c.formId?"修改":"新增"}内容成功！`),s(!0)}).catch(()=>{window.$msg.error("该菜单内容已存在"),n(!1)})})})),_=s=>{let n=[];return s.forEach(e=>{e.childs?n.push({label:e.menuName,key:e.menuId,children:_(e.childs)}):n.push({label:e.menuName,key:e.menuId})}),n};let h=u(!1),d=D([]),I=D([]);const x=()=>(h.value=!0,new Promise(s=>{A({}).then(n=>{d=P(n.data,0),I=[{key:0,label:"主类目",children:_(d)}],h.value=!1,s(I)})})),o=s=>{t.value.menuId=s};let w=u({MENU_CONF:{fontFamily:{fontFamilyList:["黑体",{name:"仿宋",value:"仿宋"},"楷体","宋体"]}}});return i({validateForm:b}),U(()=>{v(),x(),c.formId&&l()}),(s,n)=>{const e=q,m=Q;return T(),N(m,{ref_key:"formRef",ref:g,model:a(t),rules:p,"label-placement":"left","require-mark-placement":"left","label-width":"80"},{default:C(()=>[k(a(S),{path:"menuId",label:"菜单",style:{"grid-area":"1 / 1 / 2 / 3"}},{default:C(()=>[k(e,{value:a(t).menuId,options:r.options,"onUpdate:value":o,size:"small"},null,8,["value","options"])]),_:1}),k(a(S),{path:"content",label:"内容"},{default:C(()=>[k(G,{modelValue:a(t).content,"onUpdate:modelValue":n[0]||(n[0]=y=>a(t).content=y),editorConfig:a(w)},null,8,["modelValue","editorConfig"])]),_:1})]),_:1},8,["model"])}}}),ne=M(te,[["__scopeId","data-v-5fd0dad1"]]),pe=V({__name:"index",setup(r){let i=u(null);const c=n=>{let e=[];return n.forEach(m=>{m.childs.length>0?e.push({label:m.menuName,key:m.menuId,children:c(m.childs)}):e.push({label:m.menuName,key:m.menuId})}),e},f=()=>{A({}).then(n=>{console.log(1,n.data);let e=P(n.data,0);i.value=[...c(e)],console.log(2,i)})},t=u(null),p=()=>{t.value.getTable()};let l=u({menuId:1}),g=O(()=>Object.assign({},l.value));const v=D({del:!1,export:!1,import:!1}),b=()=>{l.value.menuId=1,p()};let _=u(""),h=u(!1),d=u(!1),I=u(null),x=u("");const o=(n=null)=>{const e=!!n;x.value=e?n.menuId:"",_.value=`${e?"编辑":"新增"}内容`,d.value=!0},w=()=>{h.value=!0,I.value.validateForm().then(()=>{d.value=!1,p()}).catch(()=>{}).finally(()=>{h.value=!1})},s=()=>{t.value.delArr()};return j("btnload",h),U(()=>{p(),f()}),(n,e)=>{const m=H;return T(),N(m,{title:a(_),controlShow:v,uploadTitle:"导入用户列表",show:a(d),"onUpdate:show":e[1]||(e[1]=y=>R(d)?d.value=y:d=y),onAdd:o,onSearch:p,onReset:b,onDel:s,onSubmit:w},{search:C(()=>[a(i)?(T(),N(X,{key:0,modelValue:a(l),"onUpdate:modelValue":e[0]||(e[0]=y=>R(l)?l.value=y:l=y),options:a(i)},null,8,["modelValue","options"])):z("",!0)]),table:C(()=>[k(ee,{ref_key:"table",ref:t,params:a(g),onEdit:o},null,8,["params"])]),form:C(()=>[k(ne,{ref_key:"form",ref:I,formId:a(x),options:a(i)},null,8,["formId","options"])]),_:1},8,["title","controlShow","show"])}}});export{pe as default};
